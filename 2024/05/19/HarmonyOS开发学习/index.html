<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>HarmonyOS开发学习 | Apin | blogs</title>

  
  <meta name="author" content="a-pin">
  

  
  <meta name="description" content="This is a blog website in order to record my study experiences!">
  

  
  <meta name="keywords" content="blog,a-pin">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="HarmonyOS开发学习"/>

  <meta property="og:site_name" content="Apin"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Apin" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
  <link href="https://fonts.lug.ustc.edu.cn/css?family=Lato|Rubik" rel="stylesheet">
  <script src="/js/pangu-407.min.js"></script>
<meta name="generator" content="Hexo 6.3.0"></head>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    pangu.autoSpacingPage();
  });
</script>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Apin</a>
    </h1>
    <p class="site-description">blogs</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/tags">标签</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>HarmonyOS开发学习</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2024/05/19/HarmonyOS开发学习/" rel="bookmark">
        <time class="entry-date published" datetime="2024-05-19T09:00:07.000Z">
          2024-05-19
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        

<script type="text/javascript">
    function convertRemToPixels(rem) {    
        return rem * parseFloat(getComputedStyle(document.documentElement).fontSize);
    }
    window.onscroll = function() {
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        if (scrollTop > convertRemToPixels(40)) {
            document.getElementsByClassName('toc-article')[0].style.visibility = 'visible';
        } else {
            document.getElementsByClassName('toc-article')[0].style.visibility = 'hidden';
        }
    }

</script>


<div id="toc" class="toc-article" style="overflow-y: auto; max-height: 80%;">
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="toc-text">开发工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DevEco-Studio"><span class="toc-text">DevEco Studio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ArkUI-%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6"><span class="toc-text">ArkUI 开发框架</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">开发基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-%E6%A1%86%E6%9E%B6"><span class="toc-text">UI 框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-text">应用模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ArkTS-%E5%BC%80%E5%8F%91"><span class="toc-text">ArkTS 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Typescript-%E5%85%A5%E9%97%A8"><span class="toc-text">Typescript 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B"><span class="toc-text">基础类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5"><span class="toc-text">条件语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-text">函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-text">类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97"><span class="toc-text">模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-text">迭代器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ArkTS-%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5"><span class="toc-text">ArkTS 开发实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F-UI-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">声明式 UI 基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84%E6%9E%84%E6%88%90"><span class="toc-text">自定义组件的构成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E4%B8%8E%E5%B8%83%E5%B1%80"><span class="toc-text">配置属性与布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81"><span class="toc-text">改变组件状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E6%B8%B2%E6%9F%93%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-text">循环渲染列表数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3-UIAbility"><span class="toc-text">应用程序入口 UIAbility</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UIAbility-%E6%A6%82%E8%BF%B0"><span class="toc-text">UIAbility 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E5%92%8C%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92"><span class="toc-text">页面跳转和数据传递</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E5%92%8C%E5%8F%82%E6%95%B0%E6%8E%A5%E6%94%B6"><span class="toc-text">页面跳转和参数接收</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E8%BF%94%E5%9B%9E%E5%92%8C%E5%8F%82%E6%95%B0%E6%8E%A5%E6%94%B6"><span class="toc-text">页面返回和参数接收</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIAbility-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">UIAbility 生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIAbility-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">UIAbility 启动模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-text">组件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6"><span class="toc-text">常用基础组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Text"><span class="toc-text">Text</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Image"><span class="toc-text">Image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TextInput"><span class="toc-text">TextInput</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Button"><span class="toc-text">Button</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LoadingProgress"><span class="toc-text">LoadingProgress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#r-%E2%80%98x-x-x%E2%80%99"><span class="toc-text">$r(‘x.x.x’)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Column-amp-Row-%E7%BB%84%E4%BB%B6"><span class="toc-text">Column&amp;Row 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D"><span class="toc-text">概念介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%AE%B9%E5%99%A8%E6%A6%82%E5%BF%B5"><span class="toc-text">布局容器概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E8%BD%B4%E5%92%8C%E4%BA%A4%E5%8F%89%E8%BD%B4%E6%A6%82%E5%BF%B5"><span class="toc-text">主轴和交叉轴概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D"><span class="toc-text">属性介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E8%BD%B4%E6%96%B9%E5%90%91%E7%9A%84%E5%AF%B9%E9%BD%90"><span class="toc-text">主轴方向的对齐</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E8%BD%B4%E6%96%B9%E5%90%91%E7%9A%84%E5%AF%B9%E9%BD%90"><span class="toc-text">交叉轴方向的对齐</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D"><span class="toc-text">接口介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#List-amp-Grid-%E7%BB%84%E4%BB%B6"><span class="toc-text">List&amp;Grid 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#List-%E7%BB%84%E4%BB%B6"><span class="toc-text">List 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ForEach-%E6%B8%B2%E6%9F%93%E5%88%97%E8%A1%A8"><span class="toc-text">ForEach 渲染列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E5%88%86%E5%89%B2%E7%BA%BF"><span class="toc-text">列表分割线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BB%9A%E5%8A%A8%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-text">滚动事件监听</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%88%97%E6%96%B9%E5%90%91"><span class="toc-text">排列方向</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Grid-%E7%BB%84%E4%BB%B6"><span class="toc-text">Grid 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ForEach-%E6%B8%B2%E6%9F%93%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80"><span class="toc-text">ForEach 渲染网格布局</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">列表性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-text">使用数据懒加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-list-%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%BD%E9%AB%98"><span class="toc-text">设置 list 组件的宽高</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tabs-%E7%BB%84%E4%BB%B6"><span class="toc-text">Tabs 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tabs-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-text">Tabs 简单使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TabBar-%E5%B8%83%E5%B1%80%E6%A8%A1%E5%BC%8F"><span class="toc-text">TabBar 布局模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TabBar-%E4%BD%8D%E7%BD%AE%E5%92%8C%E6%8E%92%E5%88%97%E6%96%B9%E5%90%91"><span class="toc-text">TabBar 位置和排列方向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-TabBar-%E6%A0%B7%E5%BC%8F"><span class="toc-text">自定义 TabBar 样式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E8%BF%9B%E9%98%B6"><span class="toc-text">组件进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81"><span class="toc-text">管理组件状态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#State"><span class="toc-text">@State</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prop"><span class="toc-text">@Prop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Link"><span class="toc-text">@Link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Provide-amp-Consume"><span class="toc-text">@Provide&amp;@Consume</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Video-%E7%BB%84%E4%BB%B6"><span class="toc-text">Video 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E4%B8%8E%E5%B1%9E%E6%80%A7"><span class="toc-text">参数与属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E4%BA%8B%E4%BB%B6"><span class="toc-text">回调事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">自定义控制器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%BC%B9%E7%AA%97"><span class="toc-text">添加弹窗</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AD%A6%E5%91%8A%E5%BC%B9%E7%AA%97"><span class="toc-text">警告弹窗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E9%80%89%E6%8B%A9%E5%BC%B9%E7%AA%97"><span class="toc-text">文本选择弹窗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E9%80%89%E6%8B%A9%E5%BC%B9%E7%AA%97"><span class="toc-text">日期选择弹窗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%B9%E7%AA%97"><span class="toc-text">自定义弹窗</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB"><span class="toc-text">属性动画</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4"><span class="toc-text">参数调整</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD"><span class="toc-text">关闭</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-%E7%BB%84%E4%BB%B6"><span class="toc-text">Web 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E7%BD%91%E9%A1%B5"><span class="toc-text">加载网页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E7%BC%A9%E6%94%BE"><span class="toc-text">网页缩放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E4%BA%8B%E4%BB%B6-1"><span class="toc-text">回调事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript-%E4%BA%A4%E4%BA%92"><span class="toc-text">JavaScript 交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA"><span class="toc-text">页面导航</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8"><span class="toc-text">调试网络应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E8%B5%B7-HTTP-%E8%AF%B7%E6%B1%82"><span class="toc-text">发起 HTTP 请求</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86"><span class="toc-text">数据管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E9%80%89%E9%A1%B9"><span class="toc-text">首选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3"><span class="toc-text">常用接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5-amp-%E6%8F%90%E9%86%92"><span class="toc-text">通知&amp;提醒</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%80%9A%E7%9F%A5%E6%B6%88%E6%81%AF"><span class="toc-text">应用通知消息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%A2%E5%BC%8F%E4%B8%8E%E7%BB%93%E6%9E%84"><span class="toc-text">形式与结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E7%AE%A1%E7%90%86"><span class="toc-text">通知管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%80%9A%E7%9F%A5"><span class="toc-text">创建通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%80%9A%E7%9F%A5"><span class="toc-text">更新通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E9%80%9A%E7%9F%A5"><span class="toc-text">移除通知</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%92%AE-amp-%E8%A1%8C%E4%B8%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">按钮&amp;行为意图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E9%92%AE"><span class="toc-text">按钮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%A1%8C%E4%B8%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">添加行为意图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5-slot"><span class="toc-text">通知 slot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E7%BB%84"><span class="toc-text">通知组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%90%86%E6%8F%90%E9%86%92"><span class="toc-text">后台代理提醒</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E5%BA%93"><span class="toc-text">三方库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%B8%89%E6%96%B9%E5%BA%93"><span class="toc-text">常用三方库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ohos-x2F-lottie"><span class="toc-text">@ohos&#x2F;lottie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD"><span class="toc-text">安装与卸载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">库的使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E5%BC%80%E5%8F%91"><span class="toc-text">云开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E6%A8%A1%E6%9D%BF"><span class="toc-text">工程模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84"><span class="toc-text">工程结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-text">工程创建与配置</span></a></li></ol></li></ol>
      </div>
</div>
<style>
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>



        <p>HarmonyOS 是一款面向万物互联时代的、全新的分布式操作系统；有三大特性：</p>
<ul>
<li>硬件互助，资源共享；</li>
<li>一次开发，多端部署；</li>
<li>统一OS，弹性部署；</li>
</ul>
<p>HarmonyOS 整体遵从分层设计，在多设备部署场景下，支持根据实际需求裁剪某些非必要的子系统或功能&#x2F;模块：</p>
<img src="1.png" style="zoom:67%;" />

<br>

<h1 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h1><br>

<h2 id="DevEco-Studio"><a href="#DevEco-Studio" class="headerlink" title="DevEco Studio"></a>DevEco Studio</h2><p>模块级（Ohos）结构目录：</p>
<ul>
<li><p>AppScope：存放整个应用公共的信息与资源；</p>
</li>
<li><p>Entry：默认的初始模块；</p>
<table>
<thead>
<tr>
<th>子目录</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>ets</td>
<td>存放编写的代码文件</td>
</tr>
<tr>
<td>configuration</td>
<td>存放相应模块的配置文件</td>
</tr>
<tr>
<td>resource</td>
<td>对应模块内的公共资源</td>
</tr>
</tbody></table>
</li>
<li><p>configuration：存放工程应用级的配置文件；</p>
</li>
</ul>
<br>

<h2 id="ArkUI-开发框架"><a href="#ArkUI-开发框架" class="headerlink" title="ArkUI 开发框架"></a>ArkUI 开发框架</h2><p>下图描述了 ArkUI 开发框架的整体架构：</p>
<img src="2.png" style="zoom: 50%;" />

<p>其中，基于 TS 扩展的声明式 UI 范式中所用的语言就是 ArkTS；</p>
<p>例如，UI 界面会显示两段文本和一个按钮，当开发者点击按钮时，文本内容会从 “Hello World” 变为 “Hello ArkUI”：</p>
<img src="3.png" style="zoom: 67%;" />

<ul>
<li><p><strong>装饰器</strong></p>
<p>  用来装饰类、结构体、方法以及变量，赋予其特殊的含义，如上述示例中 @Entry、@Component、@State 都是装饰器；</p>
<p>  具体而言，@Component 表示这是个自定义组件；@Entry 则表示这是个入口组件；@State 表示组件中的状态变量，此状态变化会引起 UI 变更；</p>
</li>
<li><p><strong>自定义组件</strong></p>
<p>  可复用的 UI 单元，可组合其它组件，如上述被 @Component 装饰的 struct Hello；</p>
</li>
<li><p><strong>UI 描述</strong></p>
<p>  声明式的方式来描述 UI 的结构，如上述 build() 方法内部的代码块；</p>
</li>
<li><p><strong>内置组件</strong></p>
<p>  框架中默认内置的基础和布局组件，可直接被开发者调用，比如示例中的 Column、Text、Divider、Button；</p>
</li>
<li><p><strong>事件方法</strong></p>
<p>  用于添加组件对事件的响应逻辑，统一通过事件方法进行设置，如跟随在 Button 后面的 onClick()；</p>
</li>
<li><p><strong>属性方法</strong></p>
<p>  用于组件属性的配置，统一通过属性方法进行设置，如 fontSize()、width()、height()、color() 等，可通过链式调用的方式设置多项属性；</p>
</li>
</ul>
<p>从 UI 框架的需求角度，<strong>定义了各种装饰器、自定义组件和UI描述机制</strong>，再配合 UI 开发框架中的 UI 内置组件、事件方法、属性方法等共同构成了应用开发的主体；</p>
<p>在应用开发中，除了 UI 的结构化描述之外，还有一个重要的方面：<strong>状态管理</strong>。例如，用 @State 装饰过的变量 myText 包含了一个基础的状态管理机制，即 myText 的值的变化会自动触发相应的 UI 变更（Text组件）；</p>
<p>从数据的传递形式来看，可分为<strong>只读的单向传递</strong>和<strong>可变更的双向传递</strong>；</p>
<br>

<h1 id="开发基础知识"><a href="#开发基础知识" class="headerlink" title="开发基础知识"></a>开发基础知识</h1><p>在开始之前，需要了解有关 HarmonyOS 应用的一些基本概念：UI 框架的简单说明、应用模型的基本概念；</p>
<br>

<h2 id="UI-框架"><a href="#UI-框架" class="headerlink" title="UI 框架"></a>UI 框架</h2><p>HarmonyOS 提供了一套 UI 开发框架，即方舟开发框架（ArkUI 框架）。方舟开发框架可为开发者提供应用 UI 开发所必需的能力，比如多种组件、布局计算、动画能力、UI交互、绘制等。</p>
<p>方舟开发框架针对不同目的和技术背景的开发者提供了两种开发范式，分别是基于 ArkTS 的声明式开发范式和兼容 JS 的类 Web 开发范式。以下是两种开发范式的简单对比：</p>
<table>
<thead>
<tr>
<th><strong>开发范式名称</strong></th>
<th><strong>语言生态</strong></th>
<th><strong>UI更新方式</strong></th>
<th><strong>适用场景</strong></th>
<th><strong>适用人群</strong></th>
</tr>
</thead>
<tbody><tr>
<td>声明式开发范式</td>
<td>ArkTS 语言</td>
<td>数据驱动更新</td>
<td>复杂度较大、团队合作度较高的程序</td>
<td>移动系统应用开发人员、系统应用开发人员</td>
</tr>
<tr>
<td>类 Web 开发范式</td>
<td>JS 语言</td>
<td>数据驱动更新</td>
<td>界面较为简单的程序应用和卡片</td>
<td>Web 前端开发人员</td>
</tr>
</tbody></table>
<br>

<h2 id="应用模型"><a href="#应用模型" class="headerlink" title="应用模型"></a>应用模型</h2><p>应用模型是 HarmonyOS 为开发者提供的应用程序所需能力的抽象提炼，它提供了应用程序必备的组件和运行机制。有了应用模型，开发者可以基于一套统一的模型进行应用开发，使应用开发更简单、高效。</p>
<p>随着系统的演进发展，HarmonyOS 先后提供了两种应用模型：</p>
<ul>
<li><strong>FA（Feature Ability）模型</strong>：HarmonyOS API 7 开始支持的模型，已经不再主推；</li>
<li><strong>Stage 模型</strong>：HarmonyOS API 9 开始新增的模型，是目前主推且会长期演进的模型。在该模型中，由于提供了AbilityStage、WindowStage等类作为应用组件和Window窗口的“舞台”，因此称这种应用模型为Stage模型；</li>
</ul>
<br>

<h1 id="ArkTS-开发"><a href="#ArkTS-开发" class="headerlink" title="ArkTS 开发"></a>ArkTS 开发</h1><p>ArkTS 是 HarmonyOS 优选的主力应用开发语言；</p>
<p>ArkTS 是由 ArkUI 框架提供，用于以声明式开发范式开发界面的语言；</p>
<p>它在 TypeScript 的基础上，匹配 ArkUI 框架，扩展了声明式 UI、状态管理、并发任务等相应的能力，让开发者以更简洁、更自然的方式开发跨端应用；</p>
<p>即，TypeScript 是 JavaScript 的超集，ArkTS 则是 TypeScript 的超集；·</p>
<br>

<h2 id="Typescript-入门"><a href="#Typescript-入门" class="headerlink" title="Typescript 入门"></a>Typescript 入门</h2><p>TypeScript 是 JavaScript 的一个超集，它扩展了 JavaScript 的语法，通过在 JavaScript 的基础上添加静态类型定义构建而成，是一个开源的编程语言；</p>
<br>

<h3 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h3><p>TypeScript 中定义变量的格式：<code>let 变量名: 类型 = 值;</code>，其中类型是对 JS 的扩展；</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>布尔值 boolean</td>
<td>赋值为 true 或 false</td>
<td><code>let isDone: boolean = false;</code></td>
</tr>
<tr>
<td>数字 number</td>
<td>所有数字都是浮点数，支持多种进制</td>
<td><code>let decLiteral: number = 2023;</code><br/><code>let binaryLiteral: number = 0b11111100111;</code><br/><code>let octalLiteral: number = 0o3747;</code><br/><code>let hexLiteral: number = 0x7e7;</code></td>
</tr>
<tr>
<td>字符串 string</td>
<td>文本数据类型</td>
<td><code>let name: string = &quot;Jacky&quot;;</code></td>
</tr>
<tr>
<td>数组</td>
<td>两种定义方法：<br>1、在元素类型后面接上 []；<br>2、使用数组泛型，Array&lt;元素类型&gt;；</td>
<td><code>let list: number[] = [1, 2, 3];</code><br><code>let list: Array&lt;number&gt; = [1, 2, 3];</code></td>
</tr>
<tr>
<td>元组</td>
<td>表示一个已知元素数量和类型的数组，各元素的类型不必相同</td>
<td><code>let x: [string, number] = [&#39;hello&#39;, 10];</code></td>
</tr>
<tr>
<td>枚举 enum</td>
<td>对 JavaScript 标准数据类型的一个补充，可以为一组数值赋予变量名</td>
<td><code>enum Color &#123;Red, Green, Blue&#125;;</code><br/><code>let c: Color = Color.Green;</code></td>
</tr>
<tr>
<td>Unknown</td>
<td>使变量跳过编译阶段的检查</td>
<td><code>let notSure: unknown = 4;</code><br/><code>notSure = false;</code></td>
</tr>
<tr>
<td>Void</td>
<td>函数没有返回值</td>
<td><code>function test(): void &#123; ... &#125;</code></td>
</tr>
<tr>
<td>Null、Undefined</td>
<td>undefined 和 null 各自的类型</td>
<td><code>let u: undefined = undefined;</code><br/><code>let n: null = null;</code></td>
</tr>
<tr>
<td>联合类型</td>
<td>表示取值可以为多种类型中的一种</td>
<td>&#96;let myFavoriteNumber: string</td>
</tr>
</tbody></table>
<br>

<h3 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h3><p>通过一条或多条语句的执行结果（True 或 False）来决定执行的代码块；</p>
<ul>
<li><p><strong>if 语句</strong></p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="attr">num</span>:<span class="built_in">number</span> = <span class="number">2</span> </span><br><span class="line"><span class="keyword">if</span>(num &gt; <span class="number">0</span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num+<span class="string">&#x27; 是正数&#x27;</span>) </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(num &lt; <span class="number">0</span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num+<span class="string">&#x27; 是负数&#x27;</span>) </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num+<span class="string">&#x27; 为0&#x27;</span>) </span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>switch…case 语句</strong></p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="attr">grade</span>:<span class="built_in">string</span> = <span class="string">&#x27;A&#x27;</span>; </span><br><span class="line"><span class="keyword">switch</span>(grade) &#123; </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>: &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;优&#x27;</span>); </span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;B&#x27;</span>: &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;良&#x27;</span>); </span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;C&#x27;</span>: &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;及格&#x27;</span>); </span><br><span class="line">        <span class="keyword">break</span>;    </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;不及格&#x27;</span>); </span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="attr">default</span>: &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;非法输入&#x27;</span>); </span><br><span class="line">        <span class="keyword">break</span>;              </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>函数需要声明函数的名称、返回类型和参数；</p>
<ul>
<li><p><strong>有名函数</strong>：给变量设置为number类型；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>匿名函数</strong>：给变量设置为number类型；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myAdd = <span class="keyword">function</span> (<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>同时为了确保输入输出的准确性，在以上的示例中为函数添加了类型；</p>
<ol>
<li><p><strong>可选参数</strong>：在参数名旁使用（?）；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">buildName</span>(<span class="params">firstName: <span class="built_in">string</span>, lastName?: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (lastName)</span><br><span class="line">        <span class="keyword">return</span> firstName + <span class="string">&#x27; &#x27;</span> + lastName;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result1 = <span class="title function_">buildName</span>(<span class="string">&#x27;Bob&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> result2 = <span class="title function_">buildName</span>(<span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Adams&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>剩余参数</strong>：会被当做个数不限的可选参数，使用省略号（…）进行定义；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getEmployeeName</span>(<span class="params">firstName: <span class="built_in">string</span>, ...restOfName: <span class="built_in">string</span>[]</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> firstName + <span class="string">&#x27; &#x27;</span> + restOfName.<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> employeeName = <span class="title function_">getEmployeeName</span>(<span class="string">&#x27;Joseph&#x27;</span>, <span class="string">&#x27;Samuel&#x27;</span>, <span class="string">&#x27;Lucas&#x27;</span>, <span class="string">&#x27;MacKinzie&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>箭头函数</strong>：它是定义匿名函数的简写语法，用于函数表达式；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">testArrowFun</span> = (<span class="params">num: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num + <span class="string">&#x27; 是正数&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num + <span class="string">&#x27; 是负数&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num + <span class="string">&#x27; 为0&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">testArrowFun</span>(-<span class="number">1</span>)   <span class="comment">//输出日志：-1 是负数</span></span><br></pre></td></tr></table></figure>
<p> 另外，在 <code>(param1, param2) =&gt; expression</code> 中，主体部分是一个表达式，而不是代码块，其中的表达式会被作为函数的返回值；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="attr">arr</span>: <span class="built_in">string</span>[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">16</span>).<span class="title function_">fill</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">_, index</span>) =&gt;</span> <span class="string">`item <span class="subst">$&#123;index&#125;</span>`</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<br>

<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><p>TypeScript 支持基于类的面向对象的编程方式，定义类的关键字为 class，后面紧跟类名；</p>
<p>类描述了所创建的对象共同的<strong>属性</strong>和<strong>方法</strong>，示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">department</span>: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, department: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name, age);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">department</span> = department;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">getEmployeeInfo</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">getPersonInfo</span>() + <span class="string">` and work in <span class="subst">$&#123;<span class="variable language_">this</span>.department&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TypeScript 中允许使用<strong>继承</strong>来扩展现有的类，对应的关键字为 extends；</p>
<br>

<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>模块（module）可以相互加载，使用指令 export 和 import 来交换功能，从另一个模块调用一个模块的函数；</p>
<p>模块里面的变量、函数和类等在模块外部是不可见的，除非明确地使用 export 导出它们；</p>
<ol>
<li><p><strong>导出</strong></p>
<p> 任何声明（变量、函数、类、类型别名、接口）都能通过 export 关键字来导出；</p>
<p> 例如，导出 NewsData 类：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">NewsData</span> &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">...</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>导入</strong></p>
<p> 可以使用以下 import 形式之一来导入其它模块中的内容；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NewsData</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../common/bean/NewsData&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<br>

<h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><p>当一个对象实现了 Symbol.iterator 属性时，我们认为它是可迭代的；</p>
<p>一些内置的类型如 Array、Map、Set、String、Int32Array、Uint32Array 等都具有可迭代性；</p>
<p><strong>for..of 和 for..in</strong> 均可迭代一个列表，但是用于迭代的值却不同：</p>
<ul>
<li>for..in 迭代的是对象的<strong>键</strong>；</li>
<li>for..of 迭代的是对象的<strong>值</strong>；</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> list) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// &quot;0&quot;, &quot;1&quot;, &quot;2&quot;,</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> list) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// &quot;4&quot;, &quot;5&quot;, &quot;6&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="ArkTS-开发实践"><a href="#ArkTS-开发实践" class="headerlink" title="ArkTS 开发实践"></a>ArkTS 开发实践</h2><p>这里只做一个整体概念的整理，理解开发基本思想，不实现具体案例；以下是目的效果图：</p>
<img src="6.png" style="zoom: 50%;" />

<br>

<h3 id="声明式-UI-基本概念"><a href="#声明式-UI-基本概念" class="headerlink" title="声明式 UI 基本概念"></a>声明式 UI 基本概念</h3><p>应用界面是由一个个页面组成；</p>
<p>声明式 UI 构建页面的过程，其实是组合组件的过程，声明式 UI 的思想，主要体现在两个方面：</p>
<ul>
<li>描述 UI 的呈现结果，而不关心过程；</li>
<li>状态驱动试图更新；</li>
</ul>
<br>

<h3 id="自定义组件的构成"><a href="#自定义组件的构成" class="headerlink" title="自定义组件的构成"></a>自定义组件的构成</h3><p>使用 @Entry 和 @Component 装饰的自定义组件会作为页面的入口，在页面加载时首先渲染；</p>
<blockquote>
<p>注意：使用 @Entry 装饰的组件只是当前页面的默认入口组件，将首先创建并呈现；<strong>默认最先显示的页面则是 Index 页面</strong>；</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">ToDoList</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>使用 @Component 装饰的自定义组件，将 ToDoItem 这个自定义组件作为页面的组成部分：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">ToDoItem</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>在自定义组件内使用 build 方法来进行 UI 描述，可以容纳<strong>内置组件</strong>和其他<strong>自定义组件</strong>：</p>
<ul>
<li><p>如 Column 和 Text 都是内置组件，由 ArkUI 框架提供；</p>
<p>  内置组件包含<strong>基础组件</strong>和<strong>容器组件</strong>等；</p>
</li>
<li><p>ToDoItem 为自定义组件，需要开发者使用 ArkTS 自行声明；</p>
</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">ToDoList</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(...) &#123;</span><br><span class="line">      <span class="title class_">Text</span>(...)</span><br><span class="line">      <span class="title class_">ForEach</span>(...&#123;</span><br><span class="line">        <span class="title class_">ToDoItem</span>(...)</span><br><span class="line">      &#125;,...)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="配置属性与布局"><a href="#配置属性与布局" class="headerlink" title="配置属性与布局"></a>配置属性与布局</h3><p>ArkTS 提供了属性方法用于描述界面的样式：</p>
<ul>
<li><p>常量传递：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;Hello World&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">50</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>变量传递：使用组件内已经定义的变量</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;Hello World&#x27;</span>).<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">size</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>链式调用：配置多个属性</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;Hello World&#x27;</span>).<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">size</span>).<span class="title function_">width</span>(<span class="number">100</span>).<span class="title function_">height</span>(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>表达式传递：传入普通表达式以及三目运算表达式</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;Hello World&#x27;</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">size</span>)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">count</span> + <span class="number">100</span>)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="variable language_">this</span>.<span class="property">count</span> % <span class="number">2</span> === <span class="number">0</span> ? <span class="number">100</span> : <span class="number">200</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>内置枚举类型：ArkTS 中提供了内置枚举类型</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;Hello World&#x27;</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="variable language_">this</span>.<span class="property">size</span>)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">count</span> + <span class="number">100</span>)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="variable language_">this</span>.<span class="property">count</span> % <span class="number">2</span> === <span class="number">0</span> ? <span class="number">100</span> : <span class="number">200</span>)</span><br><span class="line">  .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Red</span>)</span><br><span class="line">  .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ArkUI 中的<strong>布局容器</strong>有很多种，在不同的适用场景选择不同的布局容器实现，ArkTS 使用容器组件采用花括号语法，内部放置 UI 描述：</p>
<ul>
<li><p>行布局：Row() 元素为横向排列</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Row</span>() &#123;</span><br><span class="line">  <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.ic_default&#x27;</span>))</span><br><span class="line">  <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">content</span>)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>列布局：Column() 整体从上往下纵向排列</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Column</span>() &#123;</span><br><span class="line">  <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.page_title&#x27;</span>))</span><br><span class="line">  ...</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">totalTasks</span>,<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">TodoItem</span>(&#123;<span class="attr">content</span>:item&#125;)</span><br><span class="line">  &#125;,...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="改变组件状态"><a href="#改变组件状态" class="headerlink" title="改变组件状态"></a>改变组件状态</h3><p>声明式 UI 的特点就是 UI 是随数据更改而自动刷新的；</p>
<p>这里定义了一个类型为 boolean 的变量 isComplete，其被 @State 装饰后，框架内建立了数据和视图之间的绑定，其值的改变影响 UI 的显示；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@State</span> isComplete : <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<img src="4.png" style="zoom: 40%;" />

<p><strong>首先</strong>，用圆圈和对勾两张图片，分别表示该项是否完成，这部分涉及到内容的切换，需要使用条件渲染：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isComplete</span>) &#123;</span><br><span class="line">  <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.ic_ok&#x27;</span>))</span><br><span class="line">    .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>)</span><br><span class="line">    .<span class="title function_">width</span>($r(<span class="string">&#x27;app.float.checkbox_width&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>($r(<span class="string">&#x27;app.float.checkbox_width&#x27;</span>))</span><br><span class="line">    .<span class="title function_">margin</span>($r(<span class="string">&#x27;app.float.checkbox_margin&#x27;</span>))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.ic_default&#x27;</span>))</span><br><span class="line">    .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>)</span><br><span class="line">    .<span class="title function_">width</span>($r(<span class="string">&#x27;app.float.checkbox_width&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>($r(<span class="string">&#x27;app.float.checkbox_width&#x27;</span>))</span><br><span class="line">    .<span class="title function_">margin</span>($r(<span class="string">&#x27;app.float.checkbox_margin&#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ArkUI 提供了一种更轻量的 UI 元素复用机制 @Builder，@Builder 所装饰的函数遵循 build() 函数语法规则，开发者可以将重复使用的 UI 元素抽象成一个方法，在 build 方法里调用；</p>
</blockquote>
<p>由于两个 Image 的实现具有大量重复代码，ArkTS 提供了 @Builder 装饰器，来修饰一个函数，快速生成布局内容，从而可以避免重复的UI描述内容；</p>
<ol>
<li><p>这里使用 @Bulider 声明了一个 labelIcon 的函数，参数为 url，对应要传给 Image 的图片路径；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span> <span class="title function_">labelIcon</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="title class_">Image</span>(url)</span><br><span class="line">    .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>)</span><br><span class="line">    .<span class="title function_">width</span>($r(<span class="string">&#x27;app.float.checkbox_width&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>($r(<span class="string">&#x27;app.float.checkbox_width&#x27;</span>))</span><br><span class="line">    .<span class="title function_">margin</span>($r(<span class="string">&#x27;app.float.checkbox_margin&#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用时只需要使用 this 关键字访问 @Builder 装饰的函数名，即可快速创建布局：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isComplete</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">labelIcon</span>($r(<span class="string">&#x27;app.media.ic_ok&#x27;</span>))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">labelIcon</span>($r(<span class="string">&#x27;app.media.ic_default&#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>然后</strong>，使用了三目运算符给内容的字体增加相应的样式变化：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">content</span>)</span><br><span class="line">  ...</span><br><span class="line">  .<span class="title function_">opacity</span>(<span class="variable language_">this</span>.<span class="property">isComplete</span> ? <span class="title class_">CommonConstants</span>.<span class="property">OPACITY_COMPLETED</span> : <span class="title class_">CommonConstants</span>.<span class="property">OPACITY_DEFAULT</span>)</span><br><span class="line">  <span class="comment">//透明度</span></span><br><span class="line">  .<span class="title function_">decoration</span>(&#123; <span class="attr">type</span>: <span class="variable language_">this</span>.<span class="property">isComplete</span> ? <span class="title class_">TextDecorationType</span>.<span class="property">LineThrough</span> : <span class="title class_">TextDecorationType</span>.<span class="property">None</span> &#125;)</span><br><span class="line">  <span class="comment">//文字是否有划线</span></span><br></pre></td></tr></table></figure>

<p><strong>最后</strong>，为了实现与用户交互的效果，在组件上添加了 onClick 点击事件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">ToDoItem</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> content?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="meta">@State</span> isComplete : <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="meta">@Builder</span> <span class="title function_">labelIcon</span>(<span class="params">icon</span>) &#123;...&#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isComplete</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">labelIcon</span>($r(<span class="string">&#x27;app.media.ic_ok&#x27;</span>))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">labelIcon</span>($r(<span class="string">&#x27;app.media.ic_default&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line">      ... </span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isComplete</span>= !<span class="variable language_">this</span>.<span class="property">isComplete</span>;</span><br><span class="line">     &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="循环渲染列表数据"><a href="#循环渲染列表数据" class="headerlink" title="循环渲染列表数据"></a>循环渲染列表数据</h3><p>以上只是完成一个 ToDoItem 组件的开发，当有多条代办数据需要显示在页面时，就需要使用到 ForEach 循环渲染语法；</p>
<p>ForEach 基本使用中，只需要了解<strong>要渲染的数据</strong>以及<strong>要生成的 UI 内容</strong>两个部分；</p>
<p>例如，这里要渲染的数组为以上的五条待办事项：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">total_Tasks</span>:<span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; = [</span><br><span class="line">  <span class="string">&#x27;早起晨练&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;准备早餐&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;阅读名著&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;学习ArkTS&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;看剧放松&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>ToDoItem 这个自定义组件中，每一个 ToDoItem 要显示的文本参数 content 需要外部传入，参数传递使用花括号的形式，用 content 接受数组内的内容项 item：</p>
<img src="5.png" style="zoom:40%;" />

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">ToDoList</span> &#123;</span><br><span class="line">   ...</span><br><span class="line">   <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="title class_">Row</span>() &#123;</span><br><span class="line">       <span class="title class_">Column</span>() &#123;</span><br><span class="line">         <span class="title class_">Text</span>(...)</span><br><span class="line">           ...</span><br><span class="line">         <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">totalTasks</span>,<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">           <span class="title class_">TodoItem</span>(&#123;<span class="attr">content</span>:item&#125;)</span><br><span class="line">         &#125;,...)</span><br><span class="line">       &#125;</span><br><span class="line">       .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">     &#125;</span><br><span class="line">     .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<br>

<h1 id="应用程序入口-UIAbility"><a href="#应用程序入口-UIAbility" class="headerlink" title="应用程序入口 UIAbility"></a>应用程序入口 UIAbility</h1><br>

<h2 id="UIAbility-概述"><a href="#UIAbility-概述" class="headerlink" title="UIAbility 概述"></a>UIAbility 概述</h2><p>UIAbility 是一种包含用户界面的应用组件，主要用于和用户进行交互；</p>
<p>UIAbility 也是系统调度的单元，为应用提供窗口在其中绘制界面；</p>
<p>每一个 UIAbility 实例，都对应于一个最近任务列表中的任务；</p>
<p>一个应用可以有一个 UIAbility，也可以有多个 UIAbility；</p>
<p>例如，在聊天应用中增加一个“外卖功能”，并将其独立为一个 UIAbility；当用户打开聊天应用的“外卖功能”查看外卖订单详情，此时有新的聊天消息，即可以通过最近任务列表切换回到聊天窗口继续进行聊天对话：</p>
<img src="7.png" style="zoom: 30%;" />

<p>一个 UIAbility 可以对应于多个页面，建议将一个独立的功能模块放到一个 UIAbility 中，以多页面的形式呈现；例如，新闻应用在浏览内容的时候，可以进行多页面的跳转使用；</p>
<br>

<h2 id="页面跳转和数据传递"><a href="#页面跳转和数据传递" class="headerlink" title="页面跳转和数据传递"></a>页面跳转和数据传递</h2><p>UIAbility 的数据传递包括有 <strong>UIAbility 内页面的跳转和数据传递</strong>、<strong>UIAbility 间的数据跳转和数据传递</strong>，这里主要讲解 UIAbility 内页面的跳转和数据传递；</p>
<p>在一个应用包含一个 UIAbility 的场景下，可以通过新建多个页面来实现和丰富应用的内容；这会涉及到 UIAbility 内页面的新建以及 UIAbility 内页面的跳转和数据传递；</p>
<p>打开 DevEco Studio，选择一个 Empty Ability 工程模板，创建一个工程，例如命名为 MyApplication：</p>
<ul>
<li>在 src&#x2F;main&#x2F;ets&#x2F;entryability 目录下，初始会生成一个 UIAbility 文件 EntryAbility.ts；可以在 EntryAbility.ts 文件中根据业务需要实现 UIAbility 的生命周期回调内容；</li>
<li>在 src&#x2F;main&#x2F;ets&#x2F;pages 目录下，会生成一个 Index 页面；这也是基于 UIAbility 实现的应用的入口页面；可以在 Index 页面中根据业务需要实现入口页面的功能；</li>
<li>在 src&#x2F;main&#x2F;ets&#x2F;pages 目录下，右键 New-&gt;Page，新建一个 Second 页面，用于实现页面间的跳转和数据传递；</li>
</ul>
<p>页面间的导航可以通过页面路由 router 模块来实现；通过页面路由模块，可以使用不同的 url 访问不同的页面，包括跳转指定页面、替换当前页面、返回上一页面等；</p>
<p>在使用页面路由之前，需要先导入 router 模块，如下代码所示：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span>;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="页面跳转和参数接收"><a href="#页面跳转和参数接收" class="headerlink" title="页面跳转和参数接收"></a>页面跳转和参数接收</h3><p>以下是页面跳转的几种方式：</p>
<ul>
<li><p>方式一：API9 及以上，<code>router.pushUrl()</code> 方法新增了 mode 参数，可以将 mode 参数配置为 router.RouterMode.Single 单实例模式和 router.RouterMode.Standard 多实例模式；</p>
<blockquote>
<p>说明：当页面栈的元素数量较大或者超过 32 时，可以通过调用 <code>router.clear()</code> 方法清除页面栈中的所有历史页面，仅保留当前页面作为栈顶页面；</p>
</blockquote>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">pushUrl</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;pages/Second&#x27;</span>,</span><br><span class="line">  <span class="attr">params</span>: &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&#x27;Index页面传来的数据&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, router.<span class="property">RouterMode</span>.<span class="property">Single</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二：API9 及以上，<code>router.replaceUrl()</code> 方法同样新增了 mode 参数；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">replaceUrl</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;pages/Second&#x27;</span>,</span><br><span class="line">  <span class="attr">params</span>: &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&#x27;Index页面传来的数据&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, router.<span class="property">RouterMode</span>.<span class="property">Single</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Standard</td>
<td>多实例模式（默认）；<br>目标页面会被添加到页面栈顶，无论栈中是否存在相同 url 的页面；</td>
</tr>
<tr>
<td>Single</td>
<td>单实例模式；<br>如果目标页面的 url 已经存在于页面栈中，则该 url 页面移动到栈顶；<br>如果目标页面的 url 在页面栈中不存在相同 url 页面，则按照默认的多实例模式进行跳转；</td>
</tr>
</tbody></table>
<p>通过调用 <code>router.getParams()</code> 方法获取 Index 页面传递过来的自定义参数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Second</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">src</span>: <span class="built_in">string</span> = (router.<span class="title function_">getParams</span>() <span class="keyword">as</span> <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;)[<span class="string">&#x27;src&#x27;</span>];</span><br><span class="line">  <span class="comment">// 页面刷新展示</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：根据编程实际结果，Row 和 Column 布局有<strong>居中</strong>和<strong>包裹</strong>的特性；</p>
</blockquote>
<br>

<h3 id="页面返回和参数接收"><a href="#页面返回和参数接收" class="headerlink" title="页面返回和参数接收"></a>页面返回和参数接收</h3><p>在 Second 页面中，可以通过调用 <code>router.back()</code> 方法实现返回到上一个页面，或者在调用 <code>router.back()</code> 方法时增加可选的 options 参数（增加 url 参数）返回到指定页面；</p>
<ul>
<li><p>返回上一个页面：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">back</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回到指定页面：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">back</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;pages/Index&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>注意：调用 <code>router.back()</code> 返回的目标页面需要在页面栈中存在才能正常跳转；</p>
</blockquote>
<p>在调用 <code>router.back()</code> 方法之前，可以先调用 <code>router.enableBackPageAlert()</code> 或 <code>router.hideAlertBeforeBackPage()</code> 方法开启或关闭页面返回询问对话框功能；</p>
<p>同时，调用 <code>router.back()</code> 方法返回时，可以根据需要继续增加自定义参数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">showAlertBeforeBackPage</span>(&#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&#x27;Message Info&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">back</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;pages/Index&#x27;</span>,</span><br><span class="line">  <span class="attr">params</span>: &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&#x27;Second页面传来的数据&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>由于调用 <code>router.back()</code> 方法，不会新建页面（push 和 replace 都会新建），返回的是原来的页面，<strong>在原来页面中 @State 声明的变量不会重复声明</strong>，<strong>也不会触发页面的 <code>aboutToAppear()</code> 生命周期回调</strong>，因此无法直接在变量声明以及页面的 <code>aboutToAppear()</code> 生命周期回调中接收和解析 <code>router.back()</code> 传递过来的自定义参数；</p>
<img src="10.jpg"  />

<p>可以放在业务需要的位置进行参数解析；例如，在 Index 页面中的 <code>onPageShow()</code> 生命周期回调中进行参数的解析：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">routerParams</span> &#123;</span><br><span class="line">  <span class="attr">src</span>:<span class="built_in">string</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">str:<span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">src</span> = str</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">src</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="title function_">onPageShow</span>(<span class="params"></span>) &#123;    <span class="comment">//每次页面显示都会被调用</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">src</span> = (router.<span class="title function_">getParams</span>() <span class="keyword">as</span> routerParams).<span class="property">src</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 页面刷新展示</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="8.png" style="zoom:40%;" />

<br>

<h2 id="UIAbility-生命周期"><a href="#UIAbility-生命周期" class="headerlink" title="UIAbility 生命周期"></a>UIAbility 生命周期</h2><p>在 UIAbility 的使用过程中，会有多种生命周期状态，应用中的 UIAbility 实例会在其生命周期的不同状态之间转换；同时，UIAbility 类提供了很多回调，通过这些回调可以知晓当前 UIAbility 的某个状态已经发生改变；</p>
<p>为了实现多设备形态上的裁剪和多窗口的可扩展性，系统对<strong>组件管理</strong>和<strong>窗口管理</strong>进行了解耦；UIAbility 的生命周期包括 Create、Foreground、Background、Destroy 四个状态，WindowStageCreate 和 WindowStageDestroy 为窗口管理器（WindowStage）在 UIAbility 中管理 UI 界面功能的两个生命周期回调，从而实现 UIAbility 与窗口之间的弱耦合：</p>
<img src="9.webp" style="zoom: 85%;" />

<ul>
<li><p><strong>Create 状态</strong>，在 UIAbility 实例创建时触发，系统会调用 onCreate 回调；可以在 onCreate 回调中进行相关初始化操作：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">UIAbility</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.UIAbility&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="variable language_">window</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">EntryAbility</span> <span class="keyword">extends</span> <span class="title class_ inherited__">UIAbility</span> &#123;</span><br><span class="line">    <span class="title function_">onCreate</span>(<span class="params">want: Want, launchParam: AbilityConstant.LaunchParam</span>) &#123;</span><br><span class="line">        <span class="comment">// 应用初始化</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  例如，用户打开电池管理应用，在应用加载过程中，在UI页面可见之前，可以在 onCreate 回调中读取当前系统的电量情况，用于后续的 UI 页面展示；</p>
</li>
<li><p>每一个 UIAbility 实例都对应一个 WindowStage 实例，用于管理窗口相关的内容，例如，获焦&#x2F;失焦、可见&#x2F;不可见；</p>
<p>  可以在 <strong>onWindowStageCreate</strong> 回调中，设置 UI 页面加载、设置 WindowStage 的事件订阅；</p>
<p>  在 onWindowStageCreate（windowStage）中通过 loadContent 接口设置应用要加载的页面；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">UIAbility</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.UIAbility&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="variable language_">window</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">EntryAbility</span> <span class="keyword">extends</span> <span class="title class_ inherited__">UIAbility</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">onWindowStageCreate</span>(<span class="params">windowStage: <span class="variable language_">window</span>.WindowStage</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置UI页面加载</span></span><br><span class="line">        <span class="comment">// 设置WindowStage的事件订阅（获焦/失焦、可见/不可见）</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        windowStage.<span class="title function_">loadContent</span>(<span class="string">&#x27;pages/Index&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  例如，用户正在打游戏的时候收到一个消息通知，以弹窗的形式显示在游戏应用上方；此时，游戏应用就从获焦切换到了失焦状态，消息应用切换到了获焦状态；对于消息应用，在 onWindowStageCreate 回调中，会触发获焦的事件回调，可以进行设置消息应用的背景颜色、高亮等操作；</p>
</li>
<li><p><strong>Foreground</strong> 和 <strong>Background</strong> 状态，分别在 UIAbility 切换至前台或后台时触发，即 onForeground 回调和 onBackground 回调；</p>
<ol>
<li><p>onForeground 回调，在 UIAbility 的 UI 页面可见之前，即 UIAbility 切换至前台时触发；可以在 onForeground 回调中申请系统需要的资源，或者重新申请在 onBackground 中释放的资源；</p>
</li>
<li><p>onBackground 回调，在 UIAbility 的 UI 页面完全不可见之后，即 UIAbility 切换至后台时候触发；可以在 onBackground 回调中释放 UI 页面不可见时无用的资源，或者在此回调中执行较为耗时的操作，例如状态保存等；</p>
</li>
</ol>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">UIAbility</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.UIAbility&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="variable language_">window</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">EntryAbility</span> <span class="keyword">extends</span> <span class="title class_ inherited__">UIAbility</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">onForeground</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 申请系统需要的资源，或者重新申请在onBackground中释放的资源</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onBackground</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 释放UI页面不可见时无用的资源，或者在此回调中执行较为耗时的操作</span></span><br><span class="line">        <span class="comment">// 例如状态保存等</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  例如，用户打开地图应用查看当前地理位置的时候，假设地图应用已获得用户的定位权限授权；在 UI 页面显示之前，可以在 onForeground 回调中打开定位功能，从而获取到当前的位置信息；当地图应用切换到后台状态，可以在 onBackground 回调中停止定位功能，以节省系统的资源消耗；</p>
</li>
<li><p>对应于 onWindowStageCreate 回调，在 UIAbility 实例销毁之前，则会先进入 <strong>onWindowStageDestroy</strong> 回调，可以在该回调中释放 UI 页面资源；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">UIAbility</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.UIAbility&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="variable language_">window</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">EntryAbility</span> <span class="keyword">extends</span> <span class="title class_ inherited__">UIAbility</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">onWindowStageDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 释放UI页面资源</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Destroy</strong> 状态，在 UIAbility 销毁时触发；可以在 onDestroy 回调中进行系统资源的释放、数据的保存等操作；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">UIAbility</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.UIAbility&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="variable language_">window</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">EntryAbility</span> <span class="keyword">extends</span> <span class="title class_ inherited__">UIAbility</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">onDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 系统资源的释放、数据的保存等</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="UIAbility-启动模式"><a href="#UIAbility-启动模式" class="headerlink" title="UIAbility 启动模式"></a>UIAbility 启动模式</h2><ul>
<li><p>对于浏览器或者新闻等应用，用户在打开该应用，并浏览访问相关内容后，回到桌面，再次打开该应用，显示的仍然是用户当前访问的界面；</p>
</li>
<li><p>对于应用的分屏操作，用户希望使用两个不同应用之间进行分屏，也希望能使用<strong>同一个应用</strong>进行分屏；</p>
</li>
<li><p>对于文档应用，用户从文档应用中打开一个文档内容，回到文档应用，继续打开同一个文档，希望打开的还是同一个文档内容；</p>
</li>
</ul>
<p>基于以上场景的考虑，UIAbility 当前支持 singleton（单实例模式）、multiton（多实例模式）和 specified（指定实例模式）3 种启动模式；</p>
<p>对启动模式的详细说明如下：</p>
<ul>
<li><p>singleton（单实例模式，默认）：</p>
<p>  每次调用 <code>startAbility()</code> 方法时，如果应用进程中该类型的 UIAbility 实例已经存在，则复用系统中的 UIAbility 实例，使系统中只存在<strong>唯一</strong>该 UIAbility 实例，也即任务列表中唯一；</p>
<p>  由于未创建一个新的 UIAbility 实例，因此只会进入 <code>onNewWant()</code> 回调，而不会进入 <code>onCreate()</code> 和 <code>onWindowStageCreate()</code> 生命周期回调；</p>
<p>  在 module.json5 文件中的 launchType 字段配置为 singleton：</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line">     <span class="attr">&quot;abilities&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">       <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;launchType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;singleton&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment">// ...</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>multiton（多实例模式）：</p>
<p>  每次调用 <code>startAbility()</code> 方法时，都会在应用进程中创建一个新的该类型 UIAbility 实例；</p>
<p>  在 module.json5 配置文件中的 launchType 字段配置为 multiton；</p>
</li>
<li><p>specified（指定实例模式）：</p>
<p>  针对一些特殊场景使用；例如，文档应用中每次新建文档希望都能新建一个文档实例，重复打开一个已保存的文档希望打开的都是同一个文档实例；</p>
<p>  存在 EntryAbility 和 SpecifiedAbility，SpecifiedAbility 配置为指定实例模式启动，且需要从 EntryAbility 的页面中启动；</p>
<ol>
<li><p>在 SpecifiedAbility 中，将 module.json5 配置文件的 launchType 字段配置为 specified；</p>
</li>
<li><p>在创建 UIAbility 实例之前，开发者可以为该实例指定一个唯一的字符串 Key，这样在调用 <code>startAbility()</code> 方法时，应用就可以根据指定的 Key 来识别响应请求的 UIAbility 实例；</p>
<p> 在 EntryAbility 中，调用 <code>startAbility()</code> 方法时，可以在 want 参数中增加一个自定义参数，例如 instanceKey，以此来区分不同的 UIAbility 实例；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gan 果然根本没办法运行起来 @ohos.base甚至是openHarmony的API Context怎么获取也不清楚 吐了 抽象教程</span></span><br><span class="line"><span class="comment">// 在启动指定实例模式的UIAbility时，给每一个UIAbility实例配置一个独立的Key标识</span></span><br><span class="line"><span class="comment">// 例如在文档使用场景中，可以用文档路径作为Key标识</span></span><br><span class="line"><span class="keyword">import</span> common <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Want</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.Want&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ohos.base&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getInstance</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;key&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">context</span>:common.<span class="property">UIAbilityContext</span> = ...; <span class="comment">// context为调用方UIAbility的UIAbilityContext</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">want</span>: <span class="title class_">Want</span> = &#123;</span><br><span class="line">  <span class="attr">deviceId</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// deviceId为空表示本设备</span></span><br><span class="line">  <span class="attr">bundleName</span>: <span class="string">&#x27;com.example.myapplication&#x27;</span>,</span><br><span class="line">  <span class="attr">abilityName</span>: <span class="string">&#x27;SpecifiedAbility&#x27;</span>,</span><br><span class="line">  <span class="attr">moduleName</span>: <span class="string">&#x27;specified&#x27;</span>, <span class="comment">// moduleName非必选</span></span><br><span class="line">  <span class="attr">parameters</span>: &#123; <span class="comment">// 自定义信息</span></span><br><span class="line">    <span class="attr">instanceKey</span>: <span class="title function_">getInstance</span>(),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">context.<span class="title function_">startAbility</span>(want).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Succeeded in starting ability.&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err: BusinessError</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`Failed to start ability. Code is <span class="subst">$&#123;err.code&#125;</span>, message is <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于 SpecifiedAbility 的启动模式被配置为指定实例启动模式，因此在 SpecifiedAbility 启动之前，会先进入对应的 AbilityStage 的 <code>onAcceptWant()</code> 生命周期回调中，以获取该 UIAbility 实例的Key值；然后系统会自动匹配：</p>
<ul>
<li>如果存在与该 UIAbility 实例匹配的 Key，则会启动与之绑定的 UIAbility 实例，并进入该 UIAbility 实例的 <code>onNewWant()</code> 回调函数；</li>
<li>否则会创建一个新的 UIAbility 实例，并进入该 UIAbility 实例的 <code>onCreate()</code> 回调函数和 <code>onWindowStageCreate()</code> 回调函数；</li>
</ul>
<p> 示例代码中，通过实现 <code>onAcceptWant()</code> 生命周期回调函数，解析传入的 want 参数，获取自定义参数 instanceKey；业务逻辑会根据这个参数返回一个字符串 Key，用于标识当前 UIAbility 实例；如果返回的 Key 已经对应一个已启动的 UIAbility 实例，系统会将该 UIAbility 实例拉回前台并获焦，而不会创建新的实例；如果返回的 Key 没有对应已启动的 UIAbility 实例，则系统会创建新的 UIAbility 实例并启动；</p>
<blockquote>
<p>注意：DevEco Studio 默认工程中未自动生成 AbilityStage，需先创建 AbilityStage 文件；</p>
</blockquote>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">AbilityStage</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.AbilityStage&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Want</span> <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.Want&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyAbilityStage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbilityStage</span> &#123;</span><br><span class="line">  <span class="title function_">onAcceptWant</span>(<span class="attr">want</span>: <span class="title class_">Want</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="comment">// 在被调用方的AbilityStage中，针对启动模式为specified的UIAbility返回一个UIAbility实例对应的一个Key值</span></span><br><span class="line">    <span class="comment">// 当前示例指的是module1 Module的SpecifiedAbility</span></span><br><span class="line">    <span class="keyword">if</span> (want.<span class="property">abilityName</span> === <span class="string">&#x27;SpecifiedAbility&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 返回的字符串Key标识为自定义拼接的字符串内容</span></span><br><span class="line">      <span class="keyword">if</span> (want.<span class="property">parameters</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`SpecifiedAbilityInstance_<span class="subst">$&#123;want.parameters.instanceKey&#125;</span>`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<br>

<h1 id="组件详解"><a href="#组件详解" class="headerlink" title="组件详解"></a>组件详解</h1><br>

<h2 id="常用基础组件"><a href="#常用基础组件" class="headerlink" title="常用基础组件"></a>常用基础组件</h2><p>组件（Component）是界面搭建与显示的最小单位，HarmonyOS ArkUI 声明式开发范式为开发者提供了丰富多样的 UI 组件；</p>
<p>组件根据功能可以分为以下五大类：<strong>基础组件</strong>、<strong>容器组件</strong>、<strong>媒体组件</strong>、<strong>绘制组件</strong>、<strong>画布组件</strong>；</p>
<p>其中，基础组件是视图层的基本组成单元，包括 Text、Image、TextInput、Button、LoadingProgress 等；</p>
<br>

<h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><p>用于在界面上展示一段文本信息，可以包含子组件 Span；</p>
<ul>
<li><p><strong>文本样式</strong></p>
<p>  针对包含文本元素的组件，例如 Text、Span、Button、TextInput 等，都可设置文本样式；</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>参数类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>fontColor</td>
<td>ResourceColor</td>
<td>设置文本颜色</td>
</tr>
<tr>
<td>fontSize</td>
<td>Length、Resource</td>
<td>设置文本尺寸，Length 为 number 类型时，使用 fp 单位</td>
</tr>
<tr>
<td>fontStyle</td>
<td>FontStyle</td>
<td>设置文本的字体样式；默认值：FontStyle.Normal</td>
</tr>
<tr>
<td>fontWeight</td>
<td>number、FontWeight、string</td>
<td>设置文本的字体粗细；默认值：FontWeight.Normal<br>number 类型取值 [100, 900]，取值间隔为 100，默认 400<br>string 类型支持 “400” 以及 “bold”、“bolder”、“lighter”、“regular”、“medium”</td>
</tr>
<tr>
<td>fontFamily</td>
<td>string、Resource</td>
<td>设置文本的字体列表；使用多个字体，使用“,”进行分割，优先级按顺序生效</td>
</tr>
</tbody></table>
</li>
<li><p><strong>设置文本对齐方式</strong></p>
<p>  textAlign 参数类型为 TextAlign，定义了以下几种类型：TextAlign.Start、TextAlign.Center、TextAlign.End；</p>
</li>
<li><p><strong>设置文本超长显示</strong></p>
<p>  当文本内容超出 Text 组件范围时，可以使用 textOverflow 设置文本截取方式，需配合 maxLines 使用；</p>
<p>  例如，将 textOverflow 设置为 Ellipsis，它将显示不下的文本用 “…” 表示：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;This is the text content of Text Component This is the text content of Text Component&#x27;</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">  .<span class="title function_">maxLines</span>(<span class="number">1</span>)</span><br><span class="line">  .<span class="title function_">textOverflow</span>(&#123;<span class="attr">overflow</span>:<span class="title class_">TextOverflow</span>.<span class="property">Ellipsis</span>&#125;)</span><br><span class="line">  .<span class="title function_">backgroundColor</span>(<span class="number">0xE6F2FD</span>) </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>设置文本装饰线</strong></p>
<p>  decoration 包含 <strong>type</strong> 和 <strong>color</strong> 两个参数，其中 type 用于设置装饰线样式，参数类型为 TextDecorationType，color 为可选参数；</p>
<p>  TextDecorationTyp 包含以下几种类型：None、Overline、LineThrough、Underline；</p>
<p>  例如，设置黑色下划线：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Text</span>(<span class="string">&#x27;HarmonyOS&#x27;</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">  .<span class="title function_">decoration</span>(&#123; <span class="attr">type</span>: <span class="title class_">TextDecorationType</span>.<span class="property">Underline</span>, <span class="attr">color</span>: <span class="title class_">Color</span>.<span class="property">Black</span> &#125;)</span><br><span class="line">  .<span class="title function_">backgroundColor</span>(<span class="number">0xE6F2FD</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><p>用于渲染展示图片，需设置图片地址、宽和高：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Image</span>($r(<span class="string">&quot;app.media.image2&quot;</span>))</span><br><span class="line">  <span class="comment">//.objectFit(ImageFit.Cover)</span></span><br><span class="line">  <span class="comment">//.backgroundColor(0xCCCCCC)</span></span><br><span class="line">  .<span class="title function_">width</span>(<span class="number">100</span>)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="number">100</span>) </span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>设置缩放类型</strong></p>
<p>  可以使用 objectFit 属性设置图片的缩放类型，objectFit 的参数类型为 ImageFit；</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Contain</td>
<td>保持宽高比进行缩小或者放大，使得图片完全显示在显示边界内</td>
</tr>
<tr>
<td>Cover（默认值）</td>
<td>保持宽高比进行缩小或者放大，使得图片两边都大于或等于显示边界</td>
</tr>
<tr>
<td>Auto</td>
<td>自适应显示</td>
</tr>
<tr>
<td>Fill</td>
<td>不保持宽高比进行放大缩小，使得图片充满显示边界</td>
</tr>
<tr>
<td>ScaleDown</td>
<td>保持宽高比显示，图片缩小或者保持不变</td>
</tr>
<tr>
<td>None</td>
<td>保持原有尺寸显示</td>
</tr>
</tbody></table>
</li>
<li><p><strong>加载网络图片</strong></p>
<p>  Image 组件支持加载网络图片，将图片地址换成网络图片地址进行加载；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Image</span>(<span class="string">&#x27;https://www.example.com/xxx.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>  为了成功加载网络图片，需要先在 module.json5 文件中申明网络访问权限；HarmonyOS 提供了一种访问控制机制即应用权限，用来保证这些数据或功能不会被不当或恶意使用；</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;requestPermissions&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">           <span class="punctuation">&#123;</span></span><br><span class="line">             <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ohos.permission.INTERNET&quot;</span></span><br><span class="line">           <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="TextInput"><a href="#TextInput" class="headerlink" title="TextInput"></a>TextInput</h3><p>用于输入单行文本，响应输入事件，支持文本样式设置：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">TextInput</span>()</span><br><span class="line">  .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">  .<span class="title function_">fontStyle</span>(<span class="title class_">FontStyle</span>.<span class="property">Italic</span>)</span><br><span class="line">  .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">  .<span class="title function_">fontFamily</span>(<span class="string">&#x27;Arial&#x27;</span>) </span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>设置输入提示文本</strong></p>
<p>  使用 placeholder 属性设置文本，并可以使用 placeholderColor 和 placeholderFont 分别设置提示文本的颜色和样式：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;请输入帐号&#x27;</span> &#125;)</span><br><span class="line">  .<span class="title function_">placeholderColor</span>(<span class="number">0x999999</span>)</span><br><span class="line">  .<span class="title function_">placeholderFont</span>(&#123; <span class="attr">size</span>: <span class="number">20</span>, <span class="attr">weight</span>: <span class="title class_">FontWeight</span>.<span class="property">Medium</span>, <span class="attr">family</span>: <span class="string">&#x27;cursive&#x27;</span>, <span class="attr">style</span>: <span class="title class_">FontStyle</span>.<span class="property">Italic</span> &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>设置输入类型</strong></p>
<p>  使用 type 属性来设置输入框类型：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;请输入密码&#x27;</span> &#125;)</span><br><span class="line">  .<span class="title function_">type</span>(<span class="title class_">InputType</span>.<span class="property">Password</span>)</span><br></pre></td></tr></table></figure>

<p>  type 的参数类型为 InputType，包含以下几种输入类型：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Normal</td>
<td>基本输入模式；支持输入数字、字母、下划线、空格、特殊字符</td>
</tr>
<tr>
<td>Password</td>
<td>密码输入模式</td>
</tr>
<tr>
<td>Email</td>
<td>e-mail 地址输入模式</td>
</tr>
<tr>
<td>Number</td>
<td>纯数字输入模式</td>
</tr>
</tbody></table>
</li>
<li><p><strong>设置光标位置</strong></p>
<p>  可以使用 TextInputController 动态设置光位置；</p>
<p>  例如，使用 TextInputController 的 <code>caretPosition()</code> 方法，将光标移动到了第二个字符后：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TextInputDemo</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">TextInputController</span> = <span class="keyword">new</span> <span class="title class_">TextInputController</span>()</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">TextInput</span>(&#123; <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;设置光标位置&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">caretPosition</span>(<span class="number">2</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="number">0xE6F2FD</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取输入文本</strong></p>
<p>  给 TextInput 设置 onChange 事件，输入文本发生变化时触发回调；</p>
<p>  例如，value 为实时获取用户输入的文本信息：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TextInputDemo</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">text</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">TextInput</span>(&#123; <span class="attr">placeholder</span>: <span class="string">&#x27;请输入账号&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">caretColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">        .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">text</span> = value</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">text</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">12</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="number">0xE6F2FD</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="Button"><a href="#Button" class="headerlink" title="Button"></a>Button</h3><p>用于响应点击操作，可以包含子组件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;登录&#x27;</span>, &#123; <span class="attr">type</span>: <span class="title class_">ButtonType</span>.<span class="property">Capsule</span>, <span class="attr">stateEffect</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;90%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="number">40</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">  .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Medium</span>)</span><br><span class="line">  .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#007DFF&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>其中，ButtonType.Capsule 表示胶囊形按钮；stateEffect 用于设置按钮按下时是否开启切换效果，默认为 true；</p>
<ul>
<li><p><strong>设置按钮样式</strong></p>
<p>  用于定义按钮样式；</p>
<table>
<thead>
<tr>
<th>样式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Capsule</td>
<td>胶囊型按钮（圆角默认为高度的一半）</td>
</tr>
<tr>
<td>Circle</td>
<td>圆形按钮</td>
</tr>
<tr>
<td>Normal</td>
<td>普通按钮（默认不带圆角）</td>
</tr>
</tbody></table>
</li>
<li><p><strong>设置按钮点击事件</strong></p>
<p>  可以给 Button 绑定 onClick 事件，每当用户点击 Button 的时候，就会回调里面的代码；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;登录&#x27;</span>, &#123; <span class="attr">type</span>: <span class="title class_">ButtonType</span>.<span class="property">Capsule</span>, <span class="attr">stateEffect</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  ...</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 处理点击事件逻辑</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>包含子组件</strong></p>
<p>  Button 组件可以包含子组件，让开发者可以开发出更丰富多样的 Button；</p>
<p>  例如，Button 组件中包含了一个 Image 组件：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(&#123; <span class="attr">type</span>: <span class="title class_">ButtonType</span>.<span class="property">Circle</span>, <span class="attr">stateEffect</span>: <span class="literal">true</span> &#125;) &#123;</span><br><span class="line">  <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.icon_delete&#x27;</span>))</span><br><span class="line">    .<span class="title function_">width</span>(<span class="number">30</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">30</span>)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">width</span>(<span class="number">55</span>)</span><br><span class="line">.<span class="title function_">height</span>(<span class="number">55</span>)</span><br><span class="line">.<span class="title function_">backgroundColor</span>(<span class="number">0x317aff</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="LoadingProgress"><a href="#LoadingProgress" class="headerlink" title="LoadingProgress"></a>LoadingProgress</h3><p>用于显示加载进展，需要设置颜色和宽高；例如，显示的“正在登录”的进度条状态；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">LoadingProgress</span>()</span><br><span class="line">  .<span class="title function_">color</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="number">60</span>)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="number">60</span>)</span><br></pre></td></tr></table></figure>

<img src="11.gif" style="zoom:80%;" />

<br>

<h3 id="r-‘x-x-x’"><a href="#r-‘x-x-x’" class="headerlink" title="$r(‘x.x.x’)"></a>$r(‘x.x.x’)</h3><p>即资源引用类型，用于设置组件属性的值；</p>
<p>推荐优先使用 Resource 类型，将资源文件（字符串、图片、音频等）统一存放于 resources 目录下，便于开发者统一维护；同时系统可以根据当前配置加载合适的资源，例如，开发者可以根据屏幕尺寸呈现不同的布局效果，或根据语言设置提供不同的字符串；</p>
<p>例如，直接在代码中写入了字符串和数字这样的硬编码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;登录&#x27;</span>, &#123; <span class="attr">type</span>: <span class="title class_">ButtonType</span>.<span class="property">Capsule</span>, <span class="attr">stateEffect</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="number">300</span>)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="number">40</span>)</span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">  .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Medium</span>)</span><br><span class="line">  .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#007DFF&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>开发者可以将这些硬编码写到 entry&#x2F;src&#x2F;main&#x2F;resources 下的资源文件中；</p>
<ul>
<li><p>在 string.json 中定义 Button 显示的文本：</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;string&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;login_text&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;登录&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span> </span><br></pre></td></tr></table></figure>
</li>
<li><p>在 float.json 中定义 Button 的宽高和字体大小：</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;float&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;button_width&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;300vp&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;button_height&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;40vp&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;login_fontSize&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18fp&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 color.json 中定义 Button 的背景颜色：</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;button_color&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#1890ff&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">**最后**，在 Button 组件通过 `$r(&#x27;app.type.name&#x27;)` 的形式引用应用资源；</span><br><span class="line"></span><br><span class="line">- app 代表应用内 resources 目录中定义的资源；</span><br><span class="line">- type 代表资源类型（或资源的存放位置），可以取“color”、“float”、“string”、“plural”、“media”；</span><br><span class="line">- name 代表资源命名，由开发者定义资源时确定；</span><br><span class="line"></span><br><span class="line">```typescript</span><br><span class="line">Button($r(&#x27;app.string.login_text&#x27;)<span class="punctuation">,</span> <span class="punctuation">&#123;</span> type<span class="punctuation">:</span> ButtonType.Capsule <span class="punctuation">&#125;</span>)</span><br><span class="line">  .width($r(&#x27;app.float.button_width&#x27;))</span><br><span class="line">  .height($r(&#x27;app.float.button_height&#x27;))</span><br><span class="line">  .fontSize($r(&#x27;app.float.login_fontSize&#x27;))</span><br><span class="line">  .backgroundColor($r(&#x27;app.color.button_color&#x27;))</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="Column-amp-Row-组件"><a href="#Column-amp-Row-组件" class="headerlink" title="Column&amp;Row 组件"></a>Column&amp;Row 组件</h2><p>容器组件是一种比较特殊的组件，它可以包含其他的组件，而且按照一定的规律布局，帮助开发者生成精美的页面；容器组件除了放置基础组件外，也可以放置容器组件，通过多层布局的嵌套，可以布局出更丰富的页面；</p>
<p>ArkTS 提供了丰富的容器组件来布局页面，本文将以构建登录页面为例，介绍 Column 和 Row 组件的属性与使用；</p>
<img src="12.png" style="zoom: 80%;" />

<br>

<h3 id="概念介绍"><a href="#概念介绍" class="headerlink" title="概念介绍"></a>概念介绍</h3><br>

<h4 id="布局容器概念"><a href="#布局容器概念" class="headerlink" title="布局容器概念"></a>布局容器概念</h4><p>线性布局容器表示按照垂直方向或者水平方向排列子组件的容器，ArkTS 提供了 Column 和 Row 容器来实现线性布局；</p>
<ul>
<li>Column 表示沿垂直方向布局的容器；</li>
<li>Row 表示沿水平方向布局的容器；</li>
</ul>
<br>

<h4 id="主轴和交叉轴概念"><a href="#主轴和交叉轴概念" class="headerlink" title="主轴和交叉轴概念"></a>主轴和交叉轴概念</h4><p>在布局容器中，默认存在两根轴，分别是主轴和交叉轴，这两个轴始终是相互垂直的；不同的容器中主轴的方向不一样的；</p>
<ul>
<li><strong>主轴</strong>：Column 容器的主轴的方向是垂直方向；Row 容器的主轴的方向是水平方向；</li>
<li><strong>交叉轴</strong>：与主轴垂直相交的轴线；</li>
</ul>
<br>

<h3 id="属性介绍"><a href="#属性介绍" class="headerlink" title="属性介绍"></a>属性介绍</h3><p>以下将详细讲解 Column 和 Row 容器的两个属性 justifyContent 和 alignItems：</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>justifyContent</td>
<td>设置子组件在<strong>主轴方向</strong>上的对齐格式</td>
</tr>
<tr>
<td>alignItems</td>
<td>设置子组件在<strong>交叉轴方向</strong>上的对齐格式</td>
</tr>
</tbody></table>
<br>

<h4 id="主轴方向的对齐"><a href="#主轴方向的对齐" class="headerlink" title="主轴方向的对齐"></a>主轴方向的对齐</h4><p>子组件在主轴方向上的对齐使用 justifyContent 属性来设置，其参数类型是 FlexAlign；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Row</span>() &#123;</span><br><span class="line">  <span class="title class_">Text</span>($r(…)) </span><br><span class="line">  <span class="title class_">Text</span>($r(…)) </span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>FlexAlign 定义了以下几种类型：</p>
<ul>
<li><p>Start：元素在主轴方向首端对齐，第一个元素与行首对齐，同时后续的元素与前一个对齐；</p>
  <img src="13.png" style="zoom:50%;" />
</li>
<li><p>Center：元素在主轴方向中心对齐，第一个元素与行首的距离以及最后一个元素与行尾距离相同；</p>
  <img src="14.png" style="zoom:50%;" />
</li>
<li><p>End：元素在主轴方向尾部对齐，最后一个元素与行尾对齐，其他元素与后一个对齐；</p>
  <img src="15.png" style="zoom:50%;" />
</li>
<li><p>SpaceBetween：元素在主轴方向均匀分配弹性元素，相邻元素之间距离相同；且第一个元素与行首对齐，最后一个元素与行尾对齐；</p>
  <img src="16.png" style="zoom:50%;" />
</li>
<li><p>SpaceAround：元素在主轴方向均匀分配弹性元素，相邻元素之间距离相同；第一个元素到行首的距离和最后一个元素到行尾的距离是相邻元素之间距离的一半；</p>
  <img src="19.png" style="zoom:50%;" />
</li>
<li><p>SpaceEvenly：元素在主轴方向等间距布局，无论是相邻元素还是边界元素到容器的间距都一样；</p>
  <img src="17.png" style="zoom:50%;" /></li>
</ul>
<br>

<h4 id="交叉轴方向的对齐"><a href="#交叉轴方向的对齐" class="headerlink" title="交叉轴方向的对齐"></a>交叉轴方向的对齐</h4><p>子组件在交叉轴方向上的对齐方式使用 alignItems 属性来设置；</p>
<p>Column 容器的交叉轴是水平方向，其参数类型为 HorizontalAlign（水平对齐）；Row 容器的交叉轴是垂直方向，其参数类型为 VerticalAlign（垂直对齐）；</p>
<p>HorizontalAlign 和 VerticalAlign 分别定义了以下几种类型（括号内为 VerticalAlign 的类型）：</p>
<ul>
<li><p>Start（Top）：设置子组件在水平方向上按照起始端对齐；</p>
  <img src="18.png" style="zoom:50%;" />
</li>
<li><p>Center（默认值）：设置子组件在水平方向上居中对齐；</p>
  <img src="20.png" style="zoom:50%;" />
</li>
<li><p>End（Bottom）：设置子组件在水平方向上按照末端对齐；</p>
  <img src="21.png" style="zoom:50%;" />

  <br></li>
</ul>
<h3 id="接口介绍"><a href="#接口介绍" class="headerlink" title="接口介绍"></a>接口介绍</h3><table>
<thead>
<tr>
<th>容器组件</th>
<th>接口</th>
</tr>
</thead>
<tbody><tr>
<td>Column</td>
<td>Column(value?:{space?: string | number})</td>
</tr>
<tr>
<td>Row</td>
<td>Row(value?:{space?: string | number})</td>
</tr>
</tbody></table>
<p>Column 和 Row 容器的接口都有一个可选参数 space，表示子组件在主轴方向上的间距；</p>
<br>

<h2 id="List-amp-Grid-组件"><a href="#List-amp-Grid-组件" class="headerlink" title="List&amp;Grid 组件"></a>List&amp;Grid 组件</h2><p>为了帮助开发者构建包含列表的应用，ArkUI 提供了 List 组件和 Grid 组件；</p>
<br>

<h3 id="List-组件"><a href="#List-组件" class="headerlink" title="List 组件"></a>List 组件</h3><p>List 是很常用的滚动类容器组件，一般和子组件 ListItem 一起使用，List 列表中的每一个列表项对应一个 ListItem 组件；</p>
<img src="22.png" style="zoom:50%;" />

<br>

<h4 id="ForEach-渲染列表"><a href="#ForEach-渲染列表" class="headerlink" title="ForEach 渲染列表"></a>ForEach 渲染列表</h4><p>使用循环渲染（ForEach）遍历数组的方式构建列表，可以减少重复代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">ListDemo</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">arr</span>: <span class="built_in">number</span>[] = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">arr</span>, <span class="function">(<span class="params">item: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">              .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">              .<span class="title function_">backgroundColor</span>(<span class="number">0x007DFF</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function"><span class="params">item</span> =&gt;</span> item)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">12</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="number">0xF1F3F5</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>在 ForEach 函数的第三个参数中，<code>item =&gt; item</code> 是一个回调函数，也可以称为身份函数或者恒等函数；它指定了如何提取每个元素的键值；在以上代码中，它简单地返回每个元素本身，因此被遍历的数组中的每个元素都会作为其自身的键值；</p>
<br>

<h4 id="列表分割线"><a href="#列表分割线" class="headerlink" title="列表分割线"></a>列表分割线</h4><p>使用 List 组件的 divider 属性设置分割线（默认不存在），其包含四个参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>strokeWidth</td>
<td>分割线的线宽</td>
</tr>
<tr>
<td>color</td>
<td>分割线的颜色</td>
</tr>
<tr>
<td>startMargin</td>
<td>分割线距离列表侧边起始端的距离</td>
</tr>
<tr>
<td>endMargin</td>
<td>分割线距离列表侧边结束端的距离</td>
</tr>
</tbody></table>
<img src="23.png" style="zoom:50%;" />

<br>

<h4 id="滚动事件监听"><a href="#滚动事件监听" class="headerlink" title="滚动事件监听"></a>滚动事件监听</h4><p>List 组件提供了一系列事件方法用来监听列表的滚动，开发者可以根据需要，监听这些事件来做一些操作：</p>
<table>
<thead>
<tr>
<th>事件方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>onScroll</td>
<td>列表滑动时触发，返回值 scrollOffset 为滑动偏移量，scrollState 为当前滑动状态</td>
</tr>
<tr>
<td>onScrollIndex</td>
<td>列表滑动时触发，返回值分别为滑动起始位置索引值与滑动结束位置索引值</td>
</tr>
<tr>
<td>onReachStart</td>
<td>列表到达起始位置时触发</td>
</tr>
<tr>
<td>onReachEnd</td>
<td>列表到底末尾位置时触发</td>
</tr>
<tr>
<td>onScrollStop</td>
<td>列表滑动停止时触发</td>
</tr>
</tbody></table>
<p>示例代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">arr</span>, <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="function"><span class="params">item</span> =&gt;</span> item)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">onScrollIndex</span>(<span class="function">(<span class="params">firstIndex: <span class="built_in">number</span>, lastIndex: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;first&#x27;</span> + firstIndex)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;last&#x27;</span> + lastIndex)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">onScroll</span>(<span class="function">(<span class="params">scrollOffset: <span class="built_in">number</span>, scrollState: ScrollState</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;scrollOffset&#x27;</span> + scrollOffset)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;scrollState&#x27;</span> + scrollState)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">onReachStart</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;onReachStart&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">onReachEnd</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;onReachEnd&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">onScrollStop</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;onScrollStop&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<br>

<h4 id="排列方向"><a href="#排列方向" class="headerlink" title="排列方向"></a>排列方向</h4><p>使用 List 组件的 listDirection 属性进行设置；</p>
<p>listDirection 参数类型是 Axis，定义了以下两种类型：</p>
<ul>
<li>Vertical（默认值）：子组件 ListItem 在 List 容器组件中呈<strong>纵向</strong>排列；</li>
<li>Horizontal：子组件 ListItem 在 List 容器组件中呈<strong>横向</strong>排列；</li>
</ul>
<p>例如，Axis.Horizontal；</p>
<br>

<h3 id="Grid-组件"><a href="#Grid-组件" class="headerlink" title="Grid 组件"></a>Grid 组件</h3><p>Grid 组件为网格容器，是一种网格列表，由“行”和“列”分割的单元格所组成，通过指定“项目”所在的单元格做出各种各样的布局；Grid 组件一般和子组件 GridItem 一起使用，Grid 列表中的每一个条目对应一个 GridItem 组件；</p>
<img src="24.png" style="zoom:50%;" />

<br>

<h4 id="ForEach-渲染网格布局"><a href="#ForEach-渲染网格布局" class="headerlink" title="ForEach 渲染网格布局"></a>ForEach 渲染网格布局</h4><p>和 List 组件一样，Grid 组件也可以使用 ForEach 来渲染多个列表项 GridItem；</p>
<p>例如，创建 16 个 GridItem 列表项：</p>
<ul>
<li>同时设置 columnsTemplate 的值为 ‘1fr 1fr 1fr 1fr’，表示这个网格为 4 列，将 Grid 允许的宽分为 4 等分，每列占 1 份；</li>
<li>并 rowsTemplate 的值为 ‘1fr 1fr 1fr 1fr’，表示这个网格为 4 行，将 Grid 允许的高分为 4 等分，每行占 1 份；</li>
</ul>
<p>这样就构成了一个 4 行 4 列的网格列表，然后使用 columnsGap 设置列间距为 10vp，使用 rowsGap 设置行间距也为 10vp：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">GridExample</span> &#123;</span><br><span class="line">  <span class="comment">// 定义一个长度为16的数组</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">arr</span>: <span class="built_in">string</span>[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">16</span>).<span class="title function_">fill</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">_, index</span>) =&gt;</span> <span class="string">`item <span class="subst">$&#123;index&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Grid</span>() &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">arr</span>, <span class="function">(<span class="params">item: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(item)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">              .<span class="title function_">backgroundColor</span>(<span class="number">0x007DFF</span>)</span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function"><span class="params">item</span> =&gt;</span> item)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">columnsTemplate</span>(<span class="string">&#x27;1fr 1fr 1fr 1fr&#x27;</span>)</span><br><span class="line">      .<span class="title function_">rowsTemplate</span>(<span class="string">&#x27;1fr 1fr 1fr 1fr&#x27;</span>)</span><br><span class="line">      .<span class="title function_">columnsGap</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">rowsGap</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">300</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">12</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="number">0xF1F3F5</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码中，使用了固定的行数和列数，所以构建出的网格是不可滚动的；</p>
<p>为了通过滚动的方式来显示更多的内容，开发者只需要设置 rowsTemplate 和 columnsTemplate 其中的一个；</p>
<p>例如，将 GridItem 的高度设置为固定值，仅设置 columnsTemplate 属性，不设置 rowsTemplate 属性，就可以实现 Grid 列表的滚动：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Grid</span>() &#123;</span><br><span class="line">  <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">arr</span>, <span class="function">(<span class="params">item: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(item)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="function"><span class="params">item</span> =&gt;</span> item)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="title function_">columnsTemplate</span>(<span class="string">&#x27;1fr 1fr 1fr 1fr&#x27;</span>)</span><br><span class="line">.<span class="title function_">columnsGap</span>(<span class="number">10</span>)</span><br><span class="line">.<span class="title function_">rowsGap</span>(<span class="number">10</span>)</span><br><span class="line">.<span class="title function_">height</span>(<span class="number">300</span>)</span><br></pre></td></tr></table></figure>

<p>此外，Grid 像 List 一样也可以使用 onScrollIndex 来监听列表的滚动；</p>
<br>

<h3 id="列表性能优化"><a href="#列表性能优化" class="headerlink" title="列表性能优化"></a>列表性能优化</h3><p>开发者在使用长列表时，如果直接采用循环渲染方式，会一次性加载所有的列表元素，一方面会导致页面启动时间过长，影响用户体验，另一方面也会增加服务器的压力和流量，加重系统负担；推荐通过以下方式来进行列表性能优化；</p>
<br>

<h4 id="使用数据懒加载"><a href="#使用数据懒加载" class="headerlink" title="使用数据懒加载"></a>使用数据懒加载</h4><p>使用数据懒加载，从数据源中按需迭代加载数据并创建相应组件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BasicDataSource</span> <span class="keyword">implements</span> <span class="title class_">IDataSource</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">listeners</span>: <span class="title class_">DataChangeListener</span>[] = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">totalCount</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">getData</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">any</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">registerDataChangeListener</span>(<span class="attr">listener</span>: <span class="title class_">DataChangeListener</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">indexOf</span>(listener) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;add listener&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">push</span>(listener)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">unregisterDataChangeListener</span>(<span class="attr">listener</span>: <span class="title class_">DataChangeListener</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> pos = <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">indexOf</span>(listener);</span><br><span class="line">    <span class="keyword">if</span> (pos &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;remove listener&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">splice</span>(pos, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notifyDataReload</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataReloaded</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notifyDataAdd</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataAdd</span>(index)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notifyDataChange</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataChange</span>(index)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notifyDataDelete</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataDelete</span>(index)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notifyDataMove</span>(<span class="attr">from</span>: <span class="built_in">number</span>, <span class="attr">to</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> &#123;</span><br><span class="line">      listener.<span class="title function_">onDataMove</span>(<span class="keyword">from</span>, to)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDataSource</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BasicDataSource</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">dataArray</span>: <span class="built_in">string</span>[] = [<span class="string">&#x27;item value: 0&#x27;</span>, <span class="string">&#x27;item value: 1&#x27;</span>, <span class="string">&#x27;item value: 2&#x27;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">totalCount</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">getData</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">any</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataArray</span>[index]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">addData</span>(<span class="attr">index</span>: <span class="built_in">number</span>, <span class="attr">data</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="title function_">splice</span>(index, <span class="number">0</span>, data)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">notifyDataAdd</span>(index)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">pushData</span>(<span class="attr">data</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="title function_">push</span>(data)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">notifyDataAdd</span>(<span class="variable language_">this</span>.<span class="property">dataArray</span>.<span class="property">length</span> - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">MyComponent</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">data</span>: <span class="title class_">MyDataSource</span> = <span class="keyword">new</span> <span class="title class_">MyDataSource</span>()</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">List</span>() &#123;</span><br><span class="line">      <span class="title class_">LazyForEach</span>(<span class="variable language_">this</span>.<span class="property">data</span>, <span class="function">(<span class="params">item: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Row</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(item).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">data</span>.<span class="title function_">pushData</span>(<span class="string">&#x27;item value: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">data</span>.<span class="title function_">totalCount</span>())</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, <span class="function"><span class="params">item</span> =&gt;</span> item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码在页面加载时仅初始化加载三个列表元素，之后每点击一次列表元素，将增加一个列表元素；</p>
<br>

<h4 id="设置-list-组件的宽高"><a href="#设置-list-组件的宽高" class="headerlink" title="设置 list 组件的宽高"></a>设置 list 组件的宽高</h4><p>以下是 Scroll 容器组件嵌套 List 组件加载长列表时的各种情况：</p>
<table>
<thead>
<tr>
<th>情况</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>List 没有设置宽高</td>
<td>布局 List 的所有子组件</td>
</tr>
<tr>
<td>List 设置宽高</td>
<td>布局 List 显示区域内的子组件</td>
</tr>
<tr>
<td>List 使用 ForEach 加载子组件时，无论是否设置 List 的宽高</td>
<td>都会加载所有子组件</td>
</tr>
<tr>
<td>List 使用 LazyForEach 加载子组件时，没有设置 List 的宽高</td>
<td>会加载所有子组件</td>
</tr>
<tr>
<td>List 使用 LazyForEach 加载子组件时，设置了 List 的宽高</td>
<td>会加载 List 显示区域内的子组件</td>
</tr>
</tbody></table>
<p>因此，在以下代码（存在 Scroll）中设置了 List 子组件的宽高：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...  <span class="comment">// BasicDataSource 和 MyDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">MyComponent</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">data</span>: <span class="title class_">MyDataSource</span> = <span class="keyword">new</span> <span class="title class_">MyDataSource</span>()</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Scroll</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>() &#123;</span><br><span class="line">        <span class="title class_">LazyForEach</span>(<span class="variable language_">this</span>.<span class="property">data</span>, <span class="function">(<span class="params">item: <span class="built_in">string</span>, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">&#x27;item value: &#x27;</span> + item + (index + <span class="number">1</span>)).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">margin</span>(<span class="number">10</span>)</span><br><span class="line">          &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="number">500</span>)</span><br><span class="line">    &#125;.<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Pink</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="Tabs-组件"><a href="#Tabs-组件" class="headerlink" title="Tabs 组件"></a>Tabs 组件</h2><p>ArkUI 开发框架提供了一种页签容器组件 Tabs，开发者通过 Tabs 组件可以很容易的实现内容视图的切换；其形式多种多样，不同的页面设计页签不一样，可以把页签设置在底部、顶部或者侧边；</p>
<img src="25.png" style="zoom: 67%;" />

<br>

<h3 id="Tabs-简单使用"><a href="#Tabs-简单使用" class="headerlink" title="Tabs 简单使用"></a>Tabs 简单使用</h3><p>Tabs 组件<strong>仅可</strong>包含子组件 TabContent，每一个页签对应一个内容视图，即 TabContent 组件；</p>
<p>例如，构建一个简单的页签页面：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TabsExample</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">controller</span>: <span class="title class_">TabsController</span> = <span class="keyword">new</span> <span class="title class_">TabsController</span>()</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Tabs</span>(&#123; <span class="attr">barPosition</span>: <span class="title class_">BarPosition</span>.<span class="property">Start</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>().<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Green</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">tabBar</span>(<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>().<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">tabBar</span>(<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>().<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Yellow</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">tabBar</span>(<span class="string">&#x27;yellow&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>().<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Pink</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">tabBar</span>(<span class="string">&#x27;pink&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">barWidth</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置TabBar宽度</span></span><br><span class="line">      .<span class="title function_">barHeight</span>(<span class="number">60</span>) <span class="comment">// 设置TabBar高度</span></span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置Tabs组件宽度</span></span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置Tabs组件高度</span></span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="number">0xF5F5F5</span>) <span class="comment">// 设置Tabs组件背景颜色</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="26.png" style="zoom:85%;" />

<p>以上代码中，Tabs 组件中包含 4 个子组件 TabContent，通过 TabContent 的 tabBar 属性设置 TabBar 的显示内容；使用通用属性 width 和 height 设置了 Tabs 组件的宽高，使用 barWidth 和 barHeight 设置了 TabBar 的宽度和高度；</p>
<blockquote>
<ul>
<li>TabContent 组件不支持设置通用宽度属性，其宽度默认撑满 Tabs 父组件；</li>
<li>TabContent 组件不支持设置通用高度属性，其高度由 Tabs 父组件高度与 TabBar 组件高度决定；</li>
</ul>
</blockquote>
<br>

<h3 id="TabBar-布局模式"><a href="#TabBar-布局模式" class="headerlink" title="TabBar 布局模式"></a>TabBar 布局模式</h3><p>因为 Tabs 的布局模式默认是 Fixed 的，所以 Tabs 的页签是不可滑动的；当页签比较多的时候，可能会导致页签显示不全，将布局模式设置为 Scrollable 的话，可以实现页签的滚动；</p>
<p>Tabs 的布局模式有 Fixed（默认）和 Scrollable 两种：</p>
<ul>
<li><p>BarMode.Fixed：所有 TabBar 平均分配 barWidth 宽度（纵向时平均分配 barHeight 高度），页签不可滚动，效果图如下：</p>
  <img src="27.png" style="zoom:80%;" />
</li>
<li><p>BarMode.Scrollable：每一个 TabBar 均使用实际布局宽度，超过总长度后可滑动：</p>
  <img src="28.png" style="zoom:80%;" />

<p>  例如，将 barMode 设置为 BarMode.Scrollable，实现可滚动的页签：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TabsExample</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">controller</span>: <span class="title class_">TabsController</span> = <span class="keyword">new</span> <span class="title class_">TabsController</span>()</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Tabs</span>(&#123; <span class="attr">barPosition</span>: <span class="title class_">BarPosition</span>.<span class="property">Start</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>()</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Green</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">tabBar</span>(<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>()</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">tabBar</span>(<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">barMode</span>(<span class="title class_">BarMode</span>.<span class="property">Scrollable</span>)</span><br><span class="line">      .<span class="title function_">barWidth</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">barHeight</span>(<span class="number">60</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="TabBar-位置和排列方向"><a href="#TabBar-位置和排列方向" class="headerlink" title="TabBar 位置和排列方向"></a>TabBar 位置和排列方向</h3><p>使用 Tabs 组件接口中的参数 barPosition 设置页签<strong>位置</strong>，可以设置为 BarPosition.Start（默认值）和 BarPosition.End；</p>
<p>使用 vertical 属性设置页签的<strong>排列方向</strong>，当 vertical 的属性值为 false（默认值）时页签横向排列，为 true 时页签纵向排列；</p>
<ul>
<li><p>BarPosition.Start：</p>
<p>  vertical 属性方法设置为 false 时，页签位于容器顶部：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>(&#123; <span class="attr">barPosition</span>: <span class="title class_">BarPosition</span>.<span class="property">Start</span> &#125;) &#123;...&#125;.<span class="title function_">vertical</span>(<span class="literal">false</span>).<span class="title function_">barWidth</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">barHeight</span>(<span class="number">60</span>)</span><br></pre></td></tr></table></figure>

<p>  vertical 属性方法设置为 true 时，页签位于容器左侧：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>(&#123; <span class="attr">barPosition</span>: <span class="title class_">BarPosition</span>.<span class="property">Start</span> &#125;) &#123;...&#125;.<span class="title function_">vertical</span>(<span class="literal">true</span>).<span class="title function_">barWidth</span>(<span class="number">100</span>).<span class="title function_">barHeight</span>(<span class="number">200</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>BarPosition.End：</p>
<p>  vertical 属性方法设置为 false 时，页签位于容器底部：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>(&#123; <span class="attr">barPosition</span>: <span class="title class_">BarPosition</span>.<span class="property">End</span> &#125;) &#123;...&#125;.<span class="title function_">vertical</span>(<span class="literal">false</span>).<span class="title function_">barWidth</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">barHeight</span>(<span class="number">60</span>)</span><br></pre></td></tr></table></figure>

<p>  vertical 属性方法设置为 true 时，页签位于容器右侧：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Tabs</span>(&#123; <span class="attr">barPosition</span>: <span class="title class_">BarPosition</span>.<span class="property">End</span>&#125;) &#123;...&#125;.<span class="title function_">vertical</span>(<span class="literal">true</span>).<span class="title function_">barWidth</span>(<span class="number">100</span>).<span class="title function_">barHeight</span>(<span class="number">200</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="自定义-TabBar-样式"><a href="#自定义-TabBar-样式" class="headerlink" title="自定义 TabBar 样式"></a>自定义 TabBar 样式</h3><p>目标样式如下：</p>
<img src="29.png"  />

<p>TabContent 的 tabBar 属性除了支持 string 类型，还支持使用 @Builder 装饰器修饰的函数；</p>
<p>开发者可以使用 @Builder 装饰器，构造一个生成自定义 TabBar 样式的函数，实现上面的底部页签效果：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TabsExample</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">currentIndex</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">tabsController</span>: <span class="title class_">TabsController</span> = <span class="keyword">new</span> <span class="title class_">TabsController</span>();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span> <span class="title class_">TabBuilder</span>(<span class="attr">title</span>: <span class="built_in">string</span>, <span class="attr">targetIndex</span>: <span class="built_in">number</span>, <span class="attr">selectedImg</span>: <span class="title class_">Resource</span>, <span class="attr">normalImg</span>: <span class="title class_">Resource</span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Image</span>(<span class="variable language_">this</span>.<span class="property">currentIndex</span> === targetIndex ? selectedImg : normalImg)</span><br><span class="line">        .<span class="title function_">size</span>(&#123; <span class="attr">width</span>: <span class="number">25</span>, <span class="attr">height</span>: <span class="number">25</span> &#125;)</span><br><span class="line">      <span class="title class_">Text</span>(title)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">currentIndex</span> === targetIndex ? <span class="string">&#x27;#1698CE&#x27;</span> : <span class="string">&#x27;#6B6B6B&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">    .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentIndex</span> = targetIndex;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tabsController</span>.<span class="title function_">changeIndex</span>(<span class="variable language_">this</span>.<span class="property">currentIndex</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Tabs</span>(&#123; <span class="attr">barPosition</span>: <span class="title class_">BarPosition</span>.<span class="property">End</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">tabsController</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">        <span class="title class_">Column</span>().<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#00CB87&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBuilder</span>(<span class="string">&#x27;首页&#x27;</span>, <span class="number">0</span>, $r(<span class="string">&#x27;app.media.home_selected&#x27;</span>), $r(<span class="string">&#x27;app.media.home_normal&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">      <span class="title class_">TabContent</span>() &#123;</span><br><span class="line">        <span class="title class_">Column</span>().<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#007DFF&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">tabBar</span>(<span class="variable language_">this</span>.<span class="title class_">TabBuilder</span>(<span class="string">&#x27;我的&#x27;</span>, <span class="number">1</span>, $r(<span class="string">&#x27;app.media.mine_selected&#x27;</span>), $r(<span class="string">&#x27;app.media.mine_normal&#x27;</span>)))</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">barWidth</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">barHeight</span>(<span class="number">50</span>)</span><br><span class="line">    .<span class="title function_">onChange</span>(<span class="function">(<span class="params">index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentIndex</span> = index;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 @Builder 修饰 TabBuilder 函数，生成由 Image 和 Text 组成的页签；</li>
<li>同时，给 Tabs 组件设置了 TabsController 控制器，当点击某个页签时，调用 changeIndex 方法进行页签内容切换；</li>
<li>最后，给 Tabs 添加 onChange 事件，当<strong>左右滑动</strong>内容视图的时候，页签样式也会跟着改变；</li>
</ul>
<br>

<h1 id="组件进阶"><a href="#组件进阶" class="headerlink" title="组件进阶"></a>组件进阶</h1><br>

<h2 id="管理组件状态"><a href="#管理组件状态" class="headerlink" title="管理组件状态"></a>管理组件状态</h2><p>ArkUI 作为一种声明式 UI，具有状态驱动 UI 更新的特点；当用户进行界面交互或有外部事件引起状态改变时，状态的变化会触发组件自动更新；</p>
<p>所以在 ArkUI 中，开发者只需要通过一个变量来记录状态，ArkUI 会根据该变量自动更新界面中受影响的部分；</p>
<img src="30.png" style="zoom:40%;" />

<p>ArkUI 框架提供了多种管理状态的装饰器来修饰变量，使用这些装饰器修饰的变量即称为<strong>状态变量</strong>；</p>
<p>在组件范围传递的状态管理常见的场景如下：</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>装饰器</th>
</tr>
</thead>
<tbody><tr>
<td>组件内的状态管理</td>
<td>@State</td>
</tr>
<tr>
<td>从父组件单向同步状态</td>
<td>@Prop</td>
</tr>
<tr>
<td>与父组件双向同步状态</td>
<td>@Link</td>
</tr>
<tr>
<td>跨组件层级双向同步状态</td>
<td>@Provide 和 @Consume</td>
</tr>
</tbody></table>
<p>在实际应用开发中，应用会根据需要封装数据模型；如果需要观察嵌套类对象属性变化，需要使用 @Observed 和 @ObjectLink 装饰器，因为上述表格中的装饰器只能观察到对象的第一层属性变化；</p>
<p>另外，当状态改变，需要对状态变化进行监听做一些相应的操作时，可以使用 @Watch 装饰器来修饰状态；</p>
<br>

<h3 id="State"><a href="#State" class="headerlink" title="@State"></a>@State</h3><p>当需要在组件内使用状态来控制 UI 的不同呈现方式时，可以使用 @State 装饰器；</p>
<p>例如，当点击子目标列表的其中一项，列表项会展开，当再次点击同一项，列表项会收起；</p>
<p>通过 @State 装饰后，框架内部会建立数据与视图间的绑定，当 isExpanded 状态变化时，目标项会随之展开或收起；</p>
<img src="31.png" style="zoom:40%;" />

<p>其具体实现只要用 @State 修饰 isExpanded 变量，定义是否展开状态；然后通过条件渲染，实现是否显示进度调整面板和列表项的高度变化；最后，监听列表项的点击事件，在 onClick 回调中改变 isExpanded 状态：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">TargetListItem</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">isExpanded</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isExpanded</span>) &#123;</span><br><span class="line">          <span class="title class_">Blank</span>()</span><br><span class="line">          <span class="title class_">ProgressEditPanel</span>(...)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">height</span>(<span class="variable language_">this</span>.<span class="property">isExpanded</span> ? $r(<span class="string">&#x27;app.float.expanded_item_height&#x27;</span>) : $r(<span class="string">&#x27;app.float.list_item_height&#x27;</span>))</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isExpanded</span> = !<span class="variable language_">this</span>.<span class="property">isExpanded</span>;</span><br><span class="line">        ...</span><br><span class="line">      &#125;)</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Prop"><a href="#Prop" class="headerlink" title="@Prop"></a>@Prop</h3><p>当子组件中的状态依赖从父组件传递而来时，需要使用 @Prop 装饰器，@Prop 修饰的变量可以和其父组件中的状态建立单向同步关系;当父组件中状态变化时，该状态值也会更新至 @Prop 修饰的变量；对 @Prop 修饰的变量的修改不会影响其父组件中的状态；</p>
<p>例如，在目标管理应用中，当点击“编辑”事件发生时，进入编辑模式，显示取消、全选文本和勾选框，同时显示删除按钮；当点击“取消”事件发生时，退出编辑模式，显示“编辑”文本和“添加子目标”按钮；</p>
<p>整个列表是自定义组件 TargetList，顶部是 Text 组件，底部是一个 Button 组件，中间区域是自定义组件 TargetListItem；</p>
<img src="32.png" style="zoom: 50%;" />

<ul>
<li><p>对于父组件 TargetList，其顶部显示的文本和底部按钮会随编辑模式的变化而变化，因此父组件拥有编辑模式状态；</p>
</li>
<li><p>对于子组件 TargetListItem，其最右侧是否预留位置和显示勾选框也会随编辑模式变化，因此子组件也拥有编辑模式状态；</p>
</li>
</ul>
<blockquote>
<p>@State 修饰的变量不仅是组件内部的状态，也可以作为子组件单向或双向同步的数据源；</p>
</blockquote>
<p>首先，在父组件 TargetList 中，<strong>用 @State 修饰 isEditMode</strong>，定义编辑模式状态；然后利用条件渲染实现根据是否进入编辑模式，显示不同的文本和按钮；同时，在父组件中需要在用户点击时改变状态，触发界面更新；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">TargetList</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">isEditMode</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isEditMode</span>) &#123;</span><br><span class="line">          <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.cancel_button&#x27;</span>))</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">isEditMode</span> = <span class="literal">false</span>;</span><br><span class="line">              ...</span><br><span class="line">            &#125;)</span><br><span class="line">            ...</span><br><span class="line">          <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.select_all_button&#x27;</span>))...</span><br><span class="line">          <span class="title class_">Checkbox</span>()...</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.edit_button&#x27;</span>))</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">isEditMode</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="title class_">CommonConstants</span>.<span class="property">LIST_SPACE</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">targetData</span>, <span class="function">(<span class="params">item: TaskItemBean, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">TargetListItem</span>(&#123;</span><br><span class="line">              <span class="attr">isEditMode</span>: <span class="variable language_">this</span>.<span class="property">isEditMode</span>,</span><br><span class="line">              ...</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">(<span class="params">item, index</span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(item) + index)</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isEditMode</span>) &#123;</span><br><span class="line">        <span class="title class_">Button</span>($r(<span class="string">&#x27;app.string.delete_button&#x27;</span>))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title class_">Button</span>($r(<span class="string">&#x27;app.string.add_task&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，在子组件 TargetListItem 中，使用 @Prop 修饰子组件的 isEditMode 变量，定义子组件的编辑模式状态；然后同样根据是否进入编辑模式，控制目标项最右侧是否预留位置和显示勾选框；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">TargetListItem</span> &#123;</span><br><span class="line">   <span class="meta">@Prop</span> <span class="attr">isEditMode</span>: <span class="built_in">boolean</span>;</span><br><span class="line">   ...</span><br><span class="line">       <span class="title class_">Column</span>() &#123;</span><br><span class="line">        ...</span><br><span class="line">       &#125;</span><br><span class="line">       .<span class="title function_">padding</span>(&#123;</span><br><span class="line">         ...</span><br><span class="line">         <span class="attr">right</span>: <span class="variable language_">this</span>.<span class="property">isEditMode</span> ? $r(<span class="string">&#x27;app.float.list_edit_padding&#x27;</span>) : $r(<span class="string">&#x27;app.float.list_padding&#x27;</span>)</span><br><span class="line">       &#125;)</span><br><span class="line">       ...</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isEditMode</span>) &#123;</span><br><span class="line">         <span class="title class_">Row</span>() &#123;</span><br><span class="line">           <span class="title class_">Checkbox</span>()...</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，在父组件中使用子组件时，将父组件的编辑模式状态 this.isEditMode 传递给子组件的编辑模式状态 isEditMode；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">TargetList</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">isEditMode</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="title class_">CommonConstants</span>.<span class="property">LIST_SPACE</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">targetData</span>, <span class="function">(<span class="params">item: TaskItemBean, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">TargetListItem</span>(&#123;</span><br><span class="line">              <span class="attr">isEditMode</span>: <span class="variable language_">this</span>.<span class="property">isEditMode</span>,</span><br><span class="line">              ...</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">(<span class="params">item, index</span>) =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(item) + index)</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Link"><a href="#Link" class="headerlink" title="@Link"></a>@Link</h3><p>使用 @Link 装饰器，相互绑定父子组件状态进行双向同步；</p>
<p>例如，在目标管理应用中，当用户点击同一个目标，目标项会展开或者收起；当用户点击不同的目标项时，除了被点击的目标项展开，同时前一次被点击的目标项会收起；</p>
<ul>
<li>在子目标列表中，每个列表项都有其位置索引值 index 属性，表示目标项在列表中的位置；</li>
<li>此外，在父组件和每个子组件中都设置 clickIndex 以记录被点击的目标项索引，感知变化，传递变化；</li>
</ul>
<img src="33.png" style="zoom:33%;" />

<p>首先，需要在父组件 TargetList 中定义 clickIndex 状态；其中，父组件的 clickIndex 加上 $ 表示传递的是引用，由于双向同步的独特，不使用 this；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">TargetList</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">clickIndex</span>: <span class="built_in">number</span> = <span class="title class_">CommonConstants</span>.<span class="property">DEFAULT_CLICK_INDEX</span>;</span><br><span class="line">  ...</span><br><span class="line">             <span class="title class_">TargetListItem</span>(&#123;</span><br><span class="line">               <span class="attr">clickIndex</span>: $clickIndex,</span><br><span class="line">              ...</span><br><span class="line">             &#125;)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，在子组件 TargetListItem 中用 @Link 装饰器定义 clickIndex，当点击目标项时，clickIndex 更新为当前目标索引值；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">TargetListItem</span> &#123;</span><br><span class="line">  <span class="meta">@Link</span> <span class="meta">@Watch</span>(<span class="string">&#x27;onClickIndexChanged&#x27;</span>) <span class="attr">clickIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">isExpanded</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onClickIndexChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">clickIndex</span> != <span class="variable language_">this</span>.<span class="property">index</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isExpanded</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">       <span class="title class_">Column</span>() &#123;</span><br><span class="line">        ...</span><br><span class="line">       &#125;</span><br><span class="line">       .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">clickIndex</span> = <span class="variable language_">this</span>.<span class="property">index</span>;</span><br><span class="line">        ...</span><br><span class="line">       &#125;)</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给 TargetListItem 中的 clickIndex 状态加上 <code>@Watch(&quot;onClickIndexChanged&quot;)</code>，表示监听 clickIndex 状态的变化，当 clickIndex 状态变化时，将触发 onClickIndexChanged 回调；</p>
<br>

<h3 id="Provide-amp-Consume"><a href="#Provide-amp-Consume" class="headerlink" title="@Provide&amp;@Consume"></a>@Provide&amp;@Consume</h3><p>跨组件层级双向同步状态是指 @Provide 修饰的状态变量自动对提供者组件的所有后代组件可用，后代组件通过使用 @Consume 装饰的变量来获得对提供的状态变量的访问；</p>
<p>使用 @Provide 的好处是开发者不需要多次将变量在组件间传递；</p>
<br>

<h2 id="Video-组件"><a href="#Video-组件" class="headerlink" title="Video 组件"></a>Video 组件</h2><p>媒体功能是用户最常用的场景之一；</p>
<p>ArkUI 提供的 Video 组件为应用增加基础的视频播放功能；借助 Video 组件，开发者可以实现视频的播放功能并控制其播放状态；</p>
<p>视频支持的规格是：mp4、mkv、webm、TS；</p>
<br>

<h3 id="参数与属性"><a href="#参数与属性" class="headerlink" title="参数与属性"></a>参数与属性</h3><p>Video 组件的接口表达形式为：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Video</span>(<span class="attr">value</span>: &#123;src?: <span class="built_in">string</span> | <span class="title class_">Resource</span>, currentProgressRate?: <span class="built_in">number</span> | <span class="built_in">string</span> |<span class="title class_">PlaybackSpeed</span>, previewUri?: <span class="built_in">string</span> |<span class="title class_">PixelMap</span> | <span class="title class_">Resource</span>, controller?: <span class="title class_">VideoController</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>其中包含四个<strong>可选参数</strong>：</p>
<ul>
<li><p>src：表示视频播放源的路径；</p>
<p>  使用<strong>网络地址</strong>时，如 https，需要在 module.json5 文件中申请网络权限；</p>
<p>  使用<strong>本地地址</strong>时，可以使用媒体库管理模块 medialibrary 来查询公共媒体库中的视频文件；代码如下：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mediaLibrary <span class="keyword">from</span> <span class="string">&#x27;@ohos.multimedia.mediaLibrary&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">queryMediaVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> option = &#123;</span><br><span class="line">    <span class="comment">// 根据媒体类型检索</span></span><br><span class="line">    <span class="attr">selections</span>: mediaLibrary.<span class="property">FileKey</span>.<span class="property">MEDIA_TYPE</span> + <span class="string">&#x27;=?&#x27;</span>,</span><br><span class="line">    <span class="comment">// 媒体类型为视频</span></span><br><span class="line">    <span class="attr">selectionArgs</span>: [mediaLibrary.<span class="property">MediaType</span>.<span class="property">VIDEO</span>.<span class="title function_">toString</span>()]</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> media = mediaLibrary.<span class="title function_">getMediaLibrary</span>(<span class="title function_">getContext</span>(<span class="variable language_">this</span>));</span><br><span class="line">  <span class="comment">// 获取资源文件</span></span><br><span class="line">  <span class="keyword">const</span> fetchFileResult = <span class="keyword">await</span> media.<span class="title function_">getFileAssets</span>(option);</span><br><span class="line">  <span class="comment">// 以获取的第一个文件为例获取视频地址</span></span><br><span class="line">  <span class="keyword">let</span> fileAsset = <span class="keyword">await</span> fetchFileResult.<span class="title function_">getFirstObject</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">source</span> = fileAsset.<span class="property">uri</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  为了方便功能演示，示例中媒体资源需存放在 resources 下的 rawfile 文件夹里；</p>
</li>
<li><p>currentProgressRate：表示视频播放倍速；</p>
<p>  其参数类型为 number，取值支持 0.75，1.0，1.25，1.75，2.0，默认值为 1.0倍速；</p>
</li>
<li><p>previewUri：表示视频未播放时的预览图片路径；</p>
</li>
<li><p>controller：表示视频控制器；</p>
</li>
</ul>
<p>除了支持组件的尺寸设置、位置设置等通用属性外，Video 组件还支持五个<strong>私有属性</strong>：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>参数类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>muted</td>
<td>boolean</td>
<td>是否静音；默认值：false</td>
</tr>
<tr>
<td>autoPlay</td>
<td>boolean</td>
<td>是否自动播放；默认值：false</td>
</tr>
<tr>
<td>controls</td>
<td>boolean</td>
<td>控制视频播放的控制栏是否显示；默认值：true</td>
</tr>
<tr>
<td>objectFit</td>
<td>ImageFit</td>
<td>设置视频显示模式；默认值：Cover</td>
</tr>
<tr>
<td>loop</td>
<td>boolean</td>
<td>是否单个视频循环播放；默认值：false</td>
</tr>
</tbody></table>
<p>其中，objectFit 中视频显示模式包括 Contain、Cover、Auto、Fill、ScaleDown、None 6 种模式，默认情况下使用 ImageFit.Cover（保持宽高比进行缩小或者放大，使得图片两边都大于或等于显示边界），其他效果（如自适应显示、保持原有尺寸显示、不保持宽高比进行缩放等）可以根据具体使用场景&#x2F;设备来进行选择；</p>
<p>选择播放本地视频，视频未播放时的预览图片路径也为本地，代码实现如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">VideoPlayer</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">source</span>: <span class="built_in">string</span> | <span class="title class_">Resource</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">controller</span>: <span class="title class_">VideoController</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">previewUris</span>: <span class="title class_">Resource</span> = $r(<span class="string">&#x27;app.media.preview&#x27;</span>);</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Video</span>(&#123;</span><br><span class="line">        <span class="attr">src</span>: <span class="variable language_">this</span>.<span class="property">source</span>,</span><br><span class="line">        <span class="attr">previewUri</span>: <span class="variable language_">this</span>.<span class="property">previewUris</span>,</span><br><span class="line">        <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span></span><br><span class="line">      &#125;)</span><br><span class="line">        .<span class="title function_">controls</span>(<span class="literal">false</span>) <span class="comment">//不显示控制栏 </span></span><br><span class="line">        .<span class="title function_">autoPlay</span>(<span class="literal">false</span>) <span class="comment">// 手动点击播放 </span></span><br><span class="line">        .<span class="title function_">loop</span>(<span class="literal">false</span>) <span class="comment">// 关闭循环播放 </span></span><br><span class="line">        ...</span><br><span class="line">      <span class="title class_">VideoSlider</span>(&#123; <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="回调事件"><a href="#回调事件" class="headerlink" title="回调事件"></a>回调事件</h3><p>Video 组件能够支持常规的点击、触摸等通用事件，同时也支持 onStart、onPause、onFinish、onError 等事件，具体事件的功能描述见下表：</p>
<table>
<thead>
<tr>
<th>事件名称</th>
<th>功能描述</th>
</tr>
</thead>
<tbody><tr>
<td>onStart(event:() &#x3D;&gt; void)</td>
<td>播放时触发该事件</td>
</tr>
<tr>
<td>onPause(event:() &#x3D;&gt; void)</td>
<td>暂停时触发该事件</td>
</tr>
<tr>
<td>onFinish(event:() &#x3D;&gt; void)</td>
<td>播放结束时触发该事件</td>
</tr>
<tr>
<td>onError(event:() &#x3D;&gt; void)</td>
<td>播放失败时触发该事件</td>
</tr>
<tr>
<td>onPrepared(callback:(event?: { duration: number }) &#x3D;&gt; void)</td>
<td>视频准备完成时触发该事件，通过 duration 可以获取视频时长，单位为s</td>
</tr>
<tr>
<td>onSeeking(callback:(event?: { time: number }) &#x3D;&gt; void)</td>
<td>操作进度条过程时上报时间信息，单位为 s</td>
</tr>
<tr>
<td>onSeeked(callback:(event?: { time: number }) &#x3D;&gt; void)</td>
<td>操作进度条完成后，上报播放时间信息，单位为 s</td>
</tr>
<tr>
<td>onUpdate(callback:(event?: { time: number }) &#x3D;&gt; void)</td>
<td>播放进度变化时触发该事件，单位为 s，更新时间间隔为 250ms</td>
</tr>
<tr>
<td>onFullscreenChange(callback:(event?: { fullscreen: boolean }) &#x3D;&gt; void)</td>
<td>在全屏播放与非全屏播放状态之间切换时触发该事件</td>
</tr>
</tbody></table>
<p>以更新事件、准备事件、失败事件以及点击事件为回调，代码实现如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Video</span>(&#123; ... &#125;)</span><br><span class="line">  .<span class="title function_">onUpdate</span>(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentTime</span> = event.<span class="property">time</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentStringTime</span> = <span class="title function_">changeSliderTime</span>(<span class="variable language_">this</span>.<span class="property">currentTime</span>); <span class="comment">//更新事件 </span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">onPrepared</span>(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    prepared.<span class="title function_">call</span>(<span class="variable language_">this</span>, event); <span class="comment">//准备事件 </span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">onError</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    prompt.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable constant_">COMMON_NUM_DURATION</span>, <span class="comment">//播放失败事件 </span></span><br><span class="line">      <span class="attr">message</span>: <span class="variable constant_">MESSAGE</span></span><br><span class="line">    &#125;);</span><br><span class="line">  ...</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>其中，onUpdate 更新事件在播放进度变化时触发，从 event 中可以获取当前播放进度，从而更新进度条显示事件，比如视频播放时间从24秒更新到30秒；</p>
<br>

<h3 id="自定义控制器"><a href="#自定义控制器" class="headerlink" title="自定义控制器"></a>自定义控制器</h3><p>Video 组件的原生控制器样式相对固定，当我们对页面的布局色调的一致性有所要求，或者在拖动进度条的同时需要显示其百分比进度时，原生控制器就无法满足需要了；</p>
<p>为了实现自定义控制器的进度显示等功能，我们需要通过 Row 容器实现控制器的整体布局，然后借由 Text 组件来显示视频的播放起始时间、进度时间以及视频总时长，最后通过滑动进度条 Slider 组件来实现视频进度条的效果，代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">VideoSlider</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>(...) &#123;</span><br><span class="line">      <span class="title class_">Image</span>(...)</span><br><span class="line">      <span class="title class_">Text</span>(...)</span><br><span class="line">      <span class="title class_">Slider</span>(...)</span><br><span class="line">      <span class="title class_">Text</span>(...)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="34.png" style="zoom: 67%;" />

<p>需要强调的是两个 Text 组件显示的时长是由 Slider 组件的 <code>onChange()</code> 回调事件来进行传递的，而 Text 组件的数值与视频播放进度数值 value 则是通过 @Provide 与 @Consume 装饰器进行的数据联动，具体代码步骤及代码如下：</p>
<ul>
<li><p>获取&#x2F;计算视频时长：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">prepared</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">durationTime</span> = event.<span class="property">duration</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">second</span>: <span class="built_in">number</span> = event.<span class="property">duration</span> % <span class="variable constant_">COMMON_NUM_MINUTE</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">min</span>: <span class="built_in">number</span> = <span class="built_in">parseInt</span>((event.<span class="property">duration</span> / <span class="variable constant_">COMMON_NUM_MINUTE</span>).<span class="title function_">toString</span>());</span><br><span class="line">  <span class="keyword">let</span> head = min &lt; <span class="variable constant_">COMMON_NUM_DOUBLE</span> ? <span class="string">`<span class="subst">$&#123;ZERO_STR&#125;</span><span class="subst">$&#123;min&#125;</span>`</span> : min;</span><br><span class="line">  <span class="keyword">let</span> end = second &lt; <span class="variable constant_">COMMON_NUM_DOUBLE</span> ? <span class="string">`<span class="subst">$&#123;ZERO_STR&#125;</span><span class="subst">$&#123;second&#125;</span>`</span> : second;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">durationStringTime</span> = <span class="string">`<span class="subst">$&#123;head&#125;</span><span class="subst">$&#123;SPLIT&#125;</span><span class="subst">$&#123;end&#125;</span>`</span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置进度条参数及属性：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Slider</span>(&#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">currentTime</span>,</span><br><span class="line">  <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">max</span>: <span class="variable language_">this</span>.<span class="property">durationTime</span>,</span><br><span class="line">  <span class="attr">step</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">style</span>: <span class="title class_">SliderStyle</span>.<span class="property">OutSet</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">blockColor</span>($r(<span class="string">&#x27;app.color.white&#x27;</span>))</span><br><span class="line">  .<span class="title function_">width</span>(<span class="variable constant_">STRING_PERCENT</span>.<span class="property">SLIDER_WITH</span>)</span><br><span class="line">  .<span class="title function_">trackColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">  .<span class="title function_">selectedColor</span>($r(<span class="string">&#x27;app.color.white&#x27;</span>))</span><br><span class="line">  .<span class="title function_">showSteps</span>(<span class="literal">true</span>)</span><br><span class="line">  .<span class="title function_">showTips</span>(<span class="literal">true</span>)</span><br><span class="line">  .<span class="title function_">trackThickness</span>(<span class="variable language_">this</span>.<span class="property">isOpacity</span> ? <span class="variable constant_">SMALL_TRACK_THICK_NESS</span> : <span class="variable constant_">BIG_TRACK_THICK_NESS</span>)</span><br><span class="line">  .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: <span class="built_in">number</span>, mode: SliderChangeMode</span>) =&gt;</span> &#123;...&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>计算当前进度播放时间及添加 onUpdate 回调：</p>
<p>  在播放视频时更新时间进度，为左侧的 Text 组件添加数据联动；</p>
<p>  为 Video 组件添加 onUpdate 事件，在视频播放过程中会不断调用 changeSliderTime 方法获取当前的播放时间并进行计算及单位转化，从而不断刷新进度条的值；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Video</span>(&#123;...&#125;)</span><br><span class="line">  ...</span><br><span class="line">  .<span class="title function_">onUpdate</span>(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentTime</span> = event.<span class="property">time</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentStringTime</span> = <span class="title function_">changeSliderTime</span>(<span class="variable language_">this</span>.<span class="property">currentTime</span>)</span><br><span class="line">  &#125;) </span><br></pre></td></tr></table></figure>

  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">changeSliderTime</span>(<span class="params">value: <span class="built_in">number</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">second</span>: <span class="built_in">number</span> = value % <span class="variable constant_">COMMON_NUM_MINUTE</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">min</span>: <span class="built_in">number</span> = <span class="built_in">parseInt</span>((value / <span class="variable constant_">COMMON_NUM_MINUTE</span>).<span class="title function_">toString</span>());</span><br><span class="line">  <span class="keyword">let</span> head = min &lt; <span class="variable constant_">COMMON_NUM_DOUBLE</span> ? <span class="string">`<span class="subst">$&#123;ZERO_STR&#125;</span><span class="subst">$&#123;min&#125;</span>`</span> : min;</span><br><span class="line">  <span class="keyword">let</span> end = second &lt; <span class="variable constant_">COMMON_NUM_DOUBLE</span> ? <span class="string">`<span class="subst">$&#123;ZERO_STR&#125;</span><span class="subst">$&#123;second&#125;</span>`</span> : second;</span><br><span class="line">  <span class="keyword">let</span> nowTime = <span class="string">`<span class="subst">$&#123;head&#125;</span><span class="subst">$&#123;SPLIT&#125;</span><span class="subst">$&#123;end&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">return</span> nowTime;</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>
</li>
<li><p>指定视频播放进度及添加 onChange 事件回调：</p>
<p>  如需手动进行进度条的拖动，则需要在 Slider 组件中指定播放进度，并为 Slider 组件添加 onChange 事件回调；Slider 滑动时就会触发该事件回调，从而实现将视频定位到进度条当前刷新位置，完成时长组件渲染与视频播放进度数据联动；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Slider</span>(&#123;...&#125;)</span><br><span class="line">  .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: <span class="built_in">number</span>, mode: SliderChangeMode</span>) =&gt;</span> &#123;</span><br><span class="line">    sliderOnchange.<span class="title function_">call</span>(<span class="variable language_">this</span>, value, mode);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sliderOnchange</span>(<span class="params">value: <span class="built_in">number</span>, mode: SliderChangeMode</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">currentTime</span> = <span class="built_in">parseInt</span>(value.<span class="title function_">toString</span>());</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">setCurrentTime</span>(<span class="built_in">parseInt</span>(value.<span class="title function_">toString</span>()), <span class="title class_">SeekMode</span>.<span class="property">Accurate</span>);</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="添加弹窗"><a href="#添加弹窗" class="headerlink" title="添加弹窗"></a>添加弹窗</h2><p>弹窗是一种模态窗口，通常用来展示用户当前需要的或用户必须关注的信息或操作；在弹出框消失之前，用户无法操作其他界面内容；</p>
<p>例如，在执行一些敏感的操作时，比如删除联系人，应该给应用添加弹窗来提示用户是否需要执行该操作；</p>
<p>ArkUI 提供了丰富的弹窗功能，按照功能可以分为以下两类：</p>
<ul>
<li>确认类：例如警告弹窗 AlertDialog；</li>
<li>选择类：包括文本选择弹窗 TextPickerDialog、日期滑动选择弹窗 DatePickerDialog、时间滑动选择弹窗 TimePickerDialog 等；</li>
</ul>
<p>开发者可以根据业务场景，选择不同类型的弹窗；部分弹窗效果图如下：</p>
<img src="35.png" style="zoom:40%;" />

<p>此外，如果需要对弹窗的布局和样式进行自定义，可以使用自定义弹窗 CustomDialog；</p>
<br>

<h3 id="警告弹窗"><a href="#警告弹窗" class="headerlink" title="警告弹窗"></a>警告弹窗</h3><p>警告弹窗 AlertDialog 由以下三部分区域构成，对应下面的示意图：</p>
<ol>
<li>标题区：为可选的；</li>
<li>内容区：显示提示消息；</li>
<li>操作按钮区：用户做”确认“或者”取消“等操作；</li>
</ol>
<img src="36.png" style="zoom: 40%;" />

<p>例如，分别使用 primaryButton 和 secondaryButton 实现“取消”和“删除”操作按钮，操作按钮可以通过 action 响应点击事件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Button</span>(<span class="string">&#x27;点击显示弹窗&#x27;</span>)</span><br><span class="line">  .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;删除联系人&#x27;</span>, <span class="comment">// 标题</span></span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;是否需要删除所选联系人?&#x27;</span>, <span class="comment">// 内容</span></span><br><span class="line">        <span class="attr">autoCancel</span>: <span class="literal">false</span>, <span class="comment">// 点击遮障层时，是否关闭弹窗。</span></span><br><span class="line">        <span class="attr">alignment</span>: <span class="title class_">DialogAlignment</span>.<span class="property">Bottom</span>, <span class="comment">// 弹窗在竖直方向的对齐方式</span></span><br><span class="line">        <span class="attr">offset</span>: &#123; <span class="attr">dx</span>: <span class="number">0</span>, <span class="attr">dy</span>: -<span class="number">20</span> &#125;, <span class="comment">// 弹窗相对alignment位置的偏移量</span></span><br><span class="line">        <span class="attr">primaryButton</span>: &#123;</span><br><span class="line">          <span class="attr">value</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">          <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Callback when the first button is clicked&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">secondaryButton</span>: &#123;</span><br><span class="line">          <span class="attr">value</span>: <span class="string">&#x27;删除&#x27;</span>,</span><br><span class="line">          <span class="attr">fontColor</span>: <span class="string">&#x27;#D94838&#x27;</span>,</span><br><span class="line">          <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Callback when the second button is clicked&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">cancel</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 点击遮障层关闭dialog时的回调</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Closed callbacks&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>例如，构建只包含一个操作按钮的确认弹窗，使用 confirm 响应操作按钮回调：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;提示信息&#x27;</span>,</span><br><span class="line">    <span class="attr">autoCancel</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">alignment</span>: <span class="title class_">DialogAlignment</span>.<span class="property">Bottom</span>,</span><br><span class="line">    <span class="attr">offset</span>: &#123; <span class="attr">dx</span>: <span class="number">0</span>, <span class="attr">dy</span>: -<span class="number">20</span> &#125;,</span><br><span class="line">    <span class="attr">confirm</span>: &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="string">&#x27;确认&#x27;</span>,</span><br><span class="line">      <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Callback when confirm button is clicked&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">cancel</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Closed callbacks&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="文本选择弹窗"><a href="#文本选择弹窗" class="headerlink" title="文本选择弹窗"></a>文本选择弹窗</h3><p>例如，使用 selected 指定弹窗的初始选择项索引为 2；当用户点击“确定”操作按钮后，触发 onAccept 事件回调，将选中的值传递给宿主中的 select 变量；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TextPickerDialogDemo</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">select</span>: <span class="built_in">number</span> = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">fruits</span>: <span class="built_in">string</span>[] = [<span class="string">&#x27;苹果&#x27;</span>, <span class="string">&#x27;橘子&#x27;</span>, <span class="string">&#x27;香蕉&#x27;</span>, <span class="string">&#x27;猕猴桃&#x27;</span>, <span class="string">&#x27;西瓜&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;TextPickerDialog&#x27;</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(<span class="number">20</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">TextPickerDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">            <span class="attr">range</span>: <span class="variable language_">this</span>.<span class="property">fruits</span>, <span class="comment">// 设置文本选择器的选择范围</span></span><br><span class="line">            <span class="attr">selected</span>: <span class="variable language_">this</span>.<span class="property">select</span>, <span class="comment">// 设置初始选中项的索引值。</span></span><br><span class="line">            <span class="attr">onAccept</span>: <span class="function">(<span class="params">value: TextPickerResult</span>) =&gt;</span> &#123; <span class="comment">// 点击弹窗中的“确定”按钮时触发该回调。</span></span><br><span class="line">              <span class="comment">// 设置select为按下确定按钮时候的选中项index，这样当弹窗再次弹出时显示选中的是上一次确定的选项</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">select</span> = value.<span class="property">index</span>;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;TextPickerDialog:onAccept()&quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value));</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onCancel</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 点击弹窗中的“取消”按钮时触发该回调。</span></span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;TextPickerDialog:onCancel()&quot;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onChange</span>: <span class="function">(<span class="params">value: TextPickerResult</span>) =&gt;</span> &#123; <span class="comment">// 滑动弹窗中的选择器使当前选中项改变时触发该回调。</span></span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;TextPickerDialog:onChange()&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value));</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="日期选择弹窗"><a href="#日期选择弹窗" class="headerlink" title="日期选择弹窗"></a>日期选择弹窗</h3><p>DatePickerDialog 的使用非常广泛，例如，输入个人出生日期；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">DatePickerDialogDemo</span> &#123;</span><br><span class="line">  <span class="attr">selectedDate</span>: <span class="title class_">Date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2010-1-1&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&quot;DatePickerDialog&quot;</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(<span class="number">20</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">DatePickerDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">            <span class="attr">start</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;1900-1-1&#x27;</span>), <span class="comment">// 设置选择器的起始日期</span></span><br><span class="line">            <span class="attr">end</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2023-12-31&#x27;</span>), <span class="comment">// 设置选择器的结束日期</span></span><br><span class="line">            <span class="attr">selected</span>: <span class="variable language_">this</span>.<span class="property">selectedDate</span>, <span class="comment">// 设置当前选中的日期</span></span><br><span class="line">            <span class="attr">lunar</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">onAccept</span>: <span class="function">(<span class="params">value: DatePickerResult</span>) =&gt;</span> &#123; <span class="comment">// 点击弹窗中的“确定”按钮时触发该回调</span></span><br><span class="line">              <span class="comment">// 通过Date的setFullYear方法设置按下确定按钮时的日期，这样当弹窗再次弹出时显示选中的是上一次确定的日期</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">selectedDate</span>.<span class="title function_">setFullYear</span>(value.<span class="property">year</span>, value.<span class="property">month</span>, value.<span class="property">day</span>)</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;DatePickerDialog:onAccept()&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value))</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onCancel</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 点击弹窗中的“取消”按钮时触发该回调</span></span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;DatePickerDialog:onCancel()&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onChange</span>: <span class="function">(<span class="params">value: DatePickerResult</span>) =&gt;</span> &#123; <span class="comment">// 滑动弹窗中的滑动选择器使当前选中项改变时触发该回调</span></span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;DatePickerDialog:onChange()&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value))</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="自定义弹窗"><a href="#自定义弹窗" class="headerlink" title="自定义弹窗"></a>自定义弹窗</h3><p>自定义弹窗的界面可以通过装饰器 @CustomDialog 定义的组件来实现，然后结合 CustomDialogController 来控制自定义弹窗的显示和隐藏；</p>
<p>目标实现效果：</p>
<img src="37.png" style="zoom: 50%;" />

<p>使用装饰器 @CustomDialog，结合 List 组件来完成这个弹窗布局，实现步骤如下：</p>
<ol>
<li><p>初始化弹窗数据：</p>
<p> 先准备好<strong>资源文件</strong>和<strong>数据实体类</strong>；</p>
<p> 其中资源文件 stringarray.json 创建在 resources&#x2F;base&#x2F;element 目录下，文件根节点为 strarray；</p>
 <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;strarray&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hobbies_data&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Soccer&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Badminton&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Travelling&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        ... </span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p> 实体类 HobbyBean 用来封装自定义弹窗中的”兴趣爱好”数据：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">HobbyBean</span> &#123;</span><br><span class="line">  <span class="attr">label</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">isChecked</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 然后创建一个 ArkTS 文件 CustomDialogWidget，用来封装自定义弹窗；</p>
<ul>
<li>使用装饰器 @CustomDialog 修饰 CustomDialogWidget 表示这是一个自定义弹窗；</li>
<li>使用资源管理对象 manager 获取数据，并将数据封装到 hobbyBeans；</li>
</ul>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CustomDialog</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">CustomDialogWidget</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">hobbyBeans</span>: <span class="title class_">HobbyBean</span>[] = [];</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">aboutToAppear</span>(<span class="params"></span>) &#123;  <span class="comment">// 弹窗初始化</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">context</span>: <span class="title class_">Context</span> = <span class="title function_">getContext</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">let</span> manager = context.<span class="property">resourceManager</span>;</span><br><span class="line">    manager.<span class="title function_">getStringArrayValue</span>($r(<span class="string">&#x27;app.strarray.hobbies_data&#x27;</span>), <span class="function">(<span class="params">error, hobbyResult</span>) =&gt;</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">      hobbyResult.<span class="title function_">forEach</span>(<span class="function">(<span class="params">hobbyItem: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> hobbyBean = <span class="keyword">new</span> <span class="title class_">HobbyBean</span>();</span><br><span class="line">        hobbyBean.<span class="property">label</span> = hobbyItem;</span><br><span class="line">        hobbyBean.<span class="property">isChecked</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hobbyBeans</span>.<span class="title function_">push</span>(hobbyBean);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建弹窗组件：</p>
<p> controller 对象用于控制弹窗的控制和隐藏，hobbies 表示弹窗选中的数据结果；setHobbiesValue 方法用于筛选出被选中的数据，赋值给 hobbies；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CustomDialog</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">CustomDialogWidget</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">hobbyBeans</span>: <span class="title class_">HobbyBean</span>[] = [];</span><br><span class="line">  <span class="meta">@Link</span> <span class="attr">hobbies</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">private</span> controller?: <span class="title class_">CustomDialogController</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setHobbiesValue</span>(<span class="params">hobbyBeans: HobbyBean[]</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">hobbiesText</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    hobbiesText = hobbyBeans.<span class="title function_">filter</span>(<span class="function">(<span class="params">isCheckItem: HobbyBean</span>) =&gt;</span></span><br><span class="line">    isCheckItem?.<span class="property">isChecked</span>)</span><br><span class="line">      .<span class="title function_">map</span>(<span class="function">(<span class="params">checkedItem: HobbyBean</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> checkedItem.<span class="property">label</span>;</span><br><span class="line">      &#125;).<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hobbies</span> = hobbiesText;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.text_title_hobbies&#x27;</span>))...</span><br><span class="line">      <span class="title class_">List</span>() &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">hobbyBeans</span>, <span class="function">(<span class="params">itemHobby: HobbyBean</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(itemHobby.<span class="property">label</span>)...</span><br><span class="line">              <span class="title class_">Toggle</span>(&#123; <span class="attr">type</span>: <span class="title class_">ToggleType</span>.<span class="property">Checkbox</span>, <span class="attr">isOn</span>: <span class="literal">false</span> &#125;)...</span><br><span class="line">                .<span class="title function_">onChange</span>(<span class="function">(<span class="params">isCheck</span>) =&gt;</span> &#123;</span><br><span class="line">                  itemHobby.<span class="property">isChecked</span> = isCheck;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function"><span class="params">itemHobby</span> =&gt;</span> itemHobby.<span class="property">label</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Button</span>($r(<span class="string">&#x27;app.string.cancel_button&#x27;</span>))...</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">controller</span>?.<span class="title function_">close</span>();</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="title class_">Button</span>($r(<span class="string">&#x27;app.string.definite_button&#x27;</span>))...</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setHobbiesValue</span>(<span class="variable language_">this</span>.<span class="property">hobbyBeans</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">controller</span>?.<span class="title function_">close</span>();</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用自定义弹窗：</p>
<p> 在自定义弹窗的使用页面 HomePage 中先定义一个变量 hobbies，使用装饰器 @State 修饰，和自定义弹窗中的 @Link 装饰器修饰的变量进行双向绑定；</p>
<p> 然后使用 alignment 和 offset 设置弹窗的位置在屏幕底部，并且距离底部 20vp；</p>
<p> 最后在自定义组件 TextCommonWidget 的点击事件中，调用 customDialogController 的 open 方法，用于显示弹窗；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">HomePage</span> &#123;</span><br><span class="line">  <span class="attr">customDialogController</span>: <span class="title class_">CustomDialogController</span> = <span class="keyword">new</span> <span class="title class_">CustomDialogController</span>(&#123;</span><br><span class="line">    <span class="attr">builder</span>: <span class="title class_">CustomDialogWidget</span>(&#123;</span><br><span class="line">      <span class="attr">onConfirm</span>: <span class="variable language_">this</span>.<span class="property">setHobbiesValue</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">alignment</span>: <span class="title class_">DialogAlignment</span>.<span class="property">Bottom</span>,</span><br><span class="line">    <span class="attr">customStyle</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">offset</span>: &#123; <span class="attr">dx</span>: <span class="number">0</span>,<span class="attr">dy</span>: -<span class="number">20</span> &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setHobbiesValue</span>(<span class="params">hobbyArray: HobbyBean[]</span>) &#123;...&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">      <span class="title class_">TextCommonWidget</span>(&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="attr">title</span>: $r(<span class="string">&#x27;app.string.title_hobbies&#x27;</span>),</span><br><span class="line">        <span class="attr">content</span>: $hobby,</span><br><span class="line">        <span class="attr">onItemClick</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">customDialogController</span>.<span class="title function_">open</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<br>

<h2 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h2><p>属性动画，是最为基础的动画，其功能强大、使用场景多，应用范围较广；常用于如下场景中：</p>
<ol>
<li>页面布局发生变化；例如添加、删除部分组件元素；</li>
<li>页面元素的可见性和位置发生变化；例如显示或者隐藏部分元素，或者将部分元素从一端移动到另外一端；</li>
<li>页面中图形图片元素动起来；例如使页面中的静态图片动起来；</li>
</ol>
<p>简单来说，属性动画是组件的通用属性发生改变时而产生的属性渐变效果；其原理是，当组件的通用属性发生改变时，组件状态由初始状态逐渐变为结束状态的过程中，会创建多个连续的中间状态，逐帧播放后，就会形成属性渐变效果，从而形成动画；</p>
<br>

<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p>目标效果如下，以五个图标放大移动动画的为例来讲解如何创建属性动画；</p>
<img src="38.gif" style="zoom:40%;" />

<p>首先，创建一个头部刷新组件 RefreshAnimHeader，在其中自定义一个图标组件 AttrAnimIcons，用 Image 组件将资源图标引入，并设置好样式，如下所示：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">RefreshAnimHeader</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@Builder</span> <span class="title class_">AttrAnimIcons</span>(iconItem) &#123;  </span><br><span class="line">    <span class="title class_">Image</span>(iconItem.<span class="property">imgRes</span>)    </span><br><span class="line">      .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">iconWidth</span>)    </span><br><span class="line">      .<span class="title function_">position</span>(&#123; <span class="attr">x</span>: iconItem.<span class="property">posX</span> &#125;)    </span><br><span class="line">      .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>)    </span><br><span class="line">      .<span class="title function_">animation</span>(&#123;      </span><br><span class="line">        <span class="attr">duration</span>: <span class="number">2000</span>,      </span><br><span class="line">        <span class="attr">tempo</span>: <span class="number">3.0</span>,      </span><br><span class="line">        <span class="attr">delay</span>: iconItem.<span class="property">delay</span>,      </span><br><span class="line">        <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>,      </span><br><span class="line">        <span class="attr">playMode</span>: <span class="title class_">PlayMode</span>.<span class="property">Alternate</span>,      </span><br><span class="line">        <span class="attr">iterations</span>: -<span class="number">1</span></span><br><span class="line">     &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，在 build 方法中使用 Row 容器组件，将自定义的图标组件引入，并设置好样式，同时定义组件状态 iconWidth，添加 onApper 事件，修改 iconWidth 的值，使其从 30 变为 100，以触发 UI 状态更新；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">RefreshAnimHeader</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">iconWidth</span>: <span class="built_in">number</span> = <span class="number">30</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">onStateCheck</span>(<span class="params"></span>) &#123;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="title class_">RefreshState</span>.<span class="property">REFRESHING</span>) &#123;    </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">iconWidth</span> = <span class="number">100</span>;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    </span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">iconWidth</span> = <span class="number">30</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;  </span><br><span class="line">    <span class="title class_">Row</span>() &#123;    </span><br><span class="line">      <span class="title class_">ForEach</span>(<span class="title class_">CommonConstants</span>.<span class="property">REFRESH_HEADER_FEATURE</span>, <span class="function">(<span class="params">iconItem</span>) =&gt;</span> &#123;     </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title class_">AttrAnimIcons</span>(iconItem)    </span><br><span class="line">      &#125;, <span class="function"><span class="params">item</span> =&gt;</span> item.<span class="title function_">toString</span>())  </span><br><span class="line">    &#125;  </span><br><span class="line">     .<span class="title function_">width</span>(<span class="string">&quot;100%&quot;</span>)  </span><br><span class="line">     .<span class="title function_">height</span>(<span class="string">&quot;100%&quot;</span>)  </span><br><span class="line">     .<span class="title function_">onAppear</span>(<span class="function">() =&gt;</span> &#123;    </span><br><span class="line">       <span class="variable language_">this</span>.<span class="title function_">onStateCheck</span>();</span><br><span class="line">     &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：</p>
<ol>
<li><p>animation 属性作用域：其作用域为 animation 之前，即产生属性动画的属性须在 animation 之前声明，其后声明的将不会产生属性动画；</p>
<p> 示例中，产生动画的属性为 Image 组件的 width 属性，故该属性 width 需在 animation 属性之前声明；</p>
</li>
<li><p>产生属性动画的属性变化时需触发 UI 状态更新；</p>
<p> 示例中，产生动画的属性 width，@State 修饰的状态变量 iconWidth 从 30 变为 100；</p>
</li>
<li><p>产生属性动画的属性本身需满足一定的要求，并非任何属性都可以产生属性动画；</p>
<p> 目前支持的属性包括 width、height、position、opacity、backgroundColor、scale、rotate、translate 等；</p>
</li>
</ol>
</blockquote>
<br>

<h3 id="参数调整"><a href="#参数调整" class="headerlink" title="参数调整"></a>参数调整</h3><p>属性动画中 animation 的参数如下：</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>属性类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>duration</td>
<td>number</td>
<td>1000</td>
<td>动画时长，单位为毫秒，默认时长为 1000 毫秒</td>
</tr>
<tr>
<td>tempo</td>
<td>number</td>
<td>1.0</td>
<td>动画的播放速度，值越大动画播放越快，值越小播放越慢，为 0 时无动画效果</td>
</tr>
<tr>
<td>curve</td>
<td>Curve</td>
<td>Curve.Linear</td>
<td>动画变化曲线，默认曲线为线性</td>
</tr>
<tr>
<td>delay</td>
<td>number</td>
<td>0</td>
<td>延时播放时间，单位为毫秒，默认不延时播放</td>
</tr>
<tr>
<td>iterations</td>
<td>number</td>
<td>1</td>
<td>播放次数，默认一次，设置为 -1 时表示无限次播放</td>
</tr>
<tr>
<td>playMode</td>
<td>PlayMode</td>
<td>PlayMode.Normal</td>
<td>设置动画播放模式，默认播放完成后重头开始播放</td>
</tr>
<tr>
<td>onFinish</td>
<td>function</td>
<td>-</td>
<td>动画播放结束时回调该函数</td>
</tr>
</tbody></table>
<ul>
<li><p>其中变化曲线 curve 枚举值为：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Linear</td>
<td>表示动画从头到尾的速度都是相同的</td>
</tr>
<tr>
<td>Ease</td>
<td>表示动画以低速开始，然后加快，在结束前变慢，CubicBezier(0.25, 0.1, 0.25, 1.0)</td>
</tr>
<tr>
<td>EaseIn</td>
<td>表示动画以低速开始，CubicBezier(0.42, 0.0, 1.0, 1.0)</td>
</tr>
<tr>
<td>EaseOut</td>
<td>表示动画以低速结束，CubicBezier(0.0, 0.0, 0.58, 1.0)</td>
</tr>
<tr>
<td>EaseInOut</td>
<td>表示动画以低速开始和结束，CubicBezier(0.42, 0.0, 0.58, 1.0)</td>
</tr>
<tr>
<td>FastOutSlowIn</td>
<td>标准曲线，cubic-bezier(0.4, 0.0, 0.2, 1.0)</td>
</tr>
<tr>
<td>LinearOutSlowIn</td>
<td>减速曲线，cubic-bezier(0.0, 0.0, 0.2, 1.0)</td>
</tr>
<tr>
<td>FastOutLinearIn</td>
<td>加速曲线，cubic-bezier(0.4, 0.0, 1.0, 1.0)</td>
</tr>
<tr>
<td>ExtremeDeceleration</td>
<td>急缓曲线，cubic-bezier(0.0, 0.0, 0.0, 1.0)</td>
</tr>
<tr>
<td>Sharp</td>
<td>锐利曲线，cubic-bezier(0.33, 0.0, 0.67, 1.0)</td>
</tr>
<tr>
<td>Rhythm</td>
<td>节奏曲线，cubic-bezier(0.7, 0.0, 0.2, 1.0)</td>
</tr>
<tr>
<td>Smooth</td>
<td>平滑曲线，cubic-bezier(0.4, 0.0, 0.4, 1.0)</td>
</tr>
<tr>
<td>Friction</td>
<td>阻尼曲线，CubicBezier(0.2, 0.0, 0.2, 1.0)</td>
</tr>
</tbody></table>
</li>
<li><p>播放模式 playMode 枚举值为：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Normal</td>
<td>动画按正常播放</td>
</tr>
<tr>
<td>Reverse</td>
<td>动画反向播放</td>
</tr>
<tr>
<td>Alternate</td>
<td>动画在奇数次（1、3、5…）正向播放，在偶数次（2、4、6…）反向播放</td>
</tr>
<tr>
<td>AlternateReverse</td>
<td>动画在奇数次（1、3、5…）反向播放，在偶数次（2、4、6…）正向播放</td>
</tr>
</tbody></table>
</li>
</ul>
<blockquote>
<p>注意：</p>
<p>在延时间距不超过动画时长 duration 时，总延时间距越接近 duration，秩序性越好，视觉效果越好；</p>
<p>示例中，图标动画时长 duration 为 2000ms，故延时间距为 2000ms&#x2F;5&#x3D;400ms，五个图标的延时参数 delay 可分别设置为 400ms、800ms、1200ms、1600ms、2000ms；</p>
</blockquote>
<p>当根据 iterations 播放结束时，会调用 onFinish 进行后续的业务处理；例如，提示动画播放结束：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Image</span>(iconItem.<span class="property">imgRes</span>)</span><br><span class="line">  ...</span><br><span class="line">  .<span class="title function_">animation</span>(&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;      </span><br><span class="line">      prompt.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>:<span class="string">&quot;动画播放结束！！！&quot;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h3><p>目标效果如下，指将头部刷新组件 RefreshAnimHeader 隐藏起来；</p>
<p>首先，在组件 RefreshAnimHeader 中添加状态变量 state，同时添加条件渲染逻辑，根据 state 的值来判断是否需要关闭；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">RefreshAnimHeader</span> &#123;  </span><br><span class="line">  <span class="meta">@Consume</span>(<span class="title class_">RefreshConstants</span>.<span class="property">REFRESH_STATE_TAG</span>) <span class="meta">@Watch</span>(<span class="string">&#x27;onStateCheck&#x27;</span>) <span class="attr">state</span>: <span class="title class_">RefreshState</span>;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="title class_">RefreshState</span>.<span class="property">IDLE</span>) &#123; <span class="comment">// start or stop animation when idle state.</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="title class_">CommonConstants</span>.<span class="property">REFRESH_HEADER_FEATURE</span>, <span class="function">(<span class="params">iconItem</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title class_">AttrAnimIcons</span>(iconItem)</span><br><span class="line">        &#125;, <span class="function"><span class="params">item</span> =&gt;</span> item.<span class="title function_">toString</span>()&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="title class_">CommonConstants</span>.<span class="property">FULL_LENGTH</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="title class_">CommonConstants</span>.<span class="property">FULL_LENGTH</span>)</span><br><span class="line">    .<span class="title function_">onAppear</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onStateCheck</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，为下方列表添加上移属性动画，通过修改 state 变量的值为 IDLE 状态，关闭属性动画页面；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct <span class="title class_">RefreshComponent</span> &#123;</span><br><span class="line">  <span class="meta">@Consume</span>(<span class="title class_">RefreshConstants</span>.<span class="property">REFRESH_STATE_TAG</span>) <span class="meta">@Watch</span>(<span class="string">&#x27;onStateChanged&#x27;</span>) <span class="attr">state</span>: <span class="title class_">RefreshState</span>;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">List</span>(&#123; <span class="attr">scroller</span>: <span class="variable language_">this</span>.<span class="property">listController</span> &#125;) &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    .<span class="title function_">animation</span>(&#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">headerOffset</span> === -<span class="title class_">RefreshConstants</span>.<span class="property">REFRESH_HEADER_HEIGHT</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">state</span> = <span class="title class_">RefreshState</span>.<span class="property">IDLE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="Web-组件"><a href="#Web-组件" class="headerlink" title="Web 组件"></a>Web 组件</h2><p>ArkUI 提供了 Web 组件来加载网页，相当于在自己的应用程序里嵌入一个浏览器，从而非常轻松地展示各种各样的网页；</p>
<p>本文将介绍 Web 组件一些常用 API 的使用；</p>
<br>

<h3 id="加载网页"><a href="#加载网页" class="headerlink" title="加载网页"></a>加载网页</h3><ul>
<li><p>加载在线网页</p>
<p>  创建一个 Web 组件，传入两个参数，其中 src 指定引用的网页路径，controller 为组件的控制器；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">WebComponent</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">WebController</span> = <span class="keyword">new</span> <span class="title class_">WebController</span>();</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: <span class="string">&#x27;https://developer.harmonyos.com/&#x27;</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  访问在线网页时，需要先在 module.json5 文件中申明网络访问权限：ohos.permission.INTERNET；</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;requestPermissions&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">           <span class="punctuation">&#123;</span></span><br><span class="line">             <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ohos.permission.INTERNET&quot;</span></span><br><span class="line">           <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>加载本地网页</p>
<p>  首先在 main&#x2F;resources&#x2F;rawfile 目录下创建一个 HTML 文件，然后通过 $rawfile 引用本地网页资源：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">SecondPage</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">WebController</span> = <span class="keyword">new</span> <span class="title class_">WebController</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: $rawfile(<span class="string">&#x27;index.html&#x27;</span>), <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="网页缩放"><a href="#网页缩放" class="headerlink" title="网页缩放"></a>网页缩放</h3><p>部分网页不能很好的适配屏幕，开发者可以根据需要给 Web 组件设置 zoomAccess 属性，设置是否支持手势进行缩放，默认允许；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Web</span>(&#123; <span class="attr">src</span>:<span class="string">&#x27;www.example.com&#x27;</span>, <span class="attr">controller</span>:<span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">    .<span class="title function_">zoomAccess</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>还可以使用 <code>zoom(factor: number)</code> 方法用于设置网站的缩放比例，其中 factor 表示缩放倍数；</p>
<p>例如，当点击一次按钮时，页面放大为原来的 1.5 倍；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">WebComponent</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">WebController</span> = <span class="keyword">new</span> <span class="title class_">WebController</span>();</span><br><span class="line">  <span class="attr">factor</span>: <span class="built_in">number</span> = <span class="number">1.5</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;zoom&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">zoom</span>(<span class="variable language_">this</span>.<span class="property">factor</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: <span class="string">&#x27;www.example.com&#x27;</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：只有网页自身支持缩放，才能在Web组件里面进行缩放；</p>
</blockquote>
<p>如果<strong>只</strong>需要对<strong>文本</strong>进行缩放，可以使用 <code>textZoomAtio(textZoomAtio: number)</code> 方法，其中 textZoomAtio 用于设置页面的文本缩放百分比，默认值为 100，表示 100%；</p>
<p>例如，将文本放大为原来的 1.5 倍：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Web</span>(&#123; <span class="attr">src</span>:<span class="string">&#x27;www.example.com&#x27;</span>, <span class="attr">controller</span>:<span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">    .<span class="title function_">textZoomAtio</span>(<span class="number">150</span>)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="回调事件-1"><a href="#回调事件-1" class="headerlink" title="回调事件"></a>回调事件</h3><p>Web 组件还提供了处理 Javascript 的对话框、网页加载进度及各种通知与请求事件的方法；例如：</p>
<ul>
<li>onProgressChange 可以监听网页的加载进度；</li>
<li>onPageEnd 在网页加载完成时触发该回调，且只在主 frame 触发；</li>
<li>onConfirm 则在网页触发 confirm 告警弹窗时触发回调；</li>
</ul>
<p>在 onAlert 或 onConfirm 的回调方法中处理并响应 Web 组件中网页的警告弹窗（JS confirm）事件；</p>
<p>以 confirm 弹窗为例，在网页触发 <code>onConfirm()</code> 时，显示一个 AlertDialog 弹窗：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">WebComponent</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>:<span class="title class_">WebController</span> = <span class="keyword">new</span> <span class="title class_">WebController</span>();</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>:$rawfile(<span class="string">&#x27;index.html&#x27;</span>), <span class="attr">controller</span>:<span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">        .<span class="title function_">onConfirm</span>(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">AlertDialog</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: event.<span class="property">message</span>,</span><br><span class="line">            <span class="attr">confirm</span>: &#123;</span><br><span class="line">              <span class="attr">value</span>: <span class="string">&#x27;onAlert&#x27;</span>,</span><br><span class="line">              <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                event.<span class="property">result</span>.<span class="title function_">handleConfirm</span>();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">cancel</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              event.<span class="property">result</span>.<span class="title function_">handleCancel</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（存疑）当 onConfirm 回调返回 false 时，触发默认弹窗；当回调返回 true 时，系统应用可以调用系统弹窗能力（包括确认和取消），并且需要根据用户的确认或取消操作调用 JsResult 通知 Web 组件；（存疑）</p>
<br>

<h3 id="JavaScript-交互"><a href="#JavaScript-交互" class="headerlink" title="JavaScript 交互"></a>JavaScript 交互</h3><p>在开发专为适配 Web 组件的网页时，可以实现 Web 组件和 JavaScript 代码之间的交互；Web 组件可以调用 JavaScript 方法，JavaScript 也可以调用 Web 组件里面的方法；</p>
<ol>
<li><p>启用 JavaScript：</p>
<p> 如果想要被加载的网页在 Web 组件中运行 JavaScript，则必须先启用 JavaScript 功能，默认开启；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Web</span>(&#123; <span class="attr">src</span>:<span class="string">&#x27;https://www.example.com&#x27;</span>, <span class="attr">controller</span>:<span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">    .<span class="title function_">javaScriptAccess</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Web 组件调用 JS 方法：</p>
<p> 在 onPageEnd 事件中添加 runJavaScript 方法，页面加载完执行 HTML 中的 JavaScript 脚本，并将结果返回给 Web 组件；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">WebComponent</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">WebController</span> = <span class="keyword">new</span> <span class="title class_">WebController</span>();</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">webResult</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">webResult</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: $rawfile(<span class="string">&#x27;index.html&#x27;</span>), <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">      .<span class="title function_">javaScriptAccess</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">onPageEnd</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">runJavaScript</span>(&#123;</span><br><span class="line">          <span class="attr">script</span>: <span class="string">&#x27;test()&#x27;</span>,</span><br><span class="line">          <span class="attr">callback</span>: <span class="function">(<span class="params">result: <span class="built_in">string</span></span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">webResult</span> = result;</span><br><span class="line">          &#125;&#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>JS 调用 Web 组件方法：</p>
<p> 首先，使用 registerJavaScriptProxy 方法将 Web 组件中的 JavaScript 对象注入到 window 对象中；</p>
<p> 然后，调用 refresh 方法使 registerJavaScriptProxy 方法生效，网页中的 JS 可以直接调用该对象；</p>
<p> 例如，将 ets 文件中的对象 testObj 注入到了 window 对象中：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">WebComponent</span>&#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">dataFromHtml</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">WebController</span> = <span class="keyword">new</span> <span class="title class_">WebController</span>()</span><br><span class="line">  testObj = &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dataFromHtml</span> = data；</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;ArkUI Web Component&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">toString</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Web Component toString&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">dataFromHtml</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;Register JavaScript To Window&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">registerJavaScriptProxy</span>(&#123;</span><br><span class="line">            <span class="attr">object</span>: <span class="variable language_">this</span>.<span class="property">testObj</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;objName&#x27;</span>,</span><br><span class="line">            <span class="attr">methodList</span>: [<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;toString&#x27;</span>],</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">refresh</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: $rawfile(<span class="string">&#x27;index.html&#x27;</span>), <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">        .<span class="title function_">javaScriptAccess</span>(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 其中，object 表示参与注册的对象；name 表示注册对象的名称为 objName，与 window 中调用的对象名一致；methodList 表示参与注册的应用侧 JavaScript 对象的方法；</p>
<p> 网页代码可以直接使用 objName 调用 methodList 中对应的方法，例如 test、toString；</p>
</li>
</ol>
<br>

<h3 id="页面导航"><a href="#页面导航" class="headerlink" title="页面导航"></a>页面导航</h3><p>使用 <code>backward()</code> 返回上一页面，使用 <code>forward()</code> 前进一个页面，使用 <code>refresh()</code> 刷新页面，使用 <code>clearHistory()</code> 清除历史记录，使用 <code>accessBackward()</code> 检查当前页面是否有后退来时记录，使用 <code>accessForward()</code> 检查是否存在前进历史记录；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Page5</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">WebController</span> = <span class="keyword">new</span> <span class="title class_">WebController</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&quot;前进&quot;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">forward</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&quot;后退&quot;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">backward</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&quot;刷新&quot;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">refresh</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&quot;停止&quot;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">stop</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&quot;清除历史&quot;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">clearHistory</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="number">12</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: <span class="string">&#x27;https://developer.harmonyos.com/&#x27;</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="调试网络应用"><a href="#调试网络应用" class="headerlink" title="调试网络应用"></a>调试网络应用</h3><p>当在网页中使用 console 打印日志时，HarmonyOS 系统都会调用相应的 onConsole 方法，获取到网页日志信息；</p>
<p>例如，在 Web 组件中使用 onConsole 输出网页中的日志：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">WebComponent</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">WebController</span> = <span class="keyword">new</span> <span class="title class_">WebController</span>();</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: $rawfile(<span class="string">&#x27;index.html&#x27;</span>), <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">        .<span class="title function_">onConsole</span>(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getMessage:&#x27;</span> + event.<span class="property">message</span>.<span class="title function_">getMessage</span>());</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getMessageLevel:&#x27;</span> + event.<span class="property">message</span>.<span class="title function_">getMessageLevel</span>());</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>event 的内容为 ConsoleMessage，可以使用 <code>getMessageLevel()</code> 查询消息级别以确定消息的严重性，然后根据自身业务采取相应的操作；</p>
<br>

<h3 id="发起-HTTP-请求"><a href="#发起-HTTP-请求" class="headerlink" title="发起 HTTP 请求"></a>发起 HTTP 请求</h3><p>HTTP 数据请求功能主要由 http 模块提供，包括发起请求、中断请求、订阅&#x2F;取消订阅 HTTP Response Header 事件等；</p>
<p>在进行网络请求前，需要先在 module.json5 文件中申明网络访问权限；</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;requestPermissions&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">           <span class="punctuation">&#123;</span></span><br><span class="line">             <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ohos.permission.INTERNET&quot;</span></span><br><span class="line">           <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以按照以下步骤完成 HTTP 数据请求：</p>
<ol>
<li><p>导入 http 模块：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@ohos.net.http&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 httpRequest 对象：</p>
<p> 使用 <code>createHttp()</code> 创建 httpRequest 对象，包括常用的一些网络请求方法，比如 request、destroy、on(‘headerReceive’) 等；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> httpRequest = http.<span class="title function_">createHttp</span>();</span><br></pre></td></tr></table></figure>

<p> 注意，每一个 httpRequest 对象对应一个 http 请求任务，不可复用；</p>
</li>
<li><p>订阅请求头（可选）：</p>
<p> 用于订阅 http 响应头，此接口会比 request 请求先返回，可以根据业务需要订阅此消息；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">httpRequest.<span class="title function_">on</span>(<span class="string">&#x27;headersReceive&#x27;</span>, <span class="function">(<span class="params">header</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;header: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(header));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>发起 http 请求：</p>
<p> http 模块支持常用的 POST 和 GET 等方法，封装在 RequestMethod 中；</p>
<p> 调用 request 方法发起网络请求，需要传入两个参数：</p>
<ul>
<li>第一个是请求的 url 地址；</li>
<li>第二个是可选参数，类型为 HttpRequestOptions，用于定义可选参数的类型和取值范围，包含请求方式、连接超时时间、请求头字段等；</li>
</ul>
<p> 使用 Get 请求，参数内容需要拼接到 URL 中进行发送；</p>
<p> 例如，在 url 后面拼接两个自定义参数，分别命名为 param1 和 param2，值分别为 value1 和 value2：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url= <span class="string">&quot;https://EXAMPLE_URL?param1=v1&amp;param2=v2&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> promise = httpRequest.<span class="title function_">request</span>(</span><br><span class="line">  <span class="comment">// 请求url地址</span></span><br><span class="line">  url,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 请求方式</span></span><br><span class="line">    <span class="attr">method</span>: http.<span class="property">RequestMethod</span>.<span class="property">GET</span>,</span><br><span class="line">    <span class="comment">// 可选，默认为60s</span></span><br><span class="line">    <span class="attr">connectTimeout</span>: <span class="number">60000</span>,</span><br><span class="line">    <span class="comment">// 可选，默认为60s</span></span><br><span class="line">    <span class="attr">readTimeout</span>: <span class="number">60000</span>,</span><br><span class="line">    <span class="comment">// 开发者根据自身业务需要添加header字段</span></span><br><span class="line">    <span class="attr">header</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p> POST 请求参数需要添加到 extraData 里面；</p>
<p> 例如，在 extraData 里面定义添加了两个自定义参数 param1 和 param2，值分别为 value1 和 value2：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="string">&quot;https://EXAMPLE_URL&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> promise = httpRequest.<span class="title function_">request</span>(</span><br><span class="line">  <span class="comment">// 请求url地址</span></span><br><span class="line">  url,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 请求方式</span></span><br><span class="line">    <span class="attr">method</span>: http.<span class="property">RequestMethod</span>.<span class="property">POST</span>,</span><br><span class="line">    <span class="comment">// 请求的额外数据。</span></span><br><span class="line">    <span class="attr">extraData</span>: &#123;</span><br><span class="line">      <span class="string">&quot;param1&quot;</span>: <span class="string">&quot;value1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;param2&quot;</span>: <span class="string">&quot;value2&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 可选，默认为60s</span></span><br><span class="line">    <span class="attr">connectTimeout</span>: <span class="number">60000</span>,</span><br><span class="line">    <span class="comment">// 可选，默认为60s</span></span><br><span class="line">    <span class="attr">readTimeout</span>: <span class="number">60000</span>,</span><br><span class="line">    <span class="comment">// 开发者根据自身业务需要添加header字段</span></span><br><span class="line">    <span class="attr">header</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>处理响应结果：</p>
<p> data 为网络请求返回的结果，err 为请求异常时返回的结果；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123; </span><br><span class="line">  <span class="keyword">if</span> (data.<span class="property">responseCode</span> === http.<span class="property">ResponseCode</span>.<span class="property">OK</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Result:&#x27;</span> + data.<span class="property">result</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;code:&#x27;</span> + data.<span class="property">responseCode</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;error:&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> 其中，data.responseCode 为 http 请求返回的状态码，例如，http.ResponseCode.OK（即 200）表示请求成功；</p>
<p> data.result 为服务器返回的业务数据，开发者可以根据自身业务场景解析此数据；</p>
</li>
</ol>
<br>

<h1 id="数据管理"><a href="#数据管理" class="headerlink" title="数据管理"></a>数据管理</h1><p>首选项是 HarmonyOS 提供的数据管理能力之一；</p>
<br>

<h2 id="首选项"><a href="#首选项" class="headerlink" title="首选项"></a>首选项</h2><p>首选项为应用提供 Key-Value 键值型的数据存储能力，支持应用持久化轻量级数据，并对其进行增删改查等；该存储对象中的数据会被缓存在内存中，因此它可以获得更快的存取速度；</p>
<p>首选项的特点是：</p>
<ol>
<li><p>以 Key-Value 形式存储数据；</p>
<p> Key 是不重复的关键字，Value 是数据值；</p>
</li>
<li><p>非关系型数据库；</p>
</li>
</ol>
<p>区别于关系型数据库，它不保证遵循 ACID 特性，数据之间无关系；</p>
<ul>
<li>进程中每个文件仅存在一个 Preferences 实例，应用获取到实例后，可以从中读取数据，或者将数据存入实例中；</li>
<li>通过调用 flush 方法可以将实例中的数据回写到文件里；</li>
</ul>
<img src="38.png" style="zoom: 50%;" />

<p>与关系数据库的区别：</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>关系型数据库</th>
<th>首选项</th>
</tr>
</thead>
<tbody><tr>
<td>数据库类型</td>
<td>关系型</td>
<td>非关系型</td>
</tr>
<tr>
<td>使用场景</td>
<td>提供复杂场景下的本地数据库管理机制</td>
<td>对 Key-Value 结构的数据进行存取和持久化操作</td>
</tr>
<tr>
<td>存储方式</td>
<td>SQLite 数据库</td>
<td>文件</td>
</tr>
<tr>
<td>约束与限制</td>
<td>1.连接池最大 4 个；2.同一时间只支持一个写操作；</td>
<td>1.建议数据不超一万条；2.Key 为 string 型；</td>
</tr>
</tbody></table>
<br>

<h2 id="常用接口"><a href="#常用接口" class="headerlink" title="常用接口"></a>常用接口</h2><p>常用接口有：保存数据（put）、获取数据（get）、是否包含指定的 key（has）、删除数据（delete）、数据持久化（flush）等；</p>
<p><strong>常用接口使用前提</strong>：</p>
<ol>
<li><p>需要导入 @ohos.data.preferences 模块到 PreferencesUtil 开发环境中，实例名字命名为 dataPreferences，同时定义两个常量 PREFERENCES_NAME 和 KEY_APP_FONT_SIZE（把常用接口封装在 PreferencesUtil 工具类里面，方便后面代码直接调用）：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferencesUtil.ets</span></span><br><span class="line"><span class="keyword">import</span> dataPreferences <span class="keyword">from</span> <span class="string">&#x27;@ohos.data.preferences&#x27;</span>;</span><br><span class="line">   ...</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">PREFERENCES_NAME</span> = <span class="string">&#x27;myPreferences&#x27;</span>; <span class="comment">// 首选项名字</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">KEY_APP_FONT_SIZE</span> = <span class="string">&#x27;appFontSize&#x27;</span>;  <span class="comment">// 首选项Key字段</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>需要在 entryAbility 的 onCreate 方法获取首选项实例，以便后续能进行保存、读取、删除等操作，获取实例需要上下文 context 和文件名字 PREFERENCES_NAME：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entryAbility.ets  </span></span><br><span class="line">  <span class="title function_">onCreate</span>(<span class="params">want, launchParam</span>) &#123;</span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;onCreate&#x27;</span>);</span><br><span class="line">    globalThis.<span class="property">abilityWant</span> = want;</span><br><span class="line">    <span class="comment">// 创建首选项</span></span><br><span class="line">    <span class="title class_">PreferencesUtil</span>.<span class="title function_">createFontPreferences</span>(<span class="variable language_">this</span>.<span class="property">context</span>);</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferencesUtil.ets  </span></span><br><span class="line">  <span class="title function_">createFontPreferences</span>(<span class="params">context</span>) &#123;</span><br><span class="line">    globalThis.<span class="property">getFontPreferences</span> = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 获取首选项实例</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">preferences</span>: <span class="title class_">Promise</span> = dataPreferences.<span class="title function_">getPreferences</span>(context, <span class="variable constant_">PREFERENCES_NAME</span>);</span><br><span class="line">      <span class="keyword">return</span> preferences;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>关于 globalThis，提供了一个标准的方式来获取不同环境下的全局 this 对象；</p>
<ul>
<li><p>以上代码，直接调用了当前类 PreferencesUtil 的方法，返回的实例另作存储；</p>
</li>
<li><p>实际开发中，可以调用存储在 GlobalContext 实例（类似中介）中的首选项实例的方法；</p>
</li>
</ul>
<p>例如，自定义 GlobalContext 类并创建实例，其中设置首选项实例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">GlobalContext</span>.<span class="title function_">getContext</span>().<span class="title function_">setObject</span>(<span class="string">&#x27;getFontPreferences&#x27;</span>, fontPreferences);</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GlobalContext.ets</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GlobalContext</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">constructor</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="attr">instance</span>: <span class="title class_">GlobalContext</span>;</span><br><span class="line">  <span class="keyword">private</span> _objects = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Object</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">getContext</span>(): <span class="title class_">GlobalContext</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">GlobalContext</span>.<span class="property">instance</span>) &#123;</span><br><span class="line">      <span class="title class_">GlobalContext</span>.<span class="property">instance</span> = <span class="keyword">new</span> <span class="title class_">GlobalContext</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">GlobalContext</span>.<span class="property">instance</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getObject</span>(<span class="attr">value</span>: <span class="built_in">string</span>): <span class="title class_">Object</span> | <span class="literal">undefined</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_objects</span>.<span class="title function_">get</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setObject</span>(<span class="attr">key</span>: <span class="built_in">string</span>, <span class="attr">objectClass</span>: <span class="title class_">Object</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_objects</span>.<span class="title function_">set</span>(key, objectClass);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>保存数据（put）</strong>：</p>
<ol>
<li><p>在 entryAbility 的 onCreate 方法，调用 PreferencesUtil.saveDefaultFontSize 保存默认数据，先用 has 方法判断当前 key 是否有存在，如果没有就通过 put 方法把用户数据保存起来，再通过 flush 方法把数据保存到文件：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entryAbility.ets  </span></span><br><span class="line">  <span class="title function_">onCreate</span>(<span class="params">want, launchParam</span>) &#123;</span><br><span class="line">    <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;onCreate&#x27;</span>);</span><br><span class="line">    globalThis.<span class="property">abilityWant</span> = want;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 设置字体默认大小</span></span><br><span class="line">    <span class="title class_">PreferencesUtil</span>.<span class="title function_">saveDefaultFontSize</span>(<span class="title class_">Constants</span>.<span class="property">SET_SIZE_STANDARD</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferencesUtil.ets    </span></span><br><span class="line">  <span class="title function_">saveDefaultFontSize</span>(<span class="params">fontSize: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    globalThis.<span class="title function_">getFontPreferences</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">preferences</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 判断保存的key是否存在</span></span><br><span class="line">      preferences.<span class="title function_">has</span>(<span class="variable constant_">KEY_APP_FONT_SIZE</span>).<span class="title function_">then</span>(<span class="keyword">async</span> (isExist) =&gt; &#123;</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;preferences has changeFontSize is &#x27;</span> + isExist);</span><br><span class="line">        <span class="keyword">if</span> (!isExist) &#123;</span><br><span class="line">          <span class="comment">// 保存数据</span></span><br><span class="line">          <span class="keyword">await</span> preferences.<span class="title function_">put</span>(<span class="variable constant_">KEY_APP_FONT_SIZE</span>, fontSize);</span><br><span class="line">          preferences.<span class="title function_">flush</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Has the value failed with err: &#x27;</span> + err);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Get the preferences failed, err: &#x27;</span> + err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 SetFontSizePage 页面，当移动 Slider 滑动条时，把当前进度值通过 PreferencesUtil.saveChangeFontSize 方法保存起来，再通过 flush 方法把数据保存到文件：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetFontSizePage.ets</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Slider</span>(&#123;</span><br><span class="line">       ...</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 保存当前进度值</span></span><br><span class="line">          <span class="title class_">PreferencesUtil</span>.<span class="title function_">saveChangeFontSize</span>(<span class="variable language_">this</span>.<span class="property">changeFontSize</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferencesUtil.ets </span></span><br><span class="line">  <span class="title function_">saveChangeFontSize</span>(<span class="params">fontSize: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    globalThis.<span class="title function_">getFontPreferences</span>().<span class="title function_">then</span>(<span class="keyword">async</span> (preferences) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 保存数据</span></span><br><span class="line">      <span class="keyword">await</span> preferences.<span class="title function_">put</span>(<span class="variable constant_">KEY_APP_FONT_SIZE</span>, fontSize);</span><br><span class="line">      preferences.<span class="title function_">flush</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;put the preferences failed, err: &#x27;</span> + err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>获取数据（get）</strong>：</p>
<p>在 HomePage 的 onPageShow 方法，调用 PreferencesUtil.getChangeFontSize 方法获取用户数据，调用 get 方法获取，把的到的结果赋值给变量 fontSize，通过 return 方式把值返回去：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HomePage.ets</span></span><br><span class="line">  <span class="title function_">onPageShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">PreferencesUtil</span>.<span class="title function_">getChangeFontSize</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">changeFontSize</span> = value;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Get the value of changeFontSize: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">changeFontSize</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferencesUtil.ets </span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getChangeFontSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">fontSize</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> preferences = <span class="keyword">await</span> globalThis.<span class="title function_">getFontPreferences</span>();</span><br><span class="line">    fontSize = <span class="keyword">await</span> preferences.<span class="title function_">get</span>(<span class="variable constant_">KEY_APP_FONT_SIZE</span>, fontSize);</span><br><span class="line">    <span class="keyword">return</span> fontSize;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>async、await（Promise 语法糖）说明：</p>
<p>async 用于申明异步 function；await 表示等待异步逻辑执行完成；</p>
<p>规则：</p>
<ol>
<li>async 和 await 是配对使用的，await 存在于 async 的内部；</li>
<li>await 表示在这里等待一个 promise 返回，再接下来执行；</li>
<li>await 后面跟着的应该是一个 promise 对象；</li>
</ol>
<p>async、await 将异步强行转换为同步处理；即，异步编程的最高境界就是不关心它是否是异步；</p>
</blockquote>
<p><strong>是否包含指定的 key（has）</strong>：</p>
<p>通过 has 方法判断首选项中是否包含指定的 key，保证指定的 key 不会被重复保存：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferencesUtil.ets    </span></span><br><span class="line">  <span class="title function_">saveDefaultFontSize</span>(<span class="params">fontSize: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    globalThis.<span class="title function_">getFontPreferences</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">preferences</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 判断保存的key是否存在</span></span><br><span class="line">      preferences.<span class="title function_">has</span>(<span class="variable constant_">KEY_APP_FONT_SIZE</span>).<span class="title function_">then</span>(<span class="keyword">async</span> (isExist) =&gt; &#123;</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;preferences has changeFontSize is &#x27;</span> + isExist);</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Has the value failed with err: &#x27;</span> + err);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Get the preferences failed, err: &#x27;</span> + err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>数据持久化（flush）</strong>：</p>
<p>通过 flush 方法把应用数据保存到文件中，使得应用数据保存期限变长：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferencesUtil.ets </span></span><br><span class="line">  <span class="title function_">saveChangeFontSize</span>(<span class="params">fontSize: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    globalThis.<span class="title function_">getFontPreferences</span>().<span class="title function_">then</span>(<span class="keyword">async</span> (preferences) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 保存数据</span></span><br><span class="line">      <span class="keyword">await</span> preferences.<span class="title function_">put</span>(<span class="variable constant_">KEY_APP_FONT_SIZE</span>, fontSize);</span><br><span class="line">     <span class="comment">// 数据持久化</span></span><br><span class="line">      preferences.<span class="title function_">flush</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;put the preferences failed, err: &#x27;</span> + err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>删除数据（delete）</strong>：</p>
<p>删除首选项数据需要获取 preferences 实例，用 delete 方法删除指定的 key 所对应的值，通过 Promise 异步回调是否删除成功：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferencesUtil.ets </span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">deleteChangeFontSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">preferences</span>: dataPreferences.<span class="property">Preferences</span> = <span class="keyword">await</span> globalThis.<span class="title function_">getFontPreferences</span>();</span><br><span class="line">    <span class="comment">// 删除数据</span></span><br><span class="line">    <span class="keyword">let</span> deleteValue = preferences.<span class="title function_">delete</span>(<span class="variable constant_">KEY_APP_FONT_SIZE</span>);</span><br><span class="line">    deleteValue.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Succeeded in deleting the key appFontSize.&#x27;</span>);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;Failed to delete the key appFontSize. Cause: &#x27;</span> + err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<br>

<h1 id="通知-amp-提醒"><a href="#通知-amp-提醒" class="headerlink" title="通知&amp;提醒"></a>通知&amp;提醒</h1><br>

<h2 id="应用通知消息"><a href="#应用通知消息" class="headerlink" title="应用通知消息"></a>应用通知消息</h2><p>通知旨在让用户以合适的方式及时获得有用的新消息，帮助用户高效地处理任务；</p>
<p>应用可以通过通知接口发送通知消息，用户可以通过通知栏查看通知内容，也可以点击通知来打开应用，通知主要有以下使用场景：</p>
<ul>
<li>显示接收到的短消息、即时消息等；</li>
<li>显示应用的推送消息，如广告、版本更新等；</li>
<li>显示当前正在进行的事件，如下载等；</li>
</ul>
<br>

<h3 id="形式与结构"><a href="#形式与结构" class="headerlink" title="形式与结构"></a>形式与结构</h3><p>通知会在不同场景以不同形式提示用户，例如，通知在状态栏上显示为图标、在通知栏上会显示通知详细信息；重要的信息还可以使用横幅通知，浮动在界面顶部显示；</p>
<img src="39.png" style="zoom: 20%;" />

<p>下面以基础的文本通知为例，介绍通知的基本结构：</p>
<img src="40.png" style="zoom: 50%;" />

<table>
<thead>
<tr>
<th>组成</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1. 通知小图标</td>
<td>表示通知的功能与类型</td>
</tr>
<tr>
<td>2. 通知名称</td>
<td>应用名称或功能名称</td>
</tr>
<tr>
<td>3. 时间</td>
<td>发送通知的时间，系统默认显示</td>
</tr>
<tr>
<td>4. 展开箭头</td>
<td>点击标题区，展开被折叠的内容和按钮。若无折叠的内容和按钮，不显示此箭头</td>
</tr>
<tr>
<td>5. 内容标题</td>
<td>描述简明概要</td>
</tr>
<tr>
<td>6. 内容详情</td>
<td>描述具体内容或详情</td>
</tr>
</tbody></table>
<br>

<h3 id="通知管理"><a href="#通知管理" class="headerlink" title="通知管理"></a>通知管理</h3><p>在创建通知前需要先导入 notificationManager 模块，该模块提供通知管理的能力，包括发布、取消发布通知，创建、获取、移除通知通道等能力；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> notification <span class="keyword">from</span> <span class="string">&#x27;@ohos.notificationManager&#x27;</span>;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="创建通知"><a href="#创建通知" class="headerlink" title="创建通知"></a>创建通知</h4><p><strong>基础类型通知</strong></p>
<p>基础类型通知主要应用于发送短信息、提示信息、广告推送等，支持普通文本类型、长文本类型、多行文本类型和图片类型，可以通过 contentType 指定通知的内容类型；</p>
<ul>
<li><p><strong>普通文本类型通知</strong>，需要设置 contentType 类型为 ContentType.NOTIFICATION_CONTENT_BASIC_TEXT；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> notification <span class="keyword">from</span> <span class="string">&#x27;@ohos.notificationManager&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">NotificationDemo</span> &#123;</span><br><span class="line">  <span class="title function_">publishNotification</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">notificationRequest</span>: notification.<span class="property">NotificationRequest</span> = &#123; <span class="comment">// 描述通知的请求</span></span><br><span class="line">      <span class="attr">id</span>: <span class="number">1</span>, <span class="comment">// 通知ID</span></span><br><span class="line">      <span class="attr">slotType</span>: notification.<span class="property">SlotType</span>.<span class="property">SERVICE_INFORMATION</span>,</span><br><span class="line">      <span class="attr">content</span>: &#123; <span class="comment">// 通知内容</span></span><br><span class="line">        <span class="attr">contentType</span>: notification.<span class="property">ContentType</span>.<span class="property">NOTIFICATION_CONTENT_BASIC_TEXT</span>, <span class="comment">// 普通文本类型通知</span></span><br><span class="line">        <span class="attr">normal</span>: &#123; <span class="comment">// 基本类型通知内容</span></span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;通知内容标题&#x27;</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">&#x27;通知内容详情&#x27;</span>,</span><br><span class="line">          <span class="attr">additionalText</span>: <span class="string">&#x27;通知附加内容&#x27;</span>, <span class="comment">// 通知附加内容，是对通知内容的补充。</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    notification.<span class="title function_">publish</span>(notificationRequest).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 发布通知</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;publish success&#x27;</span>);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`publish failed, dcode:<span class="subst">$&#123;err.code&#125;</span>, message:<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;发送通知&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">publishNotification</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <img src="41.png" style="zoom: 80%;" />
</li>
<li><p><strong>图片类型通知</strong>，需要设置 contentType 类型为 ContentType.NOTIFICATION_CONTENT_PICTURE；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> notification <span class="keyword">from</span> <span class="string">&#x27;@ohos.notificationManager&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> image <span class="keyword">from</span> <span class="string">&#x27;@ohos.multimedia.image&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">NotificationTest1</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">publishPictureNotification</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 将资源图片转化为PixelMap对象</span></span><br><span class="line">    <span class="keyword">let</span> resourceManager = <span class="title function_">getContext</span>(<span class="variable language_">this</span>).<span class="property">resourceManager</span>;</span><br><span class="line">    <span class="keyword">let</span> imageArray = <span class="keyword">await</span> resourceManager.<span class="title function_">getMediaContent</span>($r(<span class="string">&#x27;app.media.bigPicture&#x27;</span>).<span class="property">id</span>);</span><br><span class="line">    <span class="keyword">let</span> imageResource = image.<span class="title function_">createImageSource</span>(imageArray.<span class="property">buffer</span>);</span><br><span class="line">    <span class="keyword">let</span> pixelMap = <span class="keyword">await</span> imageResource.<span class="title function_">createPixelMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">notificationRequest</span>: notification.<span class="property">NotificationRequest</span> = &#123; <span class="comment">// 描述通知的请求</span></span><br><span class="line">      <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">content</span>: &#123;</span><br><span class="line">        <span class="attr">contentType</span>: notification.<span class="property">ContentType</span>.<span class="property">NOTIFICATION_CONTENT_PICTURE</span>,</span><br><span class="line">        <span class="attr">picture</span>: &#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;好物热销中&#x27;</span>, <span class="comment">// 通知内容标题</span></span><br><span class="line">          <span class="attr">text</span>: <span class="string">&#x27;展开查看详情&#x27;</span>, <span class="comment">// 通知内容</span></span><br><span class="line">          <span class="attr">expandedTitle</span>: <span class="string">&#x27;今日热门推荐&#x27;</span>, <span class="comment">// 通知展开时的内容标题</span></span><br><span class="line">          <span class="attr">briefText</span>: <span class="string">&#x27;这里一定有您喜欢的&#x27;</span>, <span class="comment">// 通知概要内容，是对通知内容的总结</span></span><br><span class="line">          <span class="attr">picture</span>: pixelMap <span class="comment">// 通知的图片内容</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    notification.<span class="title function_">publish</span>(notificationRequest).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 发布通知</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;publish success&#x27;</span>);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`publish failed, dcode:<span class="subst">$&#123;err.code&#125;</span>, message:<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;发送大图通知&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">publishPictureNotification</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <img src="42.png" style="zoom:80%;" /></li>
</ul>
<p><strong>进度类型通知</strong></p>
<p>进度条通知也是常见的通知类型，主要应用于文件下载、事务处理进度显示，且目前系统模板仅支持进度条模板：</p>
<img src="43.png" style="zoom: 40%;" />

<p>在发布进度类型通知前需要查询系统是否支持进度条模板；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">notification.<span class="title function_">isSupportTemplate</span>(<span class="string">&#x27;downloadTemplate&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`[ANS] isSupportTemplate success`</span>);</span><br><span class="line">  <span class="comment">// isSupportTpl的值为true表示支持支持downloadTemplate模板类通知，false表示不支持</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">isSupportTpl</span>: <span class="built_in">boolean</span> = data;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[ANS] isSupportTemplate failed, error[<span class="subst">$&#123;err&#125;</span>]`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>构造进度条模板，name 字段当前需要固定配置为 downloadTemplate；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> template = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;downloadTemplate&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">progressValue</span>: <span class="number">60</span>, <span class="comment">// 当前进度值</span></span><br><span class="line">    <span class="attr">progressMaxValue</span>: <span class="number">100</span> <span class="comment">// 最大进度值</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> notificationRequest = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    <span class="attr">contentType</span>: notification.<span class="property">ContentType</span>.<span class="property">NOTIFICATION_CONTENT_BASIC_TEXT</span>,</span><br><span class="line">    <span class="attr">normal</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;文件下载：music.mp4&#x27;</span>,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;senTemplate&#x27;</span>,</span><br><span class="line">      <span class="attr">additionalText</span>: <span class="string">&#x27;60%&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">   <span class="attr">template</span>: template  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 发布通知</span></span><br><span class="line">notification.<span class="title function_">publish</span>(notificationRequest).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`publish success`</span>);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[ANS] publish failed, code is <span class="subst">$&#123;error.code&#125;</span>, message is <span class="subst">$&#123;error.message&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<br>

<h4 id="更新通知"><a href="#更新通知" class="headerlink" title="更新通知"></a>更新通知</h4><p>在发出通知后，可以使用之前相同通知的 ID，再次调用 notification.publish 来实现通知的更新；如果之前的通知是关闭的，将会创建新通知；</p>
<br>

<h4 id="移除通知"><a href="#移除通知" class="headerlink" title="移除通知"></a>移除通知</h4><ul>
<li><p>通过通知 ID 取消已发布的通知；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notification.<span class="title function_">cancel</span>(notificationId)</span><br></pre></td></tr></table></figure>
</li>
<li><p>取消所有已发布的通知；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notification.<span class="title function_">cancelAll</span>()</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="按钮-amp-行为意图"><a href="#按钮-amp-行为意图" class="headerlink" title="按钮&amp;行为意图"></a>按钮&amp;行为意图</h3><br>

<h4 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h4><p>最多可以给通知添加三个按钮，便于用户快速响应，比如关闭提醒；</p>
<img src="44.png" style="zoom: 80%;" />

<p>给操作按钮添加行为意图，来响应点击事件；例如，发布公共事件或拉起一个 UIAbility；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> notificationRequest = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">slotType</span>: notification.<span class="property">SlotType</span>.<span class="property">SOCIAL_COMMUNICATION</span>,</span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    <span class="attr">contentType</span>: notification.<span class="property">ContentType</span>.<span class="property">NOTIFICATION_CONTENT_BASIC_TEXT</span>,</span><br><span class="line">    <span class="attr">normal</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;吃饭了吗&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actionButtons</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;回复&#x27;</span>,</span><br><span class="line">      <span class="attr">wantAgent</span>: wantAgentObj</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="添加行为意图"><a href="#添加行为意图" class="headerlink" title="添加行为意图"></a>添加行为意图</h4><p>WantAgent 提供了封装行为意图的能力，这里的行为意图主要是指<strong>拉起指定的应用组件</strong>及<strong>发布公共事件</strong>等能力；</p>
<p>给通知添加行为意图后，点击通知后可以拉起指定的 UIAbility 或发布公共事件，按照以下步骤来实现：</p>
<ol>
<li><p>导入模块：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> notification <span class="keyword">from</span> <span class="string">&#x27;@ohos.notificationManager&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> wantAgent <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.wantAgent&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 WantAgentInfo 信息：</p>
<p> 场景一：拉起 UIAbility：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wantAgentInfo = &#123;</span><br><span class="line">  <span class="attr">wants</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">bundleName</span>: <span class="string">&quot;com.example.notification&quot;</span>,</span><br><span class="line">      <span class="attr">abilityName</span>: <span class="string">&quot;EntryAbility&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">operationType</span>: wantAgent.<span class="property">OperationType</span>.<span class="property">START_ABILITY</span>,</span><br><span class="line">  <span class="attr">requestCode</span>: <span class="number">100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 场景二：发布公共事件：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> wantAgentInfo = &#123;</span><br><span class="line">  <span class="attr">wants</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">action</span>: <span class="string">&#x27;event_name&#x27;</span>, <span class="comment">// 设置事件名</span></span><br><span class="line">      <span class="attr">parameters</span>: &#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">operationType</span>: wantAgent.<span class="property">OperationType</span>.<span class="property">SEND_COMMON_EVENT</span>,</span><br><span class="line">  <span class="attr">requestCode</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">wantAgentFlags</span>: [wantAgent.<span class="property">WantAgentFlags</span>.<span class="property">CONSTANT_FLAG</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 WantAgent 对象：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> wantAgentObj = <span class="literal">null</span>; </span><br><span class="line">wantAgent.<span class="title function_">getWantAgent</span>(wantAgentInfo)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    wantAgentObj = data;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`get wantAgent failed because <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(err)&#125;</span>`</span>);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>构造 NotificationRequest 对象：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> notificationRequest = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    <span class="attr">contentType</span>: notification.<span class="property">ContentType</span>.<span class="property">NOTIFICATION_CONTENT_BASIC_TEXT</span>,</span><br><span class="line">    <span class="attr">normal</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;通知标题&quot;</span>,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&quot;通知内容&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">wantAgent</span>: wantAgentObj</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>发布 WantAgent 通知：</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">notification.<span class="title function_">publish</span>(notificationRequest).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 发布通知</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;publish success&quot;</span>);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`publish failed, code is <span class="subst">$&#123;err.code&#125;</span>, message is <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> 用户通过点击通知栏上的通知，即可触发 WantAgent 的动作；</p>
</li>
</ol>
<br>

<h3 id="通知-slot"><a href="#通知-slot" class="headerlink" title="通知 slot"></a>通知 slot</h3><p>通过通知通道（slot），可让通知有不同的表现形式，主要有以下几种：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>SlotType.SOCIAL_COMMUNICATION</td>
<td>社交类型，状态栏中显示通知图标，有横幅和提示音</td>
</tr>
<tr>
<td>SlotType.SERVICE_INFORMATION</td>
<td>服务类型，状态栏中显示通知图标，没有横幅但有提示音</td>
</tr>
<tr>
<td>SlotType.CONTENT_INFORMATION</td>
<td>内容类型，状态栏中显示通知图标，没有横幅或提示音</td>
</tr>
<tr>
<td>SlotType.OTHER_TYPES</td>
<td>其它类型，状态栏中不显示通知图标，没有横幅或提示音</td>
</tr>
</tbody></table>
<p>使用 slotType 实现，设置 slotType 为 SlotType.SOCIAL_COMMUNICATION，表示为社交类型通知：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> imageArray = <span class="keyword">await</span> <span class="title function_">getContext</span>(<span class="variable language_">this</span>).<span class="property">resourceManager</span>.<span class="title function_">getMediaContent</span>($r(<span class="string">&#x27;app.media.largeIcon&#x27;</span>).<span class="property">id</span>);</span><br><span class="line"><span class="keyword">let</span> imageResource = image.<span class="title function_">createImageSource</span>(imageArray.<span class="property">buffer</span>);</span><br><span class="line"><span class="keyword">let</span> opts = &#123; <span class="attr">desiredSize</span>: &#123; <span class="attr">height</span>: <span class="number">72</span>, <span class="attr">width</span>: <span class="number">72</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">let</span> largePixelMap = <span class="keyword">await</span> imageResource.<span class="title function_">createPixelMap</span>(opts);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">notificationRequest</span>: notification.<span class="property">NotificationRequest</span> = &#123; <span class="comment">// 描述通知的请求</span></span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>, <span class="comment">// 通知ID</span></span><br><span class="line">  <span class="attr">content</span>: &#123; <span class="comment">// 通知内容</span></span><br><span class="line">    <span class="attr">contentType</span>: notification.<span class="property">ContentType</span>.<span class="property">NOTIFICATION_CONTENT_BASIC_TEXT</span>, <span class="comment">// 普通文本类型通知</span></span><br><span class="line">    <span class="attr">slotType</span>: notification.<span class="property">SlotType</span>.<span class="property">SOCIAL_COMMUNICATION</span>,</span><br><span class="line">    <span class="attr">normal</span>: &#123; <span class="comment">// 基本类型通知内容</span></span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="comment">// 通知内容标题。</span></span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;等会下班一起吃饭哦&#x27;</span>, <span class="comment">// 通知内容</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">largeIcon</span>: largePixelMap <span class="comment">// 通知大图标。可选字段，大小不超过30KB。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="通知组"><a href="#通知组" class="headerlink" title="通知组"></a>通知组</h3><p>将不同类型的通知分为不同的组，以便用户更好的管理；当同组的通知有多条的时候，会自动折叠起来；</p>
<p>例如，当通知栏里有聊天消息通知和商品推荐通知时，只需要给字段 groupName 设置不同的值可以将通知分为不同的组；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> notifyId = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">chatRequest</span>: notification.<span class="property">NotificationRequest</span> = &#123; </span><br><span class="line">  <span class="attr">id</span>: notifyId++,</span><br><span class="line">  <span class="attr">groupName</span>:<span class="string">&#x27;ChatGroup&#x27;</span>,</span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">productRequest</span>: notification.<span class="property">NotificationRequest</span> = &#123; </span><br><span class="line">  <span class="attr">id</span>: notifyId++,</span><br><span class="line">  <span class="attr">groupName</span>: <span class="string">&#x27;ProductGroup&#x27;</span>,</span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>

<img src="45.png" style="zoom:40%;" />

<br>

<h2 id="后台代理提醒"><a href="#后台代理提醒" class="headerlink" title="后台代理提醒"></a>后台代理提醒</h2><p>应用可能需要在指定的时刻，向用户发送一些业务提醒通知；例如，购物类应用希望在指定时间点提醒用户有优惠活动；</p>
<p>为此，HarmonyOS 提供了后台代理提醒功能，拥有统一的提醒管理能力，在应用退居后台或退出后，计时和提醒通知功能被系统后台代理接管；</p>
<p>后台代理提醒业务类型：</p>
<ul>
<li>倒计时类：基于倒计时的提醒功能，适用于短时的计时提醒业务；</li>
<li>日历类：基于日历的提醒功能，适用于较长时间的提醒业务；</li>
<li>闹钟类：基于时钟的提醒功能，适用于指定时刻的提醒业务；</li>
</ul>
<p>后台代理提醒服务通过 reminderAgentManager 模块提供<strong>提醒定义、创建提醒、取消提醒</strong>等能力；</p>
<img src="46.png" style="zoom:55%;" />

<p>例如，新增一个 9 点的喝水提醒，过程如图：</p>
<img src="47.png" style="zoom:65%;" />

<p>在整个流程中，应用仅需：</p>
<ol>
<li>使用 reminderAgentManager 模块的 ReminderRequest 类定义提醒实例；</li>
<li>使用 reminderAgentManager 模块的 publishReminder 接口发布提醒；</li>
</ol>
<p>而无需关注计时和通知发布等功能如何实现；</p>
<p><strong>前置条件</strong>，实现功能的前提如下：</p>
<ul>
<li><p>添加后台代理提醒使用权限；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;module&quot;</span>: &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">&quot;requestPermissions&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">     <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ohos.permission.PUBLISH_AGENT_REMINDER&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入后台代理提醒 reminderAgentManager 模块，将此模块命名为 reminderAgent；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reminderAgent <span class="keyword">from</span> <span class="string">&#x27;@ohos.reminderAgentManager&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>新增提醒</strong>，实现步骤如下：</p>
<ol>
<li><p>用 reminderAgent.ReminderRequest 类定义提醒实例；</p>
</li>
<li><p>发布提醒；</p>
 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reminderAgent <span class="keyword">from</span> <span class="string">&#x27;@ohos.reminderAgentManager&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ReminderService</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">addReminder</span>(<span class="params">alarmItem: ReminderItem, callback?: (reminderId: <span class="built_in">number</span>) =&gt; <span class="built_in">void</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> reminder = <span class="variable language_">this</span>.<span class="title function_">initReminder</span>(alarmItem);</span><br><span class="line">    reminderAgent.<span class="title function_">publishReminder</span>(reminder, <span class="function">(<span class="params">err, reminderId</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (callback != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_">callback</span>(reminderId);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">initReminder</span>(<span class="attr">item</span>: <span class="title class_">ReminderItem</span>): reminderAgent.<span class="property">ReminderRequestAlarm</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">reminderType</span>: item.<span class="property">remindType</span>,</span><br><span class="line">      <span class="attr">hour</span>: item.<span class="property">hour</span>,</span><br><span class="line">      <span class="attr">minute</span>: item.<span class="property">minute</span>,</span><br><span class="line">      <span class="attr">daysOfWeek</span>: item.<span class="property">repeatDays</span>,</span><br><span class="line">      <span class="attr">title</span>: item.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">ringDuration</span>: item.<span class="property">duration</span> * <span class="title class_">Constants</span>.<span class="property">DEFAULT_TOTAL_MINUTE</span>,</span><br><span class="line">      <span class="attr">snoozeTimes</span>: item.<span class="property">intervalTimes</span>,</span><br><span class="line">      <span class="attr">timeInterval</span>: item.<span class="property">intervalMinute</span>,</span><br><span class="line">      <span class="attr">actionButton</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;关闭&#x27;</span>,</span><br><span class="line">          <span class="attr">type</span>: reminderAgent.<span class="property">ActionButtonType</span>.<span class="property">ACTION_BUTTON_TYPE_CLOSE</span></span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">wantAgent</span>: &#123;</span><br><span class="line">        <span class="attr">pkgName</span>: globalThis.<span class="property">bundleName</span>,</span><br><span class="line">        <span class="attr">abilityName</span>: globalThis.<span class="property">abilityName</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">notificationId</span>: item.<span class="property">notificationId</span>,</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>删除提醒</strong>，可以调用 <code>cancelReminder()</code> 接口实现；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reminderAgent <span class="keyword">from</span> <span class="string">&#x27;@ohos.reminderAgentManager&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ReminderService</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">deleteReminder</span>(<span class="params">reminderId: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    reminderAgent.<span class="title function_">cancelReminder</span>(reminderId);</span><br><span class="line">  &#125;</span><br><span class="line">        </span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改提醒</strong>，则需要先进行旧提醒的删除，再新增新的提醒；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> <span class="title function_">setAlarmRemind</span>(<span class="params">alarmItem: AlarmItem</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">findAlarmWithId</span>(alarmItem.<span class="property">id</span>);</span><br><span class="line">  <span class="keyword">if</span> (index !== <span class="title class_">Constants</span>.<span class="property">DEFAULT_NUMBER_NEGATIVE</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reminderService</span>.<span class="title function_">deleteReminder</span>(alarmItem.<span class="property">id</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">reminderService</span>.<span class="title function_">addReminder</span>(alarmItem, <span class="function">(<span class="params">newId</span>) =&gt;</span> &#123;</span><br><span class="line">    alarmItem.<span class="property">id</span> = newId;</span><br><span class="line">    ...</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h1 id="三方库"><a href="#三方库" class="headerlink" title="三方库"></a>三方库</h1><p>三方库在系统能力的基础上，提供了更加方便的使用，在许多场景下，能够极大提升开发者的开发效率；</p>
<p>目前提供了两种途径获取开源三方库：</p>
<ol>
<li><p>通过访问 Gitee 网站开源社区获取：</p>
<p> 在 Gitee 中，搜索 OpenHarmony-TPC 仓库，在 tpc_resource 中对三方库进行了资源汇总；</p>
</li>
<li><p>通过 OpenHarmony 三方库中心仓获取：</p>
<p> 进入 OpenHarmony 三方库中心仓，根据类型或者直接搜索寻找需要的三方库；</p>
</li>
</ol>
<br>

<h2 id="常用三方库"><a href="#常用三方库" class="headerlink" title="常用三方库"></a>常用三方库</h2><p>常用的三方库可以分为 UI、动画、网络、图片、多媒体、数据存储、安全、工具等；例如：</p>
<ul>
<li><p>UI 库：</p>
<p>  @ohos&#x2F;textlayoutbuilder：可以定制任一样式的文本构建工具，包括字体间距、大小、颜色、富文本高亮显示等；</p>
<p>  @ohos&#x2F;roundedimageview：可以生成圆角矩形、或者椭圆形等图片形状；</p>
</li>
<li><p>网络库：</p>
<p>  @ohos&#x2F;axios：可以运行在 node.js 和浏览器中，基于 Axios 原库 v1.3.4 版本进行适配，并沿用其现有用法和特性；</p>
</li>
<li><p>动画库：</p>
<p>  @ohos&#x2F;lottie：可以解析 Adobe After Effects 软件通过 Bodymovin 插件导出的 json 格式的动画，并在移动设备上进行本地渲染；</p>
<p>  @ohos&#x2F;svg：可以解析 SVG 图片并渲染到页面上；</p>
</li>
</ul>
<br>

<h2 id="ohos-x2F-lottie"><a href="#ohos-x2F-lottie" class="headerlink" title="@ohos&#x2F;lottie"></a>@ohos&#x2F;lottie</h2><p>@ohos&#x2F;lottie 是基于 lottie-web 开发，集成在三方库社区内的开源版本，是 HarmonyOS 系统中<strong>复杂动画</strong>的一种解决方案；</p>
<p>动画是传达想法和创造更好的用户交互体验的工具，常见使用动画的场景如下：</p>
<ul>
<li>启动动画：APP logo 动画的播放；</li>
<li>加载动画：网络请求的 loading 动画；</li>
<li>上下拉刷新动画：请求更多资源时的刷新动画；</li>
<li>按钮动画：切换按钮、编辑按钮、播放按钮等按钮的切换过渡动画；</li>
<li>视图转场动画：一些场景的转场添加动画能够提升用户体验；</li>
</ul>
<p>@ohos&#x2F;lottie 提供了使用 JSON 动画文件的解决方案，开发者可以在原生应用中像使用静态图像一样使用动画，而不用关注动画的实现过程，并且 @ohos&#x2F;lottie 具有一套完整的 API 控制动画的行为，可以让动画更具有交互性；</p>
<br>

<h3 id="安装与卸载"><a href="#安装与卸载" class="headerlink" title="安装与卸载"></a>安装与卸载</h3><ul>
<li><p>安装 @ohos&#x2F;lottie：</p>
<p>  通过 ohpm 执行对应的指令，将 lottie 安装到项目中；</p>
  <figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ohpm install @ohos/lottie</span><br></pre></td></tr></table></figure>
</li>
<li><p>卸载 @ohos&#x2F;lottie：</p>
<p>  通过 ohpm 执行卸载指令，将 lottie 从项目中删除，其程序包和配置信息将会从项目中移除；</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ohpm</span> uninstall <span class="variable">@ohos</span>/lottie</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="库的使用"><a href="#库的使用" class="headerlink" title="库的使用"></a>库的使用</h3><ul>
<li><p>@ohos&#x2F;lottie 的引入：</p>
<p>  通过 import 指令在项目中引入 @ohos&#x2F;lottie 到文件中；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lottie <span class="keyword">from</span> <span class="string">&#x27;@ohos/lottie&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建 Canvas 画布：</p>
<p>  @ohos&#x2F;lottie 解析 JSON 动画文件的数据需要基于 Canvas 画布进行 2D 渲染，所以在加载 JSON 动画之前，要先初始化渲染上下文，并在画面中创建 Canvas 画布区域，将对应的渲染上下文 renderingContext 传递给 Canvas；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化渲染上下文  </span></span><br><span class="line"><span class="keyword">private</span> <span class="attr">renderingSettings</span>: <span class="title class_">RenderingContextSettings</span> = <span class="keyword">new</span> <span class="title class_">RenderingContextSettings</span>(<span class="literal">true</span>) <span class="comment">// 设置开启抗锯齿</span></span><br><span class="line"><span class="keyword">private</span> <span class="attr">renderingContext</span>: <span class="title class_">CanvasRenderingContext2D</span> = <span class="keyword">new</span> <span class="title class_">CanvasRenderingContext2D</span>(<span class="variable language_">this</span>.<span class="property">renderingSettings</span>)  <span class="comment">// 创建2D渲染上下文</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载Canvas画布   </span></span><br><span class="line"><span class="title class_">Canvas</span>(<span class="variable language_">this</span>.<span class="property">renderingContext</span>)</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 @ohos&#x2F;lottie 加载 JSON 动画：</p>
<p>  在 loadAnimation 方法中需配置相应的初始设置，包括渲染上下文、渲染方式以及 JSON 动画资源的路径等；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用animationItem实例接收</span></span><br><span class="line"><span class="keyword">let</span> animationItem = lottie.<span class="title function_">loadAnimation</span>(&#123;</span><br><span class="line">          <span class="attr">container</span>: <span class="variable language_">this</span>.<span class="property">renderingContext</span>,            <span class="comment">// 渲染上下文</span></span><br><span class="line">          <span class="attr">renderer</span>: <span class="string">&#x27;canvas&#x27;</span>,                          <span class="comment">// 渲染方式</span></span><br><span class="line">          <span class="attr">loop</span>: <span class="literal">true</span>,                                  <span class="comment">// 是否循环播放,默认true</span></span><br><span class="line">          <span class="attr">autoplay</span>: <span class="literal">true</span>,                              <span class="comment">// 是否自动播放，默认true</span></span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;common/lottie/data.json&#x27;</span>,             <span class="comment">// json路径</span></span><br><span class="line">        &#125;)</span><br><span class="line">  <span class="comment">// 直接使用loadAnimation方法</span></span><br><span class="line">  lottie.<span class="title function_">loadAnimation</span>(&#123;                               <span class="comment">// 或者直接使用</span></span><br><span class="line">          <span class="attr">container</span>: <span class="variable language_">this</span>.<span class="property">renderingContext</span>,            <span class="comment">// 渲染上下文</span></span><br><span class="line">          <span class="attr">renderer</span>: <span class="string">&#x27;canvas&#x27;</span>,                          <span class="comment">// 渲染方式</span></span><br><span class="line">          <span class="attr">loop</span>: <span class="literal">true</span>,                                  <span class="comment">// 是否循环播放,默认true</span></span><br><span class="line">          <span class="attr">autoplay</span>: <span class="literal">true</span>,                              <span class="comment">// 是否自动播放，默认true</span></span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;common/lottie/data.json&#x27;</span>,             <span class="comment">// json路径</span></span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>@ohos&#x2F;lottie 控制动画：</p>
<p>  其中，封装了包括状态控制、进度控制、播放设置控制和属性控制等多个 API，用户可以利用这些 API 完成对动画的控制，实现更加灵活的交互效果；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 播放、暂停、停止、销毁  可以使用lottie，也可以使用animationItem实例进行控制</span></span><br><span class="line">lottie.<span class="title function_">play</span>();        <span class="comment">// 从目前停止的帧开始播放</span></span><br><span class="line">lottie.<span class="title function_">stop</span>();        <span class="comment">// 停止播放，回到第0帧</span></span><br><span class="line">lottie.<span class="title function_">pause</span>();       <span class="comment">// 暂停该动画，在当前帧停止并保持</span></span><br><span class="line">lottie.<span class="title function_">togglePause</span>(); <span class="comment">// 切换暂停/播放状态</span></span><br><span class="line">lottie.<span class="title function_">destroy</span>();     <span class="comment">// 删除该动画，移除相应的元素标签等。在unmount的时候，需要调用该方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 播放进度控制</span></span><br><span class="line">animationItem.<span class="title function_">goToAndStop</span>(value, isFrame); <span class="comment">// 跳到某个时刻/帧并停止。isFrame(默认false)指示value表示帧还是时间(毫秒)</span></span><br><span class="line">animationItem.<span class="title function_">goToAndPlay</span>(value, isFrame); <span class="comment">// 跳到某个时刻/帧并进行播放</span></span><br><span class="line">animationItem.<span class="title function_">goToAndStop</span>(<span class="number">30</span>, <span class="literal">true</span>);       <span class="comment">// 例：跳转到第30帧并停止</span></span><br><span class="line">animationItem.<span class="title function_">goToAndPlay</span>(<span class="number">300</span>);            <span class="comment">// 例：跳转到第300毫秒并播放</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制帧播放</span></span><br><span class="line">animationItem.<span class="title function_">setSegment</span>(<span class="number">5</span>,<span class="number">15</span>);             <span class="comment">// 限定动画资源播放时的整体帧范围，即设置动画片段</span></span><br><span class="line">animationItem.<span class="title function_">resetSegments</span>(<span class="number">5</span>,<span class="number">15</span>);          <span class="comment">// 重置播放的动画片段</span></span><br><span class="line">animationItem.<span class="title function_">playSegments</span>(arr, forceFlag); <span class="comment">// arr可以包含两个数字或者两个数字组成的数组，forceFlag表示是否立即强制播放该片段</span></span><br><span class="line">animationItem.<span class="title function_">playSegments</span>([<span class="number">10</span>,<span class="number">20</span>], <span class="literal">false</span>); <span class="comment">// 例：播放完之前的片段，播放10-20帧</span></span><br><span class="line">animationItem.<span class="title function_">playSegments</span>([[<span class="number">5</span>,<span class="number">15</span>],[<span class="number">20</span>,<span class="number">30</span>]], <span class="literal">true</span>); <span class="comment">//例： 直接播放5-15帧和20-30帧</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画基本属性控制</span></span><br><span class="line">lottie.<span class="title function_">setSpeed</span>(speed);         <span class="comment">// 设置播放速度，speed为1表示正常速度</span></span><br><span class="line">lottie.<span class="title function_">setDirection</span>(direction); <span class="comment">// 设置播放方向，1表示正向播放，-1表示反向播放</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取动画帧数属性</span></span><br><span class="line">animationItem.<span class="title function_">getDuration</span>();    <span class="comment">//获取动画时长</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>事件订阅：</p>
<p>  在一些特殊场景下，例如，开始加载动画或动画播放结束时，可能需要执行相应的操作；</p>
<p>  在 @ohos&#x2F;lottie 中提供了事件订阅和取消订阅的功能，当触发对应的 event，会执行传入的回调函数，用户可以在回调函数中完成要实现的功能；</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅事件</span></span><br><span class="line">animationItem.<span class="title function_">addEventListener</span>(event,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// TODO something</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消订阅事件</span></span><br><span class="line">animationItem.<span class="title function_">removeEventListener</span>(event,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// TODO something</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>  常见的 event 事件类型如下：</p>
  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// event事件类型</span></span><br><span class="line"><span class="string">&#x27;enterFrame&#x27;</span>   <span class="comment">// 每进入一帧就会触发</span></span><br><span class="line"><span class="string">&#x27;loopComplete&#x27;</span> <span class="comment">// 当前循环下播放（循环播放/非循环播放）结束时触发</span></span><br><span class="line"><span class="string">&#x27;complete&#x27;</span>     <span class="comment">// 播放完成时触发</span></span><br><span class="line"><span class="string">&#x27;segmentStart&#x27;</span> <span class="comment">// 播放指定片段时触发，playSegments、resetSegments等方法刚开始播放指定片段时会发出，如果playSegments播放多个片段，多个片段最开始都会触发。</span></span><br><span class="line"><span class="string">&#x27;destroy&#x27;</span>      <span class="comment">// 销毁动画时触发</span></span><br><span class="line"><span class="string">&#x27;data_ready&#x27;</span>   <span class="comment">// 数据准备完成</span></span><br><span class="line"><span class="string">&#x27;DOMLoaded&#x27;</span>    <span class="comment">// 动画相关dom已经被添加</span></span><br><span class="line"><span class="string">&#x27;error&#x27;</span>        <span class="comment">// 出现错误</span></span><br><span class="line"><span class="string">&#x27;data_failed&#x27;</span>  <span class="comment">// 数据加载失败</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h1 id="云开发"><a href="#云开发" class="headerlink" title="云开发"></a>云开发</h1><p>HarmonyOS 云开发是 DevEco Studio 新推出的功能，可以让开发者在一个项目工程中，使用一种语言完成端侧和云侧功能的开发；</p>
<img src="48.png" style="zoom: 67%;" />

<p>基于 AppGallery Connect Serverless 构建的云侧能力，让开发者无需构建和管理云端资源，随需使用，大大提高构建应用&#x2F;元服务的效率；</p>
<ul>
<li>认证服务：可以为应用快速构建安全可靠的用户认证系统；</li>
<li>云函数：一方面将开发测试的对象聚焦到函数级别，可以大幅简化应用开发与运维相关的事务；另一方面通过云函数SDK，可以便捷操作云数据库、云存储等，提升业务功能构建的便利性；</li>
<li>云数据库：在保证数据的可用性、可靠性、一致性，以及安全等特性基础上，能够实现数据在端云之间的无缝同步，可以帮助开发者快速构建端云、多端协同的应用；</li>
<li>云存储：提供可伸缩、免维护的云端存储服务，可用于应用上传图片、音频、视频或者其他用户生成的内容；</li>
</ul>
<p>随着应用功能越来越丰富，很多应用的运行都依赖云侧的支撑；相比于传统开发模式，云开发模式具备成本低、效率高、门槛低等优势；</p>
<table>
<thead>
<tr>
<th>区别点</th>
<th>传统开发模式</th>
<th>云开发模式</th>
</tr>
</thead>
<tbody><tr>
<td>开发工具</td>
<td>端侧与云侧各需一套开发工具，云侧需自建服务器，工具成本高</td>
<td>DevEco Studio 一套开发工具即可支撑端侧与云侧同时开发，无需搭建服务器，工具成本低</td>
</tr>
<tr>
<td>开发人员</td>
<td>端侧与云侧要求不同的开发语言，技能要求高；需多人投入，且开发人员之间需持续、准确沟通，人力与沟通成本高、效率低</td>
<td>依托 AppGallery Connect（以下简称 AGC）Serverless 云服务开放的接口，端侧开发人员也能轻松开发云侧代码，大大降低开发门槛；开发人员数量少，降低人力成本，提高沟通效率。</td>
</tr>
<tr>
<td>运维</td>
<td>需自行构建运营与运维能力，成本高、负担重</td>
<td>直接接入 AGC Serverless 云服务，实现免运维，无运维成本或资源浪费</td>
</tr>
</tbody></table>
<br>

<h2 id="工程模板"><a href="#工程模板" class="headerlink" title="工程模板"></a>工程模板</h2><p>当前 DevEco Studio 提供了两类工程模板：预置的通用云开发模板和从模板市场下载的云开发模板；</p>
<ul>
<li><p>通用云开发模板：提供了认证服务、云函数、云存储服务的示例工程；</p>
  <img src="49.png" style="zoom: 50%;" />
</li>
<li><p>从模板市场下载的模板：基于业务场景，提供了特定场景下的常用功能；例如：商城模板：</p>
  <img src="50.png" style="zoom: 50%;" /></li>
</ul>
<br>

<h2 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h2><p>HarmonyOS 云开发工程分为三部分：</p>
<ul>
<li>端开发工程（Application）：主要用于开发应用端侧的业务代码；</li>
<li>云开发工程（CloudProgram）：主要用于云侧功能的配置、开发、部署；</li>
<li>端侧公共库（External Libraries）：主要包含了JDK的扩展类库；</li>
</ul>
<img src="51.png" style="zoom: 60%;" />

<br>

<h2 id="工程创建与配置"><a href="#工程创建与配置" class="headerlink" title="工程创建与配置"></a>工程创建与配置</h2><ol>
<li><p>打开 DevEco Studio，菜单选择“File &gt; New &gt; Create Project”；</p>
<ul>
<li>HarmonyOS 应用选择“Application”；</li>
<li>元服务选择“Atomic Service”；</li>
<li>模板选择“Empty Ability with CloudDev”；</li>
</ul>
 <img src="49.png" style="zoom: 50%;" />
</li>
<li><p>填写工程信息后，点击“Next”；</p>
 <img src="52.png" style="zoom: 50%;" />
</li>
<li><p>点击“Sign in”使用华为开发者帐号登录工程；</p>
</li>
<li><p>选择应用&#x2F;元服务所属的团队，系统将根据包名自动关联出 AppGallery Connect 上已创建的 HarmonyOS 应用或者元服务，点击“Next”；</p>
 <img src="53.png" style="zoom: 50%;" />
</li>
<li><p>关联成功后，如果帐号所属的团队尚未签署云开发相关协议，点击协议链接仔细阅读协议内容后，勾选同意协议，点击“Finish”，即可完成工程的创建；</p>
</li>
<li><p>DevEco Studio 自动完成一些初始化配置；</p>
<ul>
<li><p>自动开通云开发相关服务，包括：认证服务、云函数、云数据库、云托管、API网关、云存储；</p>
  <img src="54.png" style="zoom: 50%;" />
</li>
<li><p>端侧工程中自动集成agconnect-services.json配置文件和相关服务最新HarmonyOS SDK；</p>
  <img src="55.png" style="zoom: 67%;" />
</li>
<li><p>云侧工程自动集成云数据库最新的Node.js Server SDK；</p>
  <img src="56.png" style="zoom:67%;" /></li>
</ul>
</li>
</ol>
<br>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/HarmonyOS/">HarmonyOS</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/HarmonyOS/">HarmonyOS</a>
    </span>
    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Deployed by <a href="https://github.com/kaedea/notion-down" target="_blank">notion-down</a> and
    Theme by <a href="https://github.com/kaedea/hexo-theme-hacker" target="_blank">hexo-theme-hacker</a>
    </br>
    
    &copy; 2024 a-pin
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>